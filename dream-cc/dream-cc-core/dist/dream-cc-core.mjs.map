{
  "version": 3,
  "sources": ["../src/utils/Injector.ts", "../src/audios/AudioManagerImpl.ts", "../src/audios/AudioChannelImpl.ts", "../src/res/resources/ResImpl.ts", "../src/res/loaders/CCLoader.ts", "../src/ticker/TickerManagerImpl.ts", "../src/ticker/TickerManager.ts", "../src/pools/PoolImpl.ts", "../src/pools/Pool.ts", "../src/events/Event.ts", "../src/events/EventListener.ts", "../src/events/EventDispatcher.ts", "../src/containers/Dictionary.ts", "../src/timer/TimerImpl.ts", "../src/timer/Timer.ts", "../src/res/resources/ResourceManagerImpl.ts", "../src/res/resources/ResourceManager.ts", "../src/res/resources/Resource.ts", "../src/loggers/LoggerImpl.ts", "../src/loggers/Logger.ts", "../src/res/ResRef.ts", "../src/res/loaders/LoaderQueue.ts", "../src/res/loaders/LoaderManagerImpl.ts", "../src/res/loaders/LoaderManager.ts", "../src/res/ResRequest.ts", "../src/utils/ClassUtils.ts", "../src/res/Res.ts", "../src/audios/AudioManager.ts", "../src/bindings/FunctionHook.ts", "../src/bindings/PropertyBinder.ts", "../src/bindings/Binder.ts", "../src/containers/List.ts", "../src/func/redPoint/RedPoint.ts", "../src/func/redPoint/RedPointNode.ts", "../src/func/Func.ts", "../src/func/FuncNode.ts", "../src/modules/Module.ts", "../src/configs/ConfigManagerImpl.ts", "../src/configs/ConfigManager.ts", "../src/modules/ModuleManager.ts", "../src/modules/ModuleLoader.ts", "../src/modules/ModuleProxy.ts", "../src/modules/ModuleQueue.ts", "../src/modules/ModuleRequest.ts", "../src/net/http/Http.ts", "../src/net/socket/SocketManagerImpl.ts", "../src/net/socket/SocketManager.ts", "../src/net/socket/Socket.ts", "../src/tasks/Task.ts", "../src/tasks/TaskQueue.ts", "../src/tasks/TaskSequence.ts", "../src/utils/BitFlag.ts", "../src/utils/Handler.ts", "../src/configs/accessors/ConfigStorage.ts", "../src/configs/accessors/BaseConfigAccessor.ts", "../src/utils/StringUtils.ts", "../src/utils/I18N.ts", "../src/utils/MathUtils.ts", "../src/utils/ObjectUtils.ts", "../src/configs/res/RemoteConfigLoader.ts", "../src/Engine.ts"],
  "sourcesContent": ["/**\r\n * \u7B80\u6613\u6CE8\u5165\u5668\r\n */\r\nexport class Injector {\r\n\r\n    /**\u7C7B\u578B\u5B57\u5178*/\r\n    private static __injectedMap: Map<string, any> = new Map<string, any>();\r\n    /**\u5B9E\u4F8B\u5B57\u5178*/\r\n    private static __instanceMap: Map<string, any> = new Map<string, any>();\r\n\r\n    /**\r\n     * \u6CE8\u5165\r\n     * @param key \r\n     * @param clazz   \u7C7B\u578B\u6216\u5B9E\u4F8B\r\n     */\r\n    static inject(customKey: string, clazz: any): void {\r\n        if (clazz instanceof Function) {\r\n            this.__injectedMap.set(customKey, clazz);\r\n        } else {\r\n            this.__instanceMap.set(customKey, clazz);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \u83B7\u53D6\u5DF2\u6CE8\u5165\u7684\u7C7B\u578B\u5B9E\u4F8B\r\n     */\r\n    static getInject(customKey: string): any | null {\r\n        let instance: any = this.__instanceMap.get(customKey);\r\n        if (instance) {\r\n            return instance;\r\n        }\r\n        let clazz: any | undefined = this.__injectedMap.get(customKey);\r\n        if (clazz === undefined) {\r\n            return null;\r\n        }\r\n        instance = new clazz();\r\n        this.__instanceMap.set(customKey, instance);\r\n        return instance;\r\n    }\r\n}", "import { director, find, Node } from \"cc\";\r\nimport { AudioChannelImpl } from \"./AudioChannelImpl\";\r\nimport { IAudioManager } from \"./IAudioManager\";\r\nimport { IAudioChannel } from \"./IAudioChannel\";\r\nimport { TickerManager } from \"../ticker/TickerManager\";\r\nimport { ResURL } from \"../res/ResURL\";\r\nimport { Res } from \"../res/Res\";\r\nimport { AudioManager } from \"./AudioManager\";\r\n\r\n\r\n/**\r\n * \u97F3\u9891\u64AD\u653E\u7BA1\u7406\u5668\r\n */\r\nexport class AudioManagerImpl implements IAudioManager {\r\n\r\n    private __audioRoot: Node;\r\n\r\n    private __musicChannels: Array<IAudioChannel>;\r\n    private __musicChannelIndex: number = 0;\r\n    private __soundChannels: Array<IAudioChannel>;\r\n\r\n    constructor() {\r\n        this.__musicChannels = [];\r\n        this.__soundChannels = [];\r\n\r\n        TickerManager.addTicker(this);\r\n        this.__audioRoot = find(\"AudioManager\");\r\n        if (this.__audioRoot == null) {\r\n            this.__audioRoot = new Node(\"AudioManager\");\r\n            director.getScene().addChild(this.__audioRoot);\r\n        }\r\n\r\n        //\u97F3\u4E50\u7528\u4E24\u4E2A\u8F68\u9053\u6765\u505A\u6DE1\u5165\u548C\u6DE1\u51FA\r\n        let channel: IAudioChannel;\r\n        for (let index = 0; index < 2; index++) {\r\n            channel = new AudioChannelImpl(this.__audioRoot);\r\n            this.__musicChannels.push(channel);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \u603B\u97F3\u91CF\r\n     */\r\n    get volume(): number {\r\n        return this.__volume;\r\n    }\r\n    private __volume: number = 1;\r\n    set volume(value: number) {\r\n        if (this.__volume == value) {\r\n            return;\r\n        }\r\n        this.__volume = value;\r\n        let channelVolume: number;\r\n        let channel: IAudioChannel;\r\n        for (let index = 0; index < this.__musicChannels.length; index++) {\r\n            channel = this.__musicChannels[index];\r\n            if (channel.isPlaying) {\r\n                channelVolume = channel.volume * this.__musicVolume * this.__volume;\r\n                channel.fade(0.1, channelVolume, channel.curVolume);\r\n            }\r\n        }\r\n        for (let index = 0; index < this.__soundChannels.length; index++) {\r\n            channel = this.__soundChannels[index];\r\n            if (channel.isPlaying) {\r\n                channelVolume = channel.volume * this.__soundVolume * this.__volume;\r\n                channel.fade(0.1, channelVolume, channel.curVolume);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \u97F3\u4E50\u603B\u97F3\u91CF\u63A7\u5236\r\n     */\r\n    set musicVolume(value: number) {\r\n        if (this.__musicVolume == value) {\r\n            return;\r\n        }\r\n        this.__musicVolume = value;\r\n        if (this.muteMusic) {\r\n            return;\r\n        }\r\n        let current: IAudioChannel = this.__musicChannels[this.__musicChannelIndex];\r\n        if (current && current.isPlaying) {\r\n            let channelVolume: number = current.volume * this.__musicVolume * this.__volume;\r\n            current.fade(0.1, channelVolume, current.curVolume);\r\n        }\r\n    }\r\n\r\n    private __musicVolume: number = 1;\r\n    get musicVolume(): number {\r\n        return this.__musicVolume;\r\n    }\r\n\r\n    /**\r\n     * \u58F0\u97F3\u603B\u97F3\u91CF\r\n     */\r\n    get soundVolume(): number {\r\n        return this.__soundVolume;\r\n    }\r\n    private __soundVolume: number;\r\n    set soundVolume(value: number) {\r\n        if (this.__soundVolume == value) {\r\n            return;\r\n        }\r\n        this.__soundVolume = value;\r\n        let channel: IAudioChannel;\r\n        for (let index = 0; index < this.__soundChannels.length; index++) {\r\n            channel = this.__soundChannels[index];\r\n            if (channel.isPlaying) {\r\n                let channelVolume: number = channel.volume * this.__soundVolume * this.__volume;\r\n                channel.fade(0.1, channelVolume, channel.curVolume);\r\n            }\r\n        }\r\n    }\r\n\r\n    set mute(value: boolean) {\r\n        if (this.__mute == value) {\r\n            return;\r\n        }\r\n        this.__mute = value;\r\n        this.__changedMutes();\r\n    }\r\n    private __mute: boolean;\r\n    get mute(): boolean {\r\n        return this.__mute;\r\n    }\r\n\r\n    get muteMusic(): boolean {\r\n        return this.__muteMusic;\r\n    }\r\n    private __muteMusic: boolean;\r\n\r\n    set muteMusic(value: boolean) {\r\n        if (this.__muteMusic == value) {\r\n            return;\r\n        }\r\n        this.__muteMusic = value;\r\n        this.__changedMutes();\r\n    }\r\n\r\n    get muteSound(): boolean {\r\n        return this.__muteSound;\r\n    }\r\n    private __muteSound: boolean;\r\n\r\n    set muteSound(value: boolean) {\r\n        if (this.__muteSound == value) {\r\n            return;\r\n        }\r\n        this.__muteSound = value;\r\n        this.__changedMutes();\r\n    }\r\n\r\n    private __changedMutes(): void {\r\n        for (let index = 0; index < this.__musicChannels.length; index++) {\r\n            const element = this.__musicChannels[index];\r\n            element.mute = this.muteMusic || this.mute;\r\n        }\r\n        for (let index = 0; index < this.__soundChannels.length; index++) {\r\n            const element = this.__soundChannels[index];\r\n            element.mute = this.muteSound || this.mute;;\r\n        }\r\n    }\r\n\r\n    playMusic(url: ResURL, volume: number, speed: number): void {\r\n        let playVolume: number;\r\n        if (this.muteMusic || this.mute) {\r\n            playVolume = 0;\r\n        } else {\r\n            //\u97F3\u91CF=\u8F68\u9053\u97F3\u91CF*\u97F3\u4E50\u97F3\u91CF*\u603B\u97F3\u91CF\r\n            playVolume = volume * this.__musicVolume * this.__volume;\r\n        }\r\n        //\u6B63\u5728\u64AD\u653E\u7684\u8F68\u9053\r\n        let current: IAudioChannel = this.__musicChannels[this.__musicChannelIndex];\r\n        if (current && current.isPlaying) {\r\n            if (Res.urlEqual(current.url, url)) {\r\n                //\u64AD\u653E\u76F8\u540C\u7684\u97F3\u4E50\r\n                return;\r\n            }\r\n        }\r\n        this.__musicChannelIndex++;\r\n        this.__musicChannelIndex = this.__musicChannelIndex % 2;\r\n        let last: IAudioChannel;\r\n        if (this.__musicChannelIndex == 0) {\r\n            current = this.__musicChannels[0];\r\n            last = this.__musicChannels[1];\r\n        } else {\r\n            current = this.__musicChannels[1];\r\n            last = this.__musicChannels[0];\r\n        }\r\n        if (last.isPlaying) {\r\n            last.fade(0.5, 0, undefined, null, true);\r\n        }\r\n        current.volume = volume;\r\n        current.play(url, null, playVolume, { time: 0.5, startVolume: 0 }, true, speed);\r\n    }\r\n\r\n    stopMusic(): void {\r\n        let current: IAudioChannel = this.__musicChannels[this.__musicChannelIndex];\r\n        if (current && current.isPlaying) {\r\n            current.stop();\r\n        }\r\n    }\r\n\r\n    pauseMusic(): void {\r\n        let current: IAudioChannel = this.__musicChannels[this.__musicChannelIndex];\r\n        if (current) {\r\n            current.pause();\r\n        }\r\n    }\r\n\r\n    resumeMusic(): void {\r\n        let current: IAudioChannel = this.__musicChannels[this.__musicChannelIndex];\r\n        if (current) {\r\n            current.resume();\r\n        }\r\n    }\r\n\r\n    playSound(url: ResURL, playedCallBack: () => void, volume: number, speed: number, loop: boolean): void {\r\n        let playVolume: number;\r\n        if (this.muteSound || this.mute) {\r\n            playVolume = 0;\r\n        } else {\r\n            playVolume = this.soundVolume * volume * this.__volume;\r\n        }\r\n        let channel: IAudioChannel = this.GetIdleChannel();\r\n        if (channel) {\r\n            channel.volume = volume;\r\n            channel.play(url, playedCallBack, playVolume, null, loop, speed);\r\n        }\r\n    }\r\n\r\n    getPlaying(url: ResURL): IAudioChannel {\r\n        for (let index = 0; index < this.__soundChannels.length; index++) {\r\n            const element = this.__soundChannels[index];\r\n            if (element.isPlaying && Res.urlEqual(element.url, url)) {\r\n                return element;\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n    private GetIdleChannel(): IAudioChannel {\r\n        let index: number;\r\n        let channel: IAudioChannel;\r\n        for (index = 0; index < this.__soundChannels.length; index++) {\r\n            channel = this.__soundChannels[index];\r\n            if (channel.isPlaying == false) {\r\n                return channel;\r\n            }\r\n        }\r\n        if (index < AudioManager.MAX_SOUND_CHANNEL_COUNT) {\r\n            channel = new AudioChannelImpl(this.__audioRoot);\r\n            this.__soundChannels.push(channel);\r\n            return channel;\r\n        }\r\n        return null;\r\n    }\r\n\r\n    tick(dt: number): void {\r\n        for (let index = 0; index < this.__musicChannels.length; index++) {\r\n            const element = this.__musicChannels[index];\r\n            if (element.isPlaying) {\r\n                element.tick(dt);\r\n            }\r\n        }\r\n        for (let index = 0; index < this.__soundChannels.length; index++) {\r\n            const element = this.__soundChannels[index];\r\n            if (element.isPlaying) {\r\n                element.tick(dt);\r\n            }\r\n        }\r\n    }\r\n}", "import { AudioSource, Node } from \"cc\";\r\nimport { Res } from \"../res/Res\";\r\nimport { ResURL } from \"../res/ResURL\";\r\nimport { Timer } from \"../timer/Timer\";\r\nimport { IAudioChannel } from \"./IAudioChannel\";\r\nimport { Logger } from \"../loggers/Logger\";\r\nimport { ResRequest } from \"../res/ResRequest\";\r\n\r\n\r\n\r\nexport class AudioChannelImpl implements IAudioChannel {\r\n\r\n    private __node: Node;\r\n    private __source: AudioSource;\r\n    private __isPlaying: boolean;\r\n    private __url: ResURL;\r\n\r\n    private __volume: number;\r\n    private __speed: number;\r\n    private __loop: boolean;\r\n\r\n    private __startTime: number;\r\n    private __time: number;\r\n\r\n    private __fadeData: FadeData;\r\n\r\n    private __paused: boolean;\r\n    private __pauseTime: number;\r\n    private __playedComplete: () => void;\r\n\r\n    private __reqeust: ResRequest | null = null;\r\n\r\n    private __mute: boolean;\r\n\r\n    volume: number;\r\n\r\n    constructor(node: Node, source?: AudioSource) {\r\n        if (source == null) {\r\n            source = node.addComponent(AudioSource);\r\n        }\r\n        this.__node = node;\r\n        this.__source = source;\r\n    }\r\n\r\n    get url(): ResURL {\r\n        return this.__url;\r\n    }\r\n\r\n    get mute(): boolean {\r\n        return this.__mute;\r\n    }\r\n\r\n    set mute(value: boolean) {\r\n        if (this.__mute == value) {\r\n            return;\r\n        }\r\n        this.__mute = value;\r\n        if (this.__mute) {\r\n            //\u8BB0\u5F55\u4E0B\u6765\r\n            this.__volume = this.__source.volume;\r\n            this.__source.volume = 0;\r\n        } else {\r\n            //\u6839\u636E\u8BB0\u5F55\u8BBE\u7F6E\r\n            this.__source.volume = this.__volume;\r\n        }\r\n    }\r\n\r\n    play(url: ResURL, playedComplete: () => void, volume: number, fade?: { time: number, startVolume?: number, complete?: Function, completeStop?: boolean }, loop: boolean = false, speed: number = 1): void {\r\n        this.__reset();\r\n        this.__url = url;\r\n        this.__playedComplete = playedComplete;\r\n        this.__isPlaying = true;\r\n\r\n        this.__speed = speed;\r\n        this.__loop = loop;\r\n        if (fade) {\r\n            if (fade.time <= 0) {\r\n                if (this.mute) {\r\n                    this.__volume = volume;\r\n                } else {\r\n                    this.__source.volume = volume;\r\n                }\r\n            }\r\n            if (this.__fadeData == null) {\r\n                this.__fadeData = new FadeData();\r\n            }\r\n            this.__fadeData.startTime = Timer.currentTime;\r\n            this.__fadeData.startValue = fade.startVolume == undefined ? this.__source.volume : fade.startVolume;\r\n            this.__fadeData.time = fade.time;\r\n            this.__fadeData.endValue = volume;\r\n            this.__fadeData.complete = fade.complete;\r\n            this.__fadeData.completeStop = fade.completeStop;\r\n        } else {\r\n            this.__volume = volume;\r\n        }\r\n        //\u672A\u52A0\u8F7D\u5B8C\u6210\u524D\uFF0C\u97F3\u9891\u7684\u7ED3\u675F\u65F6\u95F4\u4E3A\u65E0\u7A77\u5927\r\n        this.__startTime = Timer.currentTime;\r\n        this.__time = Number.MAX_VALUE;\r\n\r\n        if (this.__reqeust) {\r\n            this.__reqeust.dispose();\r\n            this.__reqeust = null;\r\n        }\r\n        this.__reqeust = Res.create(\r\n            this.url,\r\n            \"AudioChannel\",\r\n            undefined,\r\n            (err?: Error) => {\r\n                if (err) {\r\n                    this.__reqeust.dispose();\r\n                    this.__reqeust = null;\r\n                    Logger.error(err, Logger.TYPE.RES);\r\n                    this.__isPlaying = false;\r\n                    this.__source.stop();\r\n                    return;\r\n                }\r\n                if (this.__isPlaying == false) {\r\n                    return;\r\n                }\r\n                this.__play();\r\n            }\r\n        );\r\n        this.__reqeust.load();\r\n    }\r\n\r\n    stop(): void {\r\n        if (this.__source.playing) {\r\n            this.__source.stop();\r\n        }\r\n        this.__isPlaying = false;\r\n        this.__reset();\r\n    }\r\n\r\n    get isPlaying(): boolean {\r\n        return this.__isPlaying || this.__source.playing;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param time \r\n     * @param endVolume \r\n     * @param startVolume \r\n     * @param complete \r\n     * @param completeStop \r\n     * @returns \r\n     */\r\n    fade(time: number, endVolume: number, startVolume?: number, complete?: Function, completeStop?: boolean): void {\r\n        if (!this.isPlaying) {\r\n            return;\r\n        }\r\n        this.__paused = false;\r\n        //\u7ACB\u523B\r\n        if (time <= 0) {\r\n            if (this.mute) {\r\n                this.__volume = endVolume;\r\n            } else {\r\n                this.__source.volume = endVolume;\r\n            }\r\n            if (completeStop) {\r\n                this.stop();\r\n                if (complete) {\r\n                    complete();\r\n                }\r\n            }\r\n        } else {\r\n            if (this.__fadeData == null) {\r\n                this.__fadeData = new FadeData();\r\n            }\r\n            this.__fadeData.startTime = Timer.currentTime;\r\n            this.__fadeData.startValue = startVolume == undefined ? this.__source.volume : startVolume;\r\n            this.__fadeData.time = time;\r\n            this.__fadeData.endValue = endVolume;\r\n            this.__fadeData.complete = complete;\r\n            this.__fadeData.completeStop = completeStop;\r\n        }\r\n    }\r\n\r\n    private __reset(): void {\r\n        this.__url = null;\r\n        if (this.__reqeust) {\r\n            this.__reqeust.dispose();\r\n            this.__reqeust = null;\r\n        }\r\n        this.__isPlaying = false;\r\n        this.__paused = false;\r\n        this.__fadeData = null;\r\n    }\r\n\r\n    // private __clipLoaded(err: Error | null, result: ResRef): void {\r\n    //     if (err) {\r\n    //         if (Logger.isDebug(\"Core\")) {\r\n    //             console.error(err.message);\r\n    //         }\r\n    //         this.__isPlaying = false;\r\n    //         this.__source.stop();\r\n    //         return;\r\n    //     }\r\n    //     if (this.__isPlaying == false) {\r\n    //         result.dispose();\r\n    //         return;\r\n    //     }\r\n    //     let resKey: string = Res.url2Key(this.url);\r\n    //     if (resKey != result.key) {\r\n    //         result.dispose();\r\n    //         return;\r\n    //     }\r\n    //     this.__ref = result;\r\n    //     this.__play();\r\n    // }\r\n\r\n    private __play(): void {\r\n        this.__source.clip = this.__reqeust.getRef().content;\r\n        this.__source.loop = this.__loop;\r\n        this.__source.play();\r\n\r\n        let currentTime: number = Timer.currentTime;\r\n        if (this.__fadeData) {\r\n            this.__fadeData.startTime = currentTime;\r\n            if (this.mute) {\r\n                this.__volume = this.__fadeData.startValue;\r\n            } else {\r\n                this.__source.volume = this.__fadeData.startValue;\r\n            }\r\n        } else {\r\n            if (!this.mute) {\r\n                this.__source.volume = this.__volume;\r\n            } else {\r\n                this.__source.volume = 0;\r\n            }\r\n        }\r\n        this.__startTime = Timer.currentTime;\r\n        this.__time = this.__source.duration * 1000;\r\n        // let audio = this.__source[\"audio\"];\r\n        // if (audio) {\r\n        //     if (\"_element\" in audio) {\r\n        //         let element = audio[\"_element\"];\r\n        //         if (\"_currentSource\" in element) {\r\n        //             let currentSource = element[\"_currentSource\"];\r\n        //             if (\"playbackRate\" in currentSource) {\r\n        //                 let playbackRate = currentSource[\"playbackRate\"];\r\n        //                 if (\"value\" in playbackRate) {\r\n        //                     playbackRate[\"value\"] = this.__speed;\r\n        //                 }\r\n        //             }\r\n        //         }\r\n        //     }\r\n        // }\r\n    }\r\n\r\n    tick(dt: number): void {\r\n        if (this.__paused || this.__isPlaying == false || this.__url == null) {\r\n            return;\r\n        }\r\n        let currentTime: number = Timer.currentTime;\r\n        let passTime: number;\r\n        if (this.__fadeData) {\r\n            passTime = currentTime - this.__fadeData.startTime;\r\n            let value: number = passTime / this.__fadeData.time;\r\n            value = value > 1 ? 1 : value;\r\n            //\u97F3\u91CF\u8BBE\u7F6E\r\n            if (!this.mute) {\r\n                this.__source.volume = this.__fadeData.startValue + (this.__fadeData.endValue - this.__fadeData.startValue) * value;\r\n            } else {\r\n                this.__volume = this.__fadeData.startValue + (this.__fadeData.endValue - this.__fadeData.startValue) * value;\r\n            }\r\n            if (value == 1) {\r\n                let complete: Function = this.__fadeData.complete;\r\n                if (this.__fadeData.completeStop) {\r\n                    this.__source.stop();\r\n                    this.__isPlaying = false;\r\n                    this.__reset();\r\n                }\r\n                if (complete) {\r\n                    complete();\r\n                }\r\n                this.__fadeData = null;\r\n            }\r\n        }\r\n\r\n        //\u5FAA\u73AF\u64AD\u653E\r\n        if (this.__loop) {\r\n            return;\r\n        }\r\n        //\u68C0\u6D4B\u662F\u5426\u7ED3\u675F\r\n        passTime = currentTime - this.__startTime;\r\n        let value: number = passTime / this.__time;\r\n        if (value >= 1) {\r\n            //\u64AD\u653E\u5B8C\u6210\r\n            // Debuger.Log(Debuger.DRONGO, \"\u64AD\u653E\u5B8C\u6210\uFF01\" + this.__url);\r\n            this.__source.stop();\r\n            this.__isPlaying = false;\r\n            if (this.__playedComplete) {\r\n                this.__playedComplete();\r\n            }\r\n            this.__reset();\r\n        }\r\n    }\r\n\r\n    resume(): void {\r\n        if (this.__paused == false) {\r\n            return;\r\n        }\r\n        let pTime: number = Timer.currentTime - this.__pauseTime;\r\n        if (this.__fadeData) {\r\n            this.__fadeData.startTime += pTime;\r\n        }\r\n        this.__startTime += pTime;\r\n        this.__source.play();\r\n        this.__paused = false;\r\n    }\r\n\r\n    pause(): void {\r\n        if (this.__paused) {\r\n            return;\r\n        }\r\n        this.__paused = true;\r\n        this.__pauseTime = Timer.currentTime;\r\n        this.__source.pause();\r\n    }\r\n\r\n    get curVolume(): number {\r\n        return this.__source.volume;\r\n    }\r\n}\r\n\r\nclass FadeData {\r\n    time: number;\r\n    startTime: number;\r\n    startValue: number;\r\n    endValue: number;\r\n    complete: Function;\r\n    completeStop: boolean;\r\n}", "import { Asset, AssetManager, assetManager, SpriteFrame, Texture2D } from \"cc\";\r\nimport { ILoader } from \"../loaders/ILoader\";\r\nimport { IRes } from \"./IRes\";\r\nimport { ResURL } from \"../ResURL\";\r\nimport { CCLoader } from \"../loaders/CCLoader\";\r\nimport { Pool } from \"../../pools/Pool\";\r\nimport { ResRequest } from \"../ResRequest\";\r\nimport { ClassUtils } from \"../../utils/ClassUtils\";\r\n\r\n/**\r\n * \u8D44\u6E90\u5165\u53E3\u5B9E\u73B0\r\n */\r\nexport class ResImpl implements IRes {\r\n\r\n    private loaderClass: Map<string, new () => ILoader>;\r\n\r\n    /**\r\n     * \u8D44\u6E90\u7C7B\u578B\u6620\u5C04\r\n     */\r\n    private __assetTypes = new Map<string, typeof Asset>();\r\n\r\n    constructor() {\r\n        this.loaderClass = new Map<string, new () => ILoader>();\r\n    }\r\n\r\n    url2Key(url: ResURL): string {\r\n        if (url == null || url == undefined) {\r\n            return \"\";\r\n        }\r\n        if (typeof url == \"string\") {\r\n            return url;\r\n        }\r\n        let ul: string;\r\n        if (url.type == SpriteFrame) {\r\n            ul = url.url + \"/spriteFrame\";\r\n        } else if (url.type == Texture2D) {\r\n            ul = url.url + \"/texture\";\r\n        } else {\r\n            ul = url.url;\r\n        }\r\n        return ul + \"|\" + url.bundle + \"|\" + this.getAndSaveClassName(url.type);\r\n    }\r\n\r\n    key2Url(key: string): ResURL {\r\n        if (key.indexOf(\"|\")) {\r\n            let arr: Array<string> = key.split(\"|\");\r\n            return { url: this.path2Key(arr[0]), bundle: arr[1], type: this.getAssetType(arr[2]) };\r\n        }\r\n        return key;\r\n    }\r\n\r\n    url2Path(url: ResURL): string {\r\n        if (typeof url == \"string\") {\r\n            return url;\r\n        }\r\n        if (url.type == Texture2D) {\r\n            return url.url + \"/texture\";\r\n        }\r\n        if (url.type == SpriteFrame) {\r\n            return url.url + \"/spriteFrame\"\r\n        }\r\n        return url.url;\r\n    }\r\n\r\n    urlEqual(a: ResURL | null, b: ResURL | null): boolean {\r\n        if (a == b) return true;\r\n        if (a == null || b == null) return false;\r\n        if (typeof a == \"string\" && typeof b == \"string\") {\r\n            return a == b;\r\n        }\r\n        if (typeof a == \"string\" || typeof b == \"string\") {\r\n            return false;\r\n        }\r\n        if (a.url == b.url && a.type == b.type && a.bundle == b.bundle) {\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    private getAssetType(key: string): typeof Asset {\r\n        if (!this.__assetTypes.has(key)) {\r\n            throw new Error(\"\u672A\u627E\u5230\u5BF9\u5E94\u8D44\u6E90\u7C7B\u578B\uFF1A\" + key);\r\n        }\r\n        return this.__assetTypes.get(key)!;\r\n    }\r\n\r\n    private getAndSaveClassName(clazz: any): string {\r\n        let className: string = ClassUtils.getClassName(clazz);\r\n        if (!this.__assetTypes.has(className)) {\r\n            this.__assetTypes.set(className, clazz);\r\n        }\r\n        return className;\r\n    }\r\n\r\n    path2Key(key: string): string {\r\n        let len: number = key.length;\r\n        let end: number = len - 8;\r\n        //texture\r\n        let t = key.substring(end);\r\n        if (t === \"/texture\") {\r\n            return key.substring(0, end);\r\n        }\r\n        //spriteFrame\r\n        end = len - 12;\r\n        t = key.substring(end);\r\n        if (t === \"/spriteFrame\") {\r\n            return key.substring(0, end);\r\n        }\r\n        return key;\r\n    }\r\n\r\n    setLoader(key: any, loader: new () => ILoader): void {\r\n        let className = ClassUtils.getClassName(key);\r\n        this.loaderClass.set(className, loader);\r\n    }\r\n\r\n    getLoader(key: any): new () => ILoader {\r\n        let className = ClassUtils.getClassName(key);\r\n        if (!this.loaderClass.has(className)) {\r\n            return CCLoader;\r\n        }\r\n        return this.loaderClass.get(className)!;\r\n    }\r\n\r\n    create(url: ResURL | Array<ResURL>, refKey: string, progress?: (progress: number) => void, cb?: (err?: Error) => void): ResRequest {\r\n        let reqeust = Pool.acquire(ResRequest);\r\n        reqeust.init(url, refKey, progress, cb);\r\n        return reqeust;\r\n    }\r\n\r\n\r\n    loadAssetBundles(names: string | Array<string>): Promise<void> {\r\n        let list = [];\r\n        if (typeof names == \"string\") {\r\n            list.push(names);\r\n        } else {\r\n            list.push(...names);\r\n        }\r\n        let abs = [];\r\n        for (let index = 0; index < list.length; index++) {\r\n            const bundle_name = list[index];\r\n            let bundle = assetManager.getBundle(bundle_name);\r\n            if (!bundle && abs.indexOf(bundle_name) == -1) {\r\n                abs.push(bundle_name);\r\n            }\r\n        }\r\n        let loaded = 0;\r\n        let total = abs.length;\r\n        let result = new Promise<void>(\r\n            (resolve, reject) => {\r\n                for (let index = 0; index < abs.length; index++) {\r\n                    const bundle_name = abs[index];\r\n                    assetManager.loadBundle(bundle_name, (err: Error | null, bundle: AssetManager.Bundle) => {\r\n                        if (err) {\r\n                            reject(err);\r\n                            return;\r\n                        }\r\n                        loaded++;\r\n                        if (loaded == total) {\r\n                            resolve();\r\n                        }\r\n                    });\r\n                }\r\n            }\r\n        );\r\n        return result;\r\n    }\r\n}", "import { Asset, AssetManager, assetManager } from \"cc\";\r\nimport { ILoader } from \"../loaders/ILoader\";\r\nimport { ResURL } from \"../ResURL\";\r\nimport { EventDispatcher } from \"../../events/EventDispatcher\";\r\nimport { Event } from \"../../events/Event\";\r\nimport { ResourceManager } from \"../resources/ResourceManager\";\r\nimport { Resource } from \"../resources/Resource\";\r\nimport { Res } from \"../Res\";\r\n\r\n/**\r\n * cocos \u5185\u7F6E\u7C7B\u578B\u8D44\u6E90\u52A0\u8F7D\u5668\r\n */\r\nexport class CCLoader extends EventDispatcher implements ILoader {\r\n\r\n    private __url?: ResURL;\r\n\r\n    constructor() {\r\n        super();\r\n    }\r\n\r\n    reset(): void {\r\n        this.__url = undefined;\r\n        //\u65A9\u65AD\u4E00\u5207\u4E8B\u4EF6\u76D1\u542C\r\n        this.offAllEvent();\r\n    }\r\n\r\n    load(url: ResURL): void {\r\n        this.__url = url;\r\n        if (!this.__url) {\r\n            throw new Error(\"url is null\");\r\n        }\r\n        if (typeof this.__url == \"string\") {\r\n            assetManager.loadRemote(\r\n                this.__url,\r\n                (err: Error | null, asset: Asset) => {\r\n                    if (err) {\r\n                        this.emit(Event.ERROR, this.__url, err);\r\n                        return;\r\n                    }\r\n                    const urlKey = Res.url2Key(url);\r\n                    let res: Resource = new Resource();\r\n                    res.key = urlKey;\r\n                    res.content = asset;\r\n                    ResourceManager.addRes(res);\r\n                    this.emit(Event.COMPLETE, url);\r\n                });\r\n        } else {\r\n            let bundle = assetManager.getBundle(this.__url.bundle);\r\n            if (!bundle) {\r\n                assetManager.loadBundle(\r\n                    this.__url.bundle,\r\n                    (err: Error | null, bundle: AssetManager.Bundle) => {\r\n                        if (err) {\r\n                            this.emit(Event.ERROR, this.__url, err);\r\n                            return;\r\n                        }\r\n                        this.__load(this.__url!, bundle);\r\n                    }\r\n                );\r\n            } else {\r\n                this.__load(this.__url, bundle);\r\n            }\r\n        }\r\n    }\r\n\r\n    private __load(url: ResURL, bundle: AssetManager.Bundle): void {\r\n        if (typeof url == \"string\") {\r\n            throw new Error(\"\u672A\u5B9E\u73B0\uFF01\");\r\n        }\r\n        let urlStr = Res.url2Path(url);\r\n        bundle.load(\r\n            urlStr,\r\n            url.type,\r\n            (finished: number, total: number) => {\r\n                const progress = finished / total;\r\n                this.emit(Event.PROGRESS, this.__url, undefined, progress);\r\n            },\r\n            (err: Error | null, asset: Asset) => {\r\n                if (err) {\r\n                    this.emit(Event.ERROR, url, err);\r\n                    return;\r\n                }\r\n                const urlKey = Res.url2Key(url);\r\n                let res: Resource = new Resource();\r\n                res.key = urlKey;\r\n                res.content = asset;\r\n                ResourceManager.addRes(res);\r\n                this.emit(Event.COMPLETE, url);\r\n            }\r\n        );\r\n    }\r\n}", "\r\n\r\n\r\nimport { ITicker } from \"./ITicker\";\r\nimport { ITickerManager } from \"./ITickerManager\";\r\n\r\n\r\nexport class TickerManagerImpl implements ITickerManager {\r\n\r\n    private __tickerList: Array<ITicker> = []\r\n\r\n    private __nextFrameCallBacks: Array<NextFrameHandler> = [];\r\n\r\n    tick(dt: number): void {\r\n        let handler: NextFrameHandler;\r\n        while (this.__nextFrameCallBacks.length) {\r\n            handler = this.__nextFrameCallBacks.shift()!;\r\n            handler.callBack.apply(handler.caller);\r\n        }\r\n        for (let index = 0; index < this.__tickerList.length; index++) {\r\n            const element = this.__tickerList[index];\r\n            element.tick(dt);\r\n        }\r\n    }\r\n\r\n    addTicker(value: ITicker): void {\r\n        let index: number = this.__tickerList.indexOf(value);\r\n        if (index >= 0) {\r\n            throw new Error(\"Ticker \u91CD\u590D\u6DFB\u52A0\uFF01\");\r\n        }\r\n        this.__tickerList.push(value);\r\n    }\r\n\r\n    removeTicker(value: ITicker): void {\r\n        let index: number = this.__tickerList.indexOf(value);\r\n        if (index < 0) {\r\n            throw new Error(\"\u627E\u4E0D\u5230\u8981\u5220\u9664\u7684Tick!\");\r\n        }\r\n        this.__tickerList.splice(index, 1);\r\n    }\r\n\r\n    callNextFrame(value: Function, caller: any): void {\r\n        for (let index = 0; index < this.__nextFrameCallBacks.length; index++) {\r\n            const element = this.__nextFrameCallBacks[index];\r\n            //\u91CD\u590D\r\n            if (element.equal(value, caller)) {\r\n                return;\r\n            }\r\n        }\r\n        this.__nextFrameCallBacks.push(new NextFrameHandler(value, caller));\r\n    }\r\n\r\n    clearNextFrame(value: Function, caller: any): void {\r\n        for (let index = 0; index < this.__nextFrameCallBacks.length; index++) {\r\n            const element = this.__nextFrameCallBacks[index];\r\n            //\u5220\u9664\r\n            if (element.equal(value, caller)) {\r\n                this.__nextFrameCallBacks.splice(index, 1);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nclass NextFrameHandler {\r\n    callBack: Function;\r\n    caller: any;\r\n\r\n    constructor(callBack: Function, caller: any) {\r\n        this.callBack = callBack;\r\n        this.caller = caller;\r\n    }\r\n\r\n    equal(callBack: Function, caller: any): boolean {\r\n        if (this.caller !== caller) {\r\n            return false;\r\n        }\r\n        if (this.callBack !== callBack) {\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n}", "import { Injector } from \"../utils/Injector\";\r\nimport { ITicker } from \"./ITicker\";\r\nimport { ITickerManager } from \"./ITickerManager\";\r\nimport { TickerManagerImpl } from \"./TickerManagerImpl\";\r\n\r\n\r\n\r\n/**\r\n * \u5FC3\u8DF3\u9A71\u52A8\u5668\u5B9E\u73B0\r\n */\r\nexport class TickerManager {\r\n\r\n    static KEY: string = \"TickerManager\";\r\n\r\n    /**\r\n     * \u5FC3\u8DF3\u9A71\u52A8\u63A5\u53E3\r\n     * @param dt \r\n     */\r\n    static tick(dt: number): void {\r\n        this.impl.tick(dt);\r\n    }\r\n\r\n    /**\r\n     * \u6DFB\u52A0\u4E00\u4E2A\u5FC3\u8DF3\u9A71\u52A8\r\n     * @param value \r\n     */\r\n    static addTicker(value: ITicker): void {\r\n        this.addTicker(value);\r\n    }\r\n\r\n    /**\r\n     * \u5220\u9664\u4E00\u4E2A\u5FC3\u8DF3\u9A71\u52A8\r\n     * @param value \r\n     */\r\n    static removeTicker(value: ITicker): void {\r\n        this.removeTicker(value);\r\n    }\r\n\r\n    /**\r\n     * \u4E0B\u4E00\u5E27\u56DE\u8C03\r\n     * @param value \r\n     * @param caller \r\n     */\r\n    static callNextFrame(value: Function, caller: any): void {\r\n        this.callNextFrame(value, caller);\r\n    }\r\n\r\n    /**\r\n     * \u6E05\u7406\u4E0B\u4E00\u5E27\u56DE\u8C03\u8BF7\u6C42(\u5982\u679C\u5B58\u5728\u7684\u8BDD)\r\n     * @param value\r\n     * @param value \r\n     * @param caller \r\n     */\r\n    static clearNextFrame(value: Function, caller: any): void {\r\n        this.clearNextFrame(value, caller);\r\n    }\r\n\r\n    private static __impl: ITickerManager;\r\n    static get impl(): ITickerManager {\r\n        if (this.__impl == null) {\r\n            this.__impl = Injector.getInject(this.KEY);\r\n        }\r\n        if (this.__impl == null) {\r\n            this.__impl = new TickerManagerImpl();\r\n        }\r\n        return this.__impl;\r\n    }\r\n}", "import { IDestroyable } from \"../interfaces/IDestroyable\";\r\nimport { IPoolable } from \"./IPoolable\";\r\n\r\n\r\n/**\r\n * \u5BF9\u8C61\u6C60\u5B9E\u73B0\r\n */\r\nexport class PoolImpl<T extends IPoolable> implements IDestroyable {\r\n\r\n    /**\u5BF9\u8C61\u7C7B\u578B */\r\n    private __class: new () => T;\r\n    /**\u6B63\u5728\u4F7F\u7528\u7684\u5BF9\u8C61\u5217\u8868 */\r\n    private __using: Set<T>;\r\n    /**\u7A7A\u95F2\u5BF9\u8C61\u5217\u8868 */\r\n    private __free: Set<T>;\r\n    /**\u6700\u5927\u5BF9\u8C61\u6570 */\r\n    private __max: number = 0;\r\n\r\n    constructor(classType: new () => T, max: number = 1000, min: number = 0) {\r\n        this.__class = classType;\r\n        this.__max = max;\r\n        this.__using = new Set<T>();\r\n        this.__free = new Set<T>();\r\n        // \u521D\u59CB\u5316\u5BF9\u8C61\u6C60\u5230\u6700\u5C0F\u5BB9\u91CF\r\n        for (let i = 0; i < min; i++) {\r\n            this.__free.add(new this.__class());\r\n        }\r\n    }\r\n\r\n    \r\n    /**\r\n     * \u9500\u6BC1\u5BF9\u8C61\u6C60\u4E2D\u7684\u6240\u6709\u5BF9\u8C61\u5E76\u91CA\u653E\u8D44\u6E90\r\n     *\r\n     * @returns \u8FD4\u56DE\u4E00\u4E2A\u5E03\u5C14\u503C\uFF0C\u8868\u793A\u9500\u6BC1\u64CD\u4F5C\u662F\u5426\u6210\u529F\r\n     */\r\n    destroy(): boolean {\r\n        // \u91CA\u653E\u6240\u6709\u5BF9\u8C61\u5230\u5BF9\u8C61\u6C60\u4E2D\r\n        this.releaseAll();\r\n        for (const element of this.__free) {\r\n            element.destroy();\r\n        }\r\n        this.__free.clear();\r\n        this.__using.clear();\r\n        return true;\r\n    }\r\n\r\n    \r\n    /**\r\n     * \u4ECE\u5BF9\u8C61\u6C60\u4E2D\u83B7\u53D6\u4E00\u4E2A\u5BF9\u8C61\u3002\r\n     *\r\n     * @returns \u8FD4\u56DE\u83B7\u53D6\u5230\u7684\u5BF9\u8C61\u3002\r\n     * @throws \u5F53\u5BF9\u8C61\u6C60\u5DF2\u6EE1\u65F6\uFF0C\u629B\u51FA\u9519\u8BEF\u3002\r\n     */\r\n    acquire(): T {\r\n        let item: T;\r\n        if (this.__free.size > 0) {\r\n            // \u4ECE __free \u4E2D\u53D6\u51FA\u4E00\u4E2A\u5BF9\u8C61\r\n            const iterator = this.__free.values();\r\n            item = iterator.next().value!;\r\n            this.__free.delete(item);\r\n        } else {\r\n            if (this.size >= this.__max) {\r\n                throw new Error(\"\u5BF9\u8C61\u6C60\u5DF2\u6EE1\");\r\n            }\r\n            item = new this.__class();\r\n        }\r\n        this.__using.add(item);\r\n        return item;\r\n    }\r\n\r\n    \r\n    /**\r\n     * \u91CA\u653E\u5BF9\u8C61\r\n     *\r\n     * @param item \u8981\u91CA\u653E\u7684\u5BF9\u8C61\r\n     */\r\n    release(item: T): void {\r\n        item.reset(); // \u91CD\u7F6E\u5BF9\u8C61\u72B6\u6001\r\n        this.__using.delete(item);\r\n        this.__free.add(item);\r\n    }\r\n\r\n    \r\n    /**\r\n     * \u91CA\u653E\u6240\u6709\u6B63\u5728\u4F7F\u7528\u7684\u8D44\u6E90\r\n     */\r\n    releaseAll(): void {\r\n        if (this.__using.size === 0) {\r\n            return;\r\n        }\r\n        this.__using.forEach(item => {\r\n            this.release(item);\r\n        });\r\n        this.__using.clear();\r\n    }\r\n\r\n    /**\r\n     * \u83B7\u53D6\u5F53\u524D\u6B63\u5728\u4F7F\u7528\u7684\u6570\u91CF\r\n     */\r\n    get usingCount(): number {\r\n        return this.__using.size;\r\n    }\r\n\r\n    /**\r\n     * \u83B7\u53D6\u7A7A\u95F2\u8BA1\u6570\u5668\u7684\u503C\r\n     */\r\n    get freeCount(): number {\r\n        return this.__free.size;\r\n    }\r\n\r\n    /**\r\n     * \u5BF9\u8C61\u6C60\u5F53\u524D\u7684\u5927\u5C0F\uFF08\u5DF2\u521B\u5EFA\u5BF9\u8C61\u7684\u6570\u91CF\uFF09\r\n     */\r\n    get size(): number {\r\n        return this.freeCount + this.usingCount;\r\n    }\r\n}", "import { IPoolable } from \"./IPoolable\";\r\nimport { PoolImpl } from \"./PoolImpl\";\r\n\r\n\r\n\r\n\r\n/**\r\n * \u5BF9\u8C61\u6C60\r\n * @example\r\n * //\u4ECE\u5BF9\u8C61\u6C60\u83B7\u53D6\u4E00\u4E2A\u5B9E\u4F8B\r\n * let item=Pool.acquire(MyClass);\r\n * //\u5C06\u5BF9\u8C61\u8FD8\u56DE\u5BF9\u8C61\u6C60\r\n * Pool.release(MyClass,item);\r\n */\r\nexport class Pool {\r\n\r\n    /**\r\n     * \u5BF9\u8C61\u6C60\u7684\u96C6\u5408\r\n     */\r\n    private static pools = new Map<new () => IPoolable, PoolImpl<IPoolable>>()\r\n\r\n    /**\r\n     * \u4ECE\u5BF9\u8C61\u6C60\u4E2D\u83B7\u53D6\u4E00\u4E2A\u5B9E\u4F8B\r\n     *\r\n     * @param clazz \u7C7B\u7684\u6784\u9020\u51FD\u6570\uFF0C\u8BE5\u7C7B\u9700\u8981\u5B9E\u73B0 IPoolable \u63A5\u53E3\r\n     * @returns \u8FD4\u56DE\u4ECE\u5BF9\u8C61\u6C60\u4E2D\u83B7\u53D6\u7684\u5B9E\u4F8B\r\n     */\r\n    static acquire<T extends IPoolable>(clazz: new () => T): T {\r\n        let pool = this.pools.get(clazz);\r\n        if (!pool) {\r\n\r\n            this.pools.set(clazz, new PoolImpl(clazz, 1000, 0))\r\n            return this.acquire(clazz);\r\n        }\r\n        return pool.acquire() as T;\r\n    }\r\n\r\n\r\n    /**\r\n     * \u91CA\u653E\u5BF9\u8C61\u5230\u6307\u5B9A\u7C7B\u578B\u7684\u5BF9\u8C61\u6C60\u4E2D\r\n     *\r\n     * @param clazz \u5BF9\u8C61\u7C7B\u578B\uFF0C\u5FC5\u987B\u5B9E\u73B0 IPoolable \u63A5\u53E3\r\n     * @param item \u8981\u91CA\u653E\u7684\u5BF9\u8C61\r\n     * @throws \u5982\u679C\u5BF9\u8C61\u6C60\u4E0D\u5B58\u5728\uFF0C\u5219\u629B\u51FA\u9519\u8BEF\r\n     */\r\n    static release<T extends IPoolable>(clazz: new () => T, item: T): void {\r\n        let pool = this.pools.get(clazz);\r\n        if (pool) {\r\n            pool.release(item);\r\n        } else {\r\n            throw new Error(\"\u5BF9\u8C61\u6C60\u4E0D\u5B58\u5728\");\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \u91CA\u653E\u6307\u5B9A\u7C7B\u7684\u6240\u6709\u5BF9\u8C61\r\n     *\r\n     * @param clazz \u7C7B\u6784\u9020\u51FD\u6570\uFF0C\u9700\u8981\u5B9E\u73B0 IPoolable \u63A5\u53E3\r\n     * @throws Error \u5982\u679C\u5BF9\u8C61\u6C60\u4E0D\u5B58\u5728\uFF0C\u5219\u629B\u51FA\u9519\u8BEF\r\n     */\r\n    static releaseAll<T extends IPoolable>(clazz: new () => T): void {\r\n        let pool = this.pools.get(clazz);\r\n        if (pool) {\r\n            pool.releaseAll();\r\n        } else {\r\n            throw new Error(\"\u5BF9\u8C61\u6C60\u4E0D\u5B58\u5728\");\r\n        }\r\n    }\r\n\r\n\r\n    /**\r\n     * \u9500\u6BC1\u6307\u5B9A\u7C7B\u7684\u5BF9\u8C61\u6C60\r\n     *\r\n     * @param clazz \u9700\u8981\u9500\u6BC1\u5BF9\u8C61\u6C60\u7684\u7C7B\r\n     * @throws Error \u5982\u679C\u5BF9\u8C61\u6C60\u4E0D\u5B58\u5728\uFF0C\u5219\u629B\u51FA\u9519\u8BEF\r\n     */\r\n    static destroy<T extends IPoolable>(clazz: new () => T): void {\r\n        let pool = this.pools.get(clazz);\r\n        if (pool) {\r\n            pool.destroy();\r\n            this.pools.delete(clazz);\r\n        } else {\r\n            throw new Error(\"\u5BF9\u8C61\u6C60\u4E0D\u5B58\u5728\");\r\n        }\r\n    }\r\n\r\n    static logStatus(): void {\r\n        console.log(\"\u5404\u5BF9\u8C61\u6C60\u7684\u72B6\u6001\uFF1A\");\r\n        this.pools.forEach((pool, clazz) => {\r\n            console.log(`\u7C7B\u540D: ${clazz.name}`);\r\n            console.log(`  \u5DF2\u4F7F\u7528\u5BF9\u8C61\u6570\u91CF: ${pool.usingCount}`);\r\n            console.log(`  \u7A7A\u95F2\u5BF9\u8C61\u6570\u91CF: ${pool.freeCount}`);\r\n        });\r\n    }\r\n}", "import { IPoolable } from \"../pools/IPoolable\";\r\nimport { Pool } from \"../pools/Pool\";\r\nimport { EventType } from \"./EventType\";\r\nimport { IEventDispatcher } from \"./IEventDispatcher\";\r\n\r\n\r\n/**\r\n * \u4E8B\u4EF6\u5BF9\u8C61\r\n */\r\nexport class Event implements IPoolable {\r\n\r\n    static readonly START: string = \"START\";\r\n    static readonly PROGRESS: string = \"PROGRESS\";\r\n    static readonly COMPLETE: string = \"COMPLETE\";\r\n    static readonly ERROR: string = \"ERROR\";\r\n\r\n    static readonly SHOW: string = \"SHOW\";\r\n    static readonly HIDE: string = \"HIDE\";\r\n    static readonly ADD: string = \"ADD\";\r\n    static readonly REMOVE: string = \"REMOVE\";\r\n    static readonly UPDATE: string = \"UPDATE\";\r\n    static readonly CLEAR: string = \"CLEAR\";\r\n    static readonly STATE_CHANGED: string = \"STATE_CHANGED\";\r\n    static readonly VALUE_CHANGED: string = \"VALUE_CHANGED\";\r\n    static readonly ADD_CHILD: string = \"ADD_CHILD\";\r\n    static readonly REMOVE_CHILD: string = \"REMOVE_CHILD\";\r\n    static readonly CHILD_VALUE_CHANGED: string = \"CHILD_VALUE_CHANGED\";\r\n\r\n    /**\r\n     * \u4E8B\u4EF6\u7C7B\u578B\r\n     */\r\n    type?: EventType;\r\n    /**\r\n     * \u4E8B\u4EF6\u6D3E\u53D1\u5BF9\u8C61\r\n     */\r\n    target?: IEventDispatcher;\r\n    /**\r\n     * \u4E8B\u4EF6\u6570\u636E\r\n     */\r\n    data?: any;\r\n    /**\r\n     * \u9519\u8BEF\u4FE1\u606F\r\n     */\r\n    error?: Error;\r\n    /**\r\n     * \u8FDB\u5165\u767E\u5206\u6BD4(0-1)\r\n     */\r\n    progress: number = 0;\r\n    /**\r\n     * \u4E8B\u4EF6\u662F\u5426\u505C\u6B62\r\n     */\r\n    propagationStopped: boolean = false;\r\n\r\n    constructor() {\r\n\r\n    }\r\n\r\n    /**\r\n     * \u521D\u59CB\u5316\r\n     * @param type \r\n     * @param taraget\r\n     * @param data \r\n     * @param err \r\n     * @param progress \r\n     */\r\n    init(type: EventType, taraget: IEventDispatcher, data?: any, err?: Error, progress: number = 0): void {\r\n        this.type = type;\r\n        this.target = taraget;\r\n        this.data = data;\r\n        this.error = err;\r\n        this.progress = progress;\r\n    }\r\n\r\n    reset(): void {\r\n        this.type = undefined;\r\n        this.target = undefined;\r\n        this.data = null;\r\n        this.error = undefined;\r\n        this.progress = 0;\r\n    }\r\n\r\n    destroy(): boolean {\r\n        this.reset();\r\n        return true;\r\n    }\r\n\r\n    release(): void {\r\n        Pool.release(Event, this);\r\n    }\r\n\r\n    /**\r\n     * \u521B\u5EFA\u4E8B\u4EF6\u5BF9\u8C61\r\n     * @param type\r\n     * @param target\r\n     * @param data \r\n     * @param err \r\n     * @param progress \r\n     * @returns \r\n     */\r\n    static create(type: EventType, target: IEventDispatcher, data?: any, err?: Error, progress?: number): Event {\r\n        let result = Pool.acquire(Event);\r\n        result.init(type, target, data, err, progress);\r\n        return result;\r\n    }\r\n}", "import { IPoolable } from \"../pools/IPoolable\";\r\nimport { Event } from \"./Event\";\r\nimport { EventType } from \"./EventType\";\r\n\r\n\r\n\r\n/**\r\n * \u76D1\u542C\u8005\r\n */\r\nexport class EventListener implements IPoolable {\r\n    /**\r\n     * \u4E8B\u4EF6\u7C7B\u578B\r\n     */\r\n    type?: EventType;\r\n    /**\r\n     * \u4E8B\u4EF6\u56DE\u8C03\u51FD\u6570this\u6307\u9488\r\n     */\r\n    caller: any | null;\r\n    /**\r\n     * \u4E8B\u4EF6\u7684\u56DE\u8C03\u51FD\u6570\r\n     */\r\n    handler?: (e: Event) => void;\r\n    /**\r\n     * \u4E8B\u4EF6\u4F18\u5148\u7EA7\uFF0C\u9ED8\u8BA4\u4E3A255\r\n     */\r\n    priority: number = 255;\r\n\r\n    constructor(type: EventType, caller: any, handler: (e: Event) => void, priority: number = 255) {\r\n        this.type = type;\r\n        this.caller = caller;\r\n        this.handler = handler;\r\n        this.priority = priority;\r\n    }\r\n\r\n    reset(): void {\r\n        this.type = undefined;\r\n        this.caller = undefined;\r\n        this.handler = undefined;\r\n        this.priority = 255;\r\n    }\r\n    \r\n    destroy(): boolean {\r\n        this.reset();\r\n        return true;\r\n    }\r\n\r\n    equal(target: EventListener): boolean {\r\n        if (this.type === target.type && this.caller === target.caller && this.handler === target.handler) {\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    equals(type: EventType, handler: (e: Event) => void, caller: any): boolean {\r\n        if (this.type === type && this.handler === handler && this.caller === caller) {\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n}", "import { TickerManager } from \"../ticker/TickerManager\";\r\nimport { Event } from \"./Event\";\r\nimport { EventListener } from \"./EventListener\";\r\nimport { EventType } from \"./EventType\";\r\nimport { IEventDispatcher } from \"./IEventDispatcher\";\r\n\r\n\r\n\r\n/**\r\n * \u4E8B\u4EF6\u6D3E\u53D1\u5668\r\n */\r\nexport class EventDispatcher implements IEventDispatcher {\r\n\r\n    /**\r\n     * \u5168\u5C40\u4E8B\u4EF6\u6D3E\u53D1\u8D77\r\n     */\r\n    static Main: EventDispatcher = new EventDispatcher();\r\n\r\n    /**\r\n     * \u4E8B\u4EF6\u662F\u5426\u5F02\u6B65\u5904\u7406\r\n     */\r\n    eventAync: boolean = false;\r\n\r\n    /**\r\n     * \u9700\u8981\u6D3E\u53D1\u7684\u4E8B\u4EF6\r\n     */\r\n    private __needEmit: Array<Event> = [];\r\n\r\n    private __listeners: Map<EventType, Array<EventListener>>;\r\n    private __callers: Map<any, Array<EventListener>>;\r\n\r\n    private __target: IEventDispatcher;\r\n\r\n    constructor(target?: IEventDispatcher) {\r\n        this.__target = target ? target : this;\r\n        this.__listeners = new Map<EventType, Array<EventListener>>();\r\n        this.__callers = new Map<any, Array<EventListener>>();\r\n    }\r\n\r\n    /**\r\n     * \u6DFB\u52A0\u4E8B\u4EF6\u76D1\u542C\r\n     * @param type      \u4E8B\u4EF6\u7C7B\u578B\r\n     * @param handler   \u4E8B\u4EF6\u56DE\u8C03\u51FD\u6570\r\n     * @param caller    \u56DE\u8C03\u51FD\u6570this\u6307\u9488\r\n     * @param priority  \u4F18\u5148\u7EA7\r\n     */\r\n    on(type: EventType, handler: (e: Event) => void, caller?: any, priority?: number): void {\r\n        let listeners = this.__listeners.get(type);\r\n        if (!listeners) {\r\n            listeners = [];\r\n            this.__listeners.set(type, listeners);\r\n        }\r\n        //\u68C0\u6D4B\u662F\u5426\u91CD\u590D\r\n        for (const element of listeners) {\r\n            if (element.equals(type, handler, caller)) {\r\n                throw new Error(`\u91CD\u590D\u6DFB\u52A0\u4E8B\u4EF6\u76D1\u542C\uFF1A${type} ${handler} ${caller}`);\r\n            }\r\n        }\r\n        //\u6DFB\u52A0\u4E8B\u4EF6\u76D1\u542C\r\n        const listener = new EventListener(type, handler, caller, priority);\r\n        listeners.push(listener);\r\n        listeners.sort((a, b) => a.priority - b.priority);\r\n        //\u6DFB\u52A0\u5230caller\u5206\u7EC4\r\n        let callerListeners = this.__callers.get(caller);\r\n        if (!callerListeners) {\r\n            callerListeners = [];\r\n            this.__callers.set(caller, callerListeners);\r\n        }\r\n        callerListeners.push(listener);\r\n    }\r\n\r\n    /**\r\n     * \u5220\u9664\u4E8B\u4EF6\u76D1\u542C\r\n     * @param type      \u4E8B\u4EF6\u7C7B\u578B\r\n     * @param handler   \u4E8B\u4EF6\u56DE\u8C03\u51FD\u6570\r\n     * @param caller    \u56DE\u8C03\u51FD\u6570this\u6307\u9488\r\n     * @returns \r\n     */\r\n    off(type: EventType, handler: (e: Event) => void, caller?: any): void {\r\n        let listeners = this.__listeners.get(type);\r\n        if (!listeners) {\r\n            return;\r\n        }\r\n        let index = listeners.findIndex((element) => element.equals(type, handler, caller));\r\n        if (index < 0) {\r\n            return;\r\n        }\r\n        listeners.splice(index, 1);\r\n        //\u4ECEcaller\u5206\u7EC4\u4E2D\u5220\u9664\r\n        let callerListeners = this.__callers.get(caller);\r\n        if (!callerListeners) {\r\n            return;\r\n        }\r\n        index = callerListeners.findIndex((element) => element.equals(type, handler, caller));\r\n        if (index < 0) {\r\n            return;\r\n        }\r\n        callerListeners.splice(index, 1);\r\n    }\r\n\r\n    /**\r\n     * \u5220\u9664\u6307\u5B9A\u5BF9\u8C61\u6240\u6709\u7684\u4E8B\u4EF6\u76D1\u542C\r\n     * @param caller    \r\n     * @returns \r\n     */\r\n    offByCaller(caller: any): void {\r\n        let callerListeners = this.__callers.get(caller);\r\n        if (!callerListeners) {\r\n            return;\r\n        }\r\n        while (callerListeners.length > 0) {\r\n            let listener = callerListeners[0];\r\n            this.off(listener.type!, listener.handler!, listener.caller);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \u5220\u9664\u6240\u6709\u4E8B\u4EF6\u76D1\u542C\r\n     */\r\n    offAllEvent(): void {\r\n        this.__listeners.forEach(list => {\r\n            list.forEach(element => {\r\n                element.destroy();\r\n            });\r\n        });\r\n        this.__listeners.clear();\r\n        this.__callers.clear();\r\n    }\r\n\r\n    /**\r\n     * \u6D3E\u53D1\u4E8B\u4EF6\r\n     * @param type \r\n     * @param data \r\n     * @param err \r\n     * @param progress \r\n     * @param url \r\n     * @returns \r\n     */\r\n    emit(type: EventType, data?: any, err?: Error, progress?: number): void {\r\n        //\u5982\u679C\u6CA1\u4EBA\u5173\u5FC3\u8FD9\u4E2A\u4E8B\u4EF6\r\n        if (this.__listeners.has(type)) {\r\n            return;\r\n        }\r\n        const event = Event.create(type, this.__target, data, err, progress);\r\n        this.__needEmit.push(event);\r\n        if (this.eventAync) {\r\n            TickerManager.callNextFrame(this.__emit, this);\r\n        } else {\r\n            this.__emit();\r\n        }\r\n    }\r\n\r\n    private __emitHelp: Array<Event> = [];\r\n    private __emit(): void {\r\n        this.__emitHelp.push(...this.__needEmit);\r\n        this.__needEmit.splice(0, this.__needEmit.length);\r\n        for (let index = 0; index < this.__emitHelp.length; index++) {\r\n            const event = this.__emitHelp[index];\r\n            //\u6709\u4EBA\u5173\u5FC3\u4E14\u4E8B\u4EF6\u6CA1\u6709\u88AB\u505C\u6B62\r\n            if (this.hasEvent(event.type!) && event.propagationStopped == false) {\r\n                let list: EventListener[] = this.__listeners.get(event.type!)!;\r\n                let listener: EventListener;\r\n                for (let index = 0; index < list.length; index++) {\r\n                    listener = list[index];\r\n                    //\u4E8B\u4EF6\u662F\u5426\u88AB\u505C\u6B62\r\n                    if (event.propagationStopped) {\r\n                        break;\r\n                    }\r\n                    listener.handler.apply(listener.caller, [event]);\r\n                }\r\n            }\r\n            //\u4E8B\u4EF6\u9000\u8FD8\r\n            event.release();\r\n        }\r\n        this.__emitHelp.splice(0, this.__emitHelp.length);\r\n    }\r\n\r\n    hasEvent(type: EventType): boolean {\r\n        return this.__listeners.has(type);\r\n    }\r\n\r\n    hasEventHandler(type: EventType, handler: (e: Event) => void, caller: any): boolean {\r\n        if (this.__listeners.has(type) == false) {\r\n            return false;\r\n        }\r\n        let infoList: EventListener[] = this.__listeners.get(type)!;\r\n        let info: EventListener;\r\n        for (let index = 0; index < infoList.length; index++) {\r\n            info = infoList[index];\r\n            if (info.equals(type, handler, caller)) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    destroy(): boolean {\r\n        if (this.eventAync) {\r\n            TickerManager.clearNextFrame(this.__emit, this);\r\n        }\r\n        this.__needEmit.splice(0, this.__needEmit.length);\r\n        this.__needEmit = undefined;\r\n        this.__listeners.clear();\r\n        this.__listeners = undefined;\r\n        this.__callers.clear();\r\n        this.__callers = undefined;\r\n        this.__target = undefined;\r\n        return true;\r\n    }\r\n}", "import { Event } from \"../events/Event\";\r\nimport { EventDispatcher } from \"../events/EventDispatcher\";\r\n\r\n\r\n/**\r\n * \u5B57\u5178\r\n */\r\nexport class Dictionary<TKey, TValue> extends EventDispatcher {\r\n\r\n    private __map: Map<TKey, TValue>;\r\n    private __list: Array<TValue>;\r\n\r\n    constructor() {\r\n        super();\r\n        this.__map = new Map<TKey, TValue>();\r\n        this.__list = [];\r\n    }\r\n\r\n    /**\r\n     * \u8BBE\u7F6E\r\n     * @param key \r\n     * @param value \r\n     */\r\n    set(key: TKey, value: TValue): void {\r\n        let old: TValue;\r\n        //\u5220\u9664\u8001\u7684\r\n        if (this.__map.has(key)) {\r\n            old = this.__map.get(key);\r\n            const index: number = this.__list.indexOf(old);\r\n            if (index < 0) {\r\n                throw new Error(\"Dictionary\u5185\u90E8\u903B\u8F91\u9519\u8BEF\uFF01\");\r\n            }\r\n            this.__map.delete(key);\r\n            this.__list.splice(index, 1);\r\n            this.emit(Event.REMOVE, old);\r\n        }\r\n        this.__map.set(key, value);\r\n        this.__list.push(value);\r\n        this.emit(Event.ADD, value);\r\n    }\r\n\r\n    /**\r\n     * \u662F\u5426\u62E5\u6709\u6307\u5B9AKEY\u7684\u5143\u7D20\r\n     * @param key \r\n     * @returns \r\n     */\r\n    has(key: TKey): boolean {\r\n        return this.__map.has(key);\r\n    }\r\n\r\n    /**\r\n     * \u83B7\u53D6\u6307\u5B9A\u5143\u7D20\r\n     * @param key \r\n     * @returns \r\n     */\r\n    get(key: TKey): TValue | undefined {\r\n        return this.__map.get(key);\r\n    }\r\n\r\n    /**\r\n     * \u901A\u8FC7\u7D22\u5F15\u83B7\u53D6\u5143\u7D20\r\n     * @param index \r\n     * @returns \r\n     */\r\n    getValue(index: number): TValue | undefined {\r\n        if (index >= this.__list.length) {\r\n            throw new Error(index + \"\u7D22\u5F15\u8D85\u51FA0-\" + this.__list.length + \"\u8303\u56F4\");\r\n        }\r\n        return this.__list![index];\r\n    }\r\n\r\n    /**\r\n     * \u5220\u9664\u6307\u5B9A\u5143\u7D20\r\n     * @param key \r\n     * @returns \r\n     */\r\n    delete(key: TKey): TValue | undefined {\r\n        if (!this.__map.has(key)) {\r\n            return undefined;\r\n        }\r\n        const result = this.__map.get(key)!;\r\n        const index: number = this.__list.indexOf(result);\r\n        if (index < 0) {\r\n            throw new Error(\"Dictionary\u5185\u90E8\u903B\u8F91\u9519\u8BEF\uFF01\");\r\n        }\r\n        this.__list.splice(index, 1);\r\n        this.__map.delete(key);\r\n        //\u6D3E\u53D1\u5220\u9664\u4E8B\u4EF6\r\n        if (this.hasEvent(Event.REMOVE)) {\r\n            this.emit(Event.REMOVE, result);\r\n        }\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * \u6E05\u9664\u6240\u6709\u5143\u7D20\r\n     */\r\n    clear() {\r\n        this.__map.clear();\r\n        this.__list.length = 0;\r\n    }\r\n\r\n    getKeys(result?: Array<TKey>): Array<TKey> {\r\n        result = result || [];\r\n        for (const iterator of this.__map.keys()) {\r\n            result.push(iterator);\r\n        }\r\n        return result;\r\n    }\r\n\r\n    /**\r\n    * \u5143\u7D20\u5217\u8868\r\n    */\r\n    get elements(): Array<TValue> {\r\n        return this.__list!;\r\n    }\r\n\r\n    public get size(): number {\r\n        return this.__map.size;\r\n    }\r\n\r\n    destroy(): boolean {\r\n        if (super.destroy()) {\r\n            this.__map.clear();\r\n            this.__map = undefined;\r\n            this.__list = undefined;\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n}", "import { game } from \"cc\";\r\nimport { ITicker } from \"../ticker/ITicker\";\r\nimport { ITimer } from \"./ITimer\";\r\nimport { TickerManager } from \"../ticker/TickerManager\";\r\n\r\n\r\nexport class TimerImpl implements ITimer, ITicker {\r\n\r\n    private __currentTime: number = 0;\r\n    private __deltaTime: number = 0;\r\n    private __startTime: number = 0;\r\n    constructor() {\r\n        this.reset();\r\n        TickerManager.addTicker(this);\r\n    }\r\n\r\n    reset(time?: number): void {\r\n        if (time) {\r\n            this.__currentTime = time;\r\n        } else {\r\n            //\u5F53\u524D\u65F6\u95F4\u8F6C\u79D2\r\n            this.__currentTime = game.totalTime;\r\n        }\r\n        this.__startTime = this.__currentTime;\r\n    }\r\n\r\n    tick(dt: number): void {\r\n        this.__deltaTime = dt;\r\n        this.__currentTime += dt;\r\n    }\r\n\r\n    get currentTime(): number {\r\n        return this.__currentTime;\r\n    }\r\n\r\n    get absTime(): number {\r\n        return this.__startTime + game.totalTime;\r\n    }\r\n    \r\n    get deltaTime(): number {\r\n        return this.__deltaTime;\r\n    }\r\n}", "import { Injector } from \"../utils/Injector\";\r\nimport { ITimer } from \"./ITimer\";\r\nimport { TimerImpl } from \"./TimerImpl\";\r\n\r\n\r\n\r\n\r\nexport class Timer {\r\n\r\n    static KEY = \"Timer\";\r\n\r\n    private static __serverTime: number = 0;\r\n    private static __lastTime: number = 0;\r\n\r\n    /**\r\n     * \u670D\u52A1\u5668\u65F6\u95F4(\u6BEB\u79D2)\r\n     */\r\n    static get serverTime(): number {\r\n        let d = this.currentTime - this.__lastTime;\r\n        if (d) {\r\n            this.__serverTime += d;\r\n        }\r\n        return this.__serverTime;\r\n    }\r\n\r\n    /**\r\n     * \u5F53\u524D\u65F6\u95F4(\u6BEB\u79D2)\r\n     */\r\n    static get currentTime(): number {\r\n        return this.impl.currentTime;\r\n    }\r\n\r\n    /**\r\n     * \u7EDD\u5BF9\u65F6\u95F4(\u6BEB\u79D2),\u6CE8\u610F\u6548\u7387\u8F83\u5DEE\uFF0C\u4E0D\u63A8\u8350\u4F7F\u7528\uFF01\r\n     */\r\n    static get absTime(): number {\r\n        return this.impl.absTime;\r\n    }\r\n\r\n    /**\r\n     * \u91CD\u65B0\u6821\u51C6\r\n     * @param time  \u65F6\u95F4\u8D77\u70B9\uFF0C\u5982\u679C\u4E0D\u8BBE\u7F6E\u5219\u83B7\u53D6\u7CFB\u7EDF\u5F53\u524D\u65F6\u95F4\u70B9\r\n     */\r\n    static reset(time?: number): void {\r\n        this.impl.reset(time);\r\n    }\r\n\r\n    private static __impl: ITimer;\r\n    private static get impl(): ITimer {\r\n        if (this.__impl == null) {\r\n            this.__impl = Injector.getInject(this.KEY);\r\n        }\r\n        if (this.__impl == null) {\r\n            this.__impl = new TimerImpl();\r\n        }\r\n        return this.__impl;\r\n    }\r\n}", "import { Dictionary } from \"../../containers/Dictionary\";\r\nimport { TickerManager } from \"../../ticker/TickerManager\";\r\nimport { Timer } from \"../../timer/Timer\";\r\nimport { ResRef } from \"../ResRef\";\r\nimport { IResource } from \"./IResource\";\r\nimport { ResourceManager } from \"./ResourceManager\";\r\n\r\n\r\n/**\r\n * \u8D44\u6E90\u7BA1\u7406\u5668\u9ED8\u8BA4\u5B9E\u73B0\r\n */\r\nexport class ResourceManagerImpl {\r\n    /**\r\n     * \u8D44\u6E90\r\n     */\r\n    protected __resDic: Dictionary<string, IResource> = new Dictionary<string, IResource>();\r\n    /**\r\n     * \u7B49\u5F85\u9500\u6BC1\u7684\u8D44\u6E90\r\n     */\r\n    protected _waitDestroy: Array<IResource> = [];\r\n\r\n    private __lastTime: number = 0;\r\n\r\n    constructor() {\r\n        TickerManager.addTicker(this);\r\n    }\r\n\r\n    tick(dt: number): void {\r\n        if (!ResourceManager.AUTO_GC) {\r\n            return;\r\n        }\r\n        let currentTime = Timer.currentTime;\r\n        let d = currentTime - this.__lastTime\r\n        if (d < ResourceManager.GC_CHECK_TIME) {\r\n            return;\r\n        }\r\n        this.__lastTime = currentTime;\r\n        this.gc();\r\n    }\r\n    \r\n    addRes(value: IResource): void {\r\n        if (this.__resDic.has(value.key)) {\r\n            throw new Error(\"\u91CD\u590D\u6DFB\u52A0\u8D44\u6E90\uFF01\");\r\n        }\r\n        this.__resDic.set(value.key, value);\r\n        //\u6807\u8BB0\u4E3A\u5F85\u5220\u9664\r\n        this._waitDestroy.push(value);\r\n        value.lastOpTime = Timer.currentTime;\r\n    }\r\n\r\n    hasRes(key: string): boolean {\r\n        return this.__resDic.has(key);\r\n    }\r\n\r\n    getRes(key: string): IResource | undefined {\r\n        return this.__resDic.get(key);\r\n    }\r\n\r\n    addRef(key: string, refKey?: string): ResRef {\r\n        if (!this.__resDic.has(key)) {\r\n            throw new Error(\"\u672A\u627E\u5230\u8D44\u6E90\uFF1A\" + key);\r\n        }\r\n        let res: IResource = this.__resDic.get(key)!;\r\n        //\u5982\u679C\u5728\u5F85\u5220\u9664\u5217\u8868\u4E2D\r\n        let index: number = this._waitDestroy.indexOf(res);\r\n        if (index >= 0) {\r\n            this._waitDestroy.splice(index, 1);\r\n        }\r\n        //\u66F4\u65B0\u64CD\u4F5C\u65F6\u95F4\r\n        res.lastOpTime = Timer.currentTime;\r\n        return res.addRef(refKey);\r\n    }\r\n\r\n    removeRef(value: ResRef): void {\r\n        if (!this.__resDic.has(value.key)) {\r\n            throw new Error(\"\u672A\u627E\u5230\u8D44\u6E90\uFF1A\" + value.key);\r\n        }\r\n        let res: IResource = this.__resDic.get(value.key)!;\r\n        res.removeRef(value);\r\n        if (res.refLength == 0) {\r\n            //\u653E\u5165\u5F85\u5220\u9664\u5217\u8868\r\n            this._waitDestroy.push(res);\r\n        }\r\n        res.lastOpTime = Timer.currentTime;\r\n    }\r\n\r\n    gc(ignoreTime?: boolean): void {\r\n        let res: IResource;\r\n        let currentTime: number = Timer.currentTime;\r\n        for (let index = 0; index < this._waitDestroy.length; index++) {\r\n            res = this._waitDestroy[index];\r\n            if (res.refCount > 0) {\r\n                continue;\r\n            }\r\n            //\u5982\u679C\u5FFD\u7565\u65F6\u95F4\u673A\u5236\r\n            if (ignoreTime == true) {\r\n                this._waitDestroy.splice(index, 1);\r\n                this.destroyRes(res);\r\n                index--;\r\n            } else if (currentTime - res.lastOpTime > ResourceManager.GC_TIME) {//\u8D85\u8FC7\u5141\u8BB8\u7684\u65F6\u95F4\u5C31\u56DE\u6536\r\n                this._waitDestroy.splice(index, 1);\r\n                this.destroyRes(res);\r\n                index--;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \u9500\u6BC1\r\n     * @param value \r\n     */\r\n    protected destroyRes(value: IResource): void {\r\n        this.__resDic.delete(value.key);\r\n        value.destroy();\r\n    }\r\n\r\n    get resList(): Array<IResource> {\r\n        return this.__resDic.elements;\r\n    }\r\n}", "import { Injector } from \"../../utils/Injector\";\r\nimport { IResourceManager } from \"./IResourceManager\";\r\nimport { ResRef } from \"../ResRef\";\r\nimport { IResource } from \"./IResource\";\r\nimport { ResourceManagerImpl } from \"./ResourceManagerImpl\";\r\n\r\n\r\n\r\nexport class ResourceManager {\r\n\r\n    static KEY = \"ResourceManager\";\r\n\r\n    /**\r\n     * GC\u68C0\u67E5\u65F6\u95F4\u95F4\u9694(\u6BEB\u79D2)\r\n     */\r\n    static GC_CHECK_TIME: number = 5000;\r\n\r\n    /**\r\n     * \u8D44\u6E90\u4FDD\u7559\u957F\u65F6\u95F4(\u6BEB\u79D2)GC\r\n     */\r\n    static GC_TIME: number = 15000;\r\n    \r\n    /**\r\n     * \u81EA\u52A8\u6E05\u7406\r\n     */\r\n    static AUTO_GC: boolean = true;\r\n\r\n    \r\n    /**\r\n     * \u6DFB\u52A0\u4E00\u4E2A\u8D44\u6E90\r\n     * @param value\r\n     */\r\n    static addRes(value: IResource): void {\r\n        this.impl.addRes(value);\r\n    }\r\n\r\n    /**\r\n     * \u662F\u5426\u5305\u542B\u8BE5\u8D44\u6E90\r\n     * @param key \r\n     */\r\n    static hasRes(key: string): boolean {\r\n        return this.impl.hasRes(key);\r\n    }\r\n\r\n    /**\r\n     * \u83B7\u53D6\u8D44\u6E90\uFF08\u5185\u90E8\u63A5\u53E3\uFF09\r\n     * @param key \r\n     * @returns \r\n     */\r\n    static getRes(key: string): IResource | undefined {\r\n        return this.impl.getRes(key);\r\n    }\r\n\r\n    /**\r\n     * \u6DFB\u52A0\u5E76\u8FD4\u56DE\u4E00\u4E2A\u8D44\u6E90\u5F15\u7528\r\n     * @param key \r\n     * @param refKey \r\n     */\r\n    static addRef(key: string, refKey?: string): ResRef {\r\n        return this.impl.addRef(key, refKey);\r\n    }\r\n\r\n    /**\r\n     * \u5220\u9664\u4E00\u4E2A\u8D44\u6E90\u5F15\u7528\r\n     * @param value \r\n     */\r\n    static removeRef(value: ResRef): void {\r\n        return this.impl.removeRef(value);\r\n    }\r\n\r\n    /**\r\n     * \u8D44\u6E90\u6E05\u7406\r\n     */\r\n    static gc(ignoreTime?: boolean): void {\r\n        return this.impl.gc(ignoreTime);\r\n    }\r\n\r\n    /**\r\n     * \u8D44\u6E90\u5217\u8868\r\n     * @returns \r\n     */\r\n    static get resList(): Array<IResource> {\r\n        return this.impl.resList;\r\n    }\r\n\r\n    private static __impl: IResourceManager;\r\n    private static get impl(): IResourceManager {\r\n        if (this.__impl == null) {\r\n            this.__impl = Injector.getInject(this.KEY);\r\n        }\r\n        if (this.__impl == null) {\r\n            this.__impl = new ResourceManagerImpl();\r\n        }\r\n        return this.__impl;\r\n    }\r\n}", "import { Asset, assetManager, instantiate, isValid, Node, Prefab } from \"cc\";\r\nimport { Logger } from \"../../loggers/Logger\";\r\nimport { Pool } from \"../../pools/Pool\";\r\nimport { ResRef } from \"../ResRef\";\r\nimport { IResource } from \"./IResource\";\r\n\r\n\r\n\r\n\r\n/**\r\n * \u8D44\u6E90\r\n */\r\nexport class Resource implements IResource {\r\n    /**\r\n     * \u8D44\u6E90\u5168\u5C40\u552F\u4E00KEY\r\n     */\r\n    key: string;\r\n    /**\r\n     * \u6700\u540E\u64CD\u4F5C\u7684\u65F6\u95F4\u7535\r\n     */\r\n    lastOpTime: number = 0;\r\n    /**\r\n     * \u8D44\u6E90\u5185\u5BB9\r\n     */\r\n    content: any;\r\n\r\n    private __refList: Array<ResRef>;\r\n\r\n    constructor() {\r\n        this.__refList = [];\r\n    }\r\n\r\n    addRef(refKey?: string): ResRef {\r\n        let ref = Pool.acquire(ResRef);\r\n        ref.key = this.key;\r\n        ref.refKey = refKey ? refKey : \"\";\r\n        //cocos\u5185\u7F6E\u8D44\u6E90\r\n        if (this.content instanceof Asset) {\r\n            //\u5982\u679C\u662F\u9884\u5236\u4F53\r\n            if (this.content instanceof Prefab) {\r\n                ref.content = instantiate(this.content);\r\n            } else {\r\n                ref.content = this.content;\r\n            }\r\n            this.content.addRef();\r\n        } else {\r\n            ref.content = this.content;\r\n        }\r\n        this.__refList.push(ref);\r\n        return ref;\r\n    }\r\n\r\n    removeRef(value: ResRef): void {\r\n        let index = this.__refList.indexOf(value);\r\n        if (index == -1) {\r\n            throw new Error(\"\u8D44\u6E90\u5F15\u7528\u4E0D\u5B58\u5728\");\r\n        }\r\n        //cocos\u5185\u7F6E\u8D44\u6E90\r\n        if (this.content instanceof Asset) {\r\n            //\u5982\u679C\u662F\u9884\u5236\u4F53\r\n            if (this.content instanceof Prefab) {\r\n                let node: Node = value.content;\r\n                if (isValid(node)) {\r\n                    node.destroy();\r\n                }\r\n            }\r\n            this.content.decRef();\r\n        }\r\n        this.__refList.splice(index, 1);\r\n        Pool.release(ResRef, value);\r\n    }\r\n\r\n    destroy(): boolean {\r\n        if (this.refCount > 0 || this.refLength > 0) {\r\n            throw new Error(\"\u53D1\u73B0\u9500\u6BC1\u8D44\u6E90\u65F6\u5F15\u7528\u6570\u91CF\u4E0D\u4E3A0\");\r\n        }\r\n        //\u81EA\u8EAB\u5F15\u7528\u8BA1\u6570\r\n        if (this.content instanceof Asset) {\r\n            this.content.decRef();\r\n            if (this.content.refCount <= 0) {\r\n                Logger.log(\"ReleaseAsset=>\" + this.key, Logger.TYPE.RES);\r\n                assetManager.releaseAsset(this.content);\r\n            }\r\n        } else {\r\n            Logger.log(\"DestroyAsset=>\" + this.key, Logger.TYPE.RES);\r\n            if (this.content[\"destroy\"]) {\r\n                this.content[\"destroy\"]();\r\n            }\r\n        }\r\n        this.key = undefined;\r\n        this.__refList = undefined;\r\n        this.content = undefined;\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * \u8D44\u6E90\u5F15\u7528\u5217\u8868\r\n     */\r\n    get refList(): ResRef[] {\r\n        return this.__refList;\r\n    }\r\n\r\n    /**\r\n     * \u5F15\u7528\u6570\u91CF\r\n     */\r\n    get refCount(): number {\r\n        if (this.content instanceof Asset) {\r\n            return this.content.refCount - 1;\r\n        }\r\n        return this.__refList.length;\r\n    }\r\n\r\n    /**\r\n     * \u5F15\u7528\u5217\u8868\u957F\u5EA6\r\n     */\r\n    get refLength(): number {\r\n        return this.__refList.length;\r\n    }\r\n}", "import { Dictionary } from \"../containers/Dictionary\";\r\nimport { ILogger } from \"./ILogger\";\r\nimport { Logger } from \"./Logger\";\r\n\r\n\r\nexport class LoggerImpl implements ILogger {\r\n\r\n    private __logs: Dictionary<string, Array<string>>\r\n    /**\r\n     * \u6807\u8BB0\u662F\u5426\u663E\u793A\u67D0\u7C7B\u578B\u7684\u65E5\u5FD7\uFF0C\u9ED8\u8BA4\u4E3Afalse\u4E0D\u663E\u793A\r\n     */\r\n    private __showed: Map<string, boolean>\r\n    /**\r\n     * \u6807\u8BB0\u662F\u5426\u4FDD\u5B58\u67D0\u7C7B\u578B\u7684\u65E5\u5FD7\uFF0C\u9ED8\u8BA4\u4E3Afalse\u4E0D\u4FDD\u5B58\r\n     */\r\n    private __saves: Map<string, boolean>\r\n\r\n    constructor() {\r\n        this.__logs = new Dictionary<string, Array<string>>();\r\n        this.__showed = new Map<string, boolean>();\r\n        this.__saves = new Map<string, boolean>();\r\n        this.__showed.set(Logger.TYPE.ALL, true);\r\n        this.__saves.set(Logger.TYPE.ALL, false);\r\n    }\r\n\r\n    /**\r\n     * \u8BBE\u7F6E\u663E\u793A\u8FC7\u6EE4\r\n     * @param key \r\n     * @param isOpen \r\n     */\r\n    show(key: string, isOpen: boolean) {\r\n        this.__showed.set(key, isOpen);\r\n    }\r\n\r\n    /**\r\n     * \u8BBE\u7F6E\u4FDD\u5B58\u8FC7\u6EE4\r\n     * @param key \r\n     * @param isSave \r\n     */\r\n    save(key: string, isSave: boolean) {\r\n        this.__saves.set(key, isSave);\r\n    }\r\n\r\n    /**\r\n     * \u83B7\u53D6\u5DF2\u4FDD\u5B58\u7684\u65E5\u5FD7\r\n     * @param type \r\n     * @returns \r\n     */\r\n    getLogs(type?: string): Array<string> | undefined {\r\n        if (type == undefined || type == null) {\r\n            type = Logger.TYPE.ALL;\r\n        }\r\n        if (this.__logs.has(type)) {\r\n            return this.__logs.get(type)!;\r\n        }\r\n        return undefined;\r\n    }\r\n\r\n    private __save(type: string, logType: string, msg: string): string {\r\n        let data: string = \"[\" + type.toUpperCase() + \"]\" + logType + \": \" + msg;\r\n        let list: Array<string>;\r\n        //\u662F\u5426\u9700\u8981\u4FDD\u5B58\u8BE5\u7C7B\u578B\u7684\u65E5\u5FD7\r\n        if (this.__saves.has(type)) {\r\n            if (!this.__logs.has(type)) {\r\n                list = [];\r\n                this.__logs.set(type, list);\r\n            } else {\r\n                list = this.__logs.get(type)!;\r\n            }\r\n            //\u68C0\u6D4B\u662F\u5426\u8D85\u51FA\u6700\u5927\u4FDD\u5B58\u6761\u6570\r\n            if (list.length >= Logger.MaxCount) {\r\n                list.unshift();\r\n            }\r\n            list.push(data);\r\n        }\r\n        //\u4FDD\u5B58\u5230all\r\n        if (!this.__logs.has(Logger.TYPE.ALL)) {\r\n            list = [];\r\n            this.__logs.set(Logger.TYPE.ALL, list);\r\n        } else {\r\n            list = this.__logs.get(Logger.TYPE.ALL)!;\r\n        }\r\n        if (list.length >= Logger.MaxCount) {\r\n            list.unshift();//\u5220\u9664\u6700\u9876\u4E0A\u7684\u90A3\u6761\r\n        }\r\n        list.push(data);\r\n        return data;\r\n    }\r\n\r\n    private isShow(type: string): boolean {\r\n        let isAll = this.__showed.has(Logger.TYPE.ALL) ? this.__showed.get(Logger.TYPE.ALL)! : false;\r\n        let isOpen = this.__showed.has(type) ? this.__showed.get(type)! : false;\r\n        return isAll || isOpen;\r\n    }\r\n\r\n    log(msg: any, type?: string): void {\r\n        type = type || Logger.TYPE.ALL;\r\n        let data = this.__save(type, \"Log\", msg);\r\n        if (this.isShow(type)) {\r\n            console.log(data);\r\n        }\r\n    }\r\n\r\n    error(msg: any, type?: string): void {\r\n        type = type || Logger.TYPE.ALL;\r\n        let data = this.__save(type, \"Error\", msg);\r\n        if (this.isShow(type)) {\r\n            console.error(data);\r\n        }\r\n    }\r\n\r\n    warn(msg: any, type?: string): void {\r\n        type = type || Logger.TYPE.ALL;\r\n        let data = this.__save(type, \"Warn\", msg);\r\n        if (this.isShow(type)) {\r\n            console.warn(data);\r\n        }\r\n    }\r\n\r\n    info(msg: any, type?: string): void {\r\n        type = type || Logger.TYPE.ALL;\r\n        let data = this.__save(type, \"Info\", msg);\r\n        if (this.isShow(type)) {\r\n            console.info(data);\r\n        }\r\n    }\r\n}", "import { Injector } from \"../utils/Injector\";\r\nimport { ILogger } from \"./ILogger\";\r\nimport { LoggerImpl } from \"./LoggerImpl\";\r\n\r\n\r\nenum LogType {\r\n    ALL = \"all\",\r\n    NET = \"net\",\r\n    RES = \"res\",\r\n    Module = \"module\",\r\n}\r\n\r\n\r\n/**\r\n * \u65E5\u5FD7\u7CFB\u7EDF\r\n */\r\nexport class Logger {\r\n\r\n    /**\r\n     * \u65E5\u5FD7\u7C7B\u578B\r\n     */\r\n    static TYPE: typeof LogType = LogType;\r\n\r\n    static KEY: string = \"Logger\";\r\n    /**\r\n     * \u6700\u5927\u4FDD\u5B58\u6761\u6570\r\n     */\r\n    static MaxCount: number = 1000;\r\n\r\n    /**\r\n     * \u8BBE\u7F6E\u663E\u793A\u8FC7\u6EE4\r\n     * @param key \r\n     * @param isOpen \r\n     */\r\n    static show(type: string, isOpen: boolean) {\r\n        this.impl.show(type, isOpen);\r\n    }\r\n\r\n    /**\r\n     * \u8BBE\u7F6E\u4FDD\u5B58\u8FC7\u6EE4\r\n     * @param type \r\n     * @param isSave \r\n     */\r\n    static save(type: string, isSave: boolean): void {\r\n        this.impl.save(type, isSave);\r\n    }\r\n\r\n    /**\r\n     * \u83B7\u53D6\u5DF2\u4FDD\u5B58\u7684\u65E5\u5FD7\r\n     * @param type \r\n     * @returns \r\n     */\r\n    static getLogs(type?: string): Array<string> | undefined {\r\n        return this.impl.getLogs(type);\r\n    }\r\n\r\n    static log(msg: any, type?: string): void {\r\n        this.impl.log(msg, type);\r\n    }\r\n\r\n    static error(msg: any, type?: string) {\r\n        this.impl.error(msg, type);\r\n    }\r\n\r\n    static warn(msg: any, type?: string) {\r\n        this.impl.warn(msg, type);\r\n    }\r\n\r\n    static info(msg: any, type?: string) {\r\n        this.impl.info(msg, type);\r\n    }\r\n\r\n    private static __impl: ILogger;\r\n    private static get impl(): ILogger {\r\n        if (this.__impl == null) {\r\n            this.__impl = Injector.getInject(this.KEY);\r\n        }\r\n        if (this.__impl == null) {\r\n            this.__impl = new LoggerImpl();\r\n        }\r\n        return this.__impl;\r\n    }\r\n}", "import { IPoolable } from \"../pools/IPoolable\";\r\n\r\n\r\n\r\n\r\nexport class ResRef implements IPoolable {\r\n\r\n    /**\r\n     * \u8D44\u6E90\u5168\u5C40\u552F\u4E00KEY\r\n     */\r\n    key: string = \"\";\r\n    /**\r\n     * \u8C01\u5F15\u7528\u7684\r\n     */\r\n    refKey: string = \"\";\r\n    /**\r\n     * \u8D44\u6E90\u5185\u5BB9\r\n     */\r\n    content: any;\r\n\r\n    private __isDisposed: boolean = false;\r\n\r\n    constructor() {\r\n\r\n    }\r\n\r\n    reset(): void {\r\n        this.key = \"\";\r\n        this.refKey = \"\";\r\n        this.content = null;\r\n        this.__isDisposed = false;\r\n    }\r\n\r\n    /**\r\n     * \u662F\u5426\u5DF2\u7ECF\u91CA\u653E\r\n     */\r\n    get isDisposed(): boolean {\r\n        return this.__isDisposed;\r\n    }\r\n\r\n    /**\r\n     * \u91CA\u653E\r\n     */\r\n    dispose(): void {\r\n        if (this.__isDisposed) {\r\n            throw new Error(\"\u91CD\u590D\u91CA\u653E\u8D44\u6E90\u5F15\u7528\");\r\n        }\r\n        this.__isDisposed = true;\r\n        // ResourceManager.removeRef(this);\r\n    }\r\n\r\n    /**\r\n     * \u5F7B\u5E95\u9500\u6BC1(\u5185\u90E8\u63A5\u53E3\uFF0C\u8BF7\u52FF\u8C03\u7528)\r\n     */\r\n    destroy(): boolean {\r\n        this.reset();\r\n        return true;\r\n    }\r\n}", "import { Dictionary } from \"../../containers/Dictionary\";\r\nimport { Event } from \"../../events/Event\";\r\nimport { Logger } from \"../../loggers/Logger\";\r\nimport { Res } from \"../../res/Res\";\r\nimport { ResURL } from \"../../res/ResURL\";\r\nimport { ITicker } from \"../../ticker/ITicker\";\r\nimport { TickerManager } from \"../../ticker/TickerManager\";\r\nimport { ILoader } from \"./ILoader\";\r\nimport { LoaderManager } from \"./LoaderManager\";\r\n\r\n\r\n\r\n/**\r\n * \u52A0\u8F7D\u961F\u5217\r\n */\r\nexport class LoaderQueue implements ITicker {\r\n\r\n    /**\r\n     * \u52A0\u8F7D\u4E2D\r\n     */\r\n    private running: Dictionary<string, ILoader> = new Dictionary<string, ILoader>();\r\n\r\n    /**\r\n     * \u7B49\u5F85\u52A0\u8F7D\r\n     */\r\n    private waiting: Dictionary<string, ResURL> = new Dictionary<string, ResURL>();\r\n\r\n    /**\r\n     * \u5BF9\u8C61\u6C60\r\n     */\r\n    private pool: Map<any, Array<ILoader>> = new Map<any, Array<ILoader>>();\r\n\r\n    constructor() {\r\n        TickerManager.addTicker(this);\r\n    }\r\n\r\n    tick(dt: number): void {\r\n        while (this.running.size < Res.MAX_LOADER_THREAD && this.waiting.size > 0) {\r\n            //\u83B7\u53D6\u9700\u8981\u52A0\u8F7D\u7684\u5185\u5BB9\r\n            const url = this.waiting.elements[0];\r\n            const urlKey = Res.url2Key(url);\r\n            this.waiting.delete(urlKey);\r\n            this.__load(url, urlKey);\r\n        }\r\n    }\r\n\r\n    private __load(url: ResURL, urlKey: string): void {\r\n        let loader: ILoader;\r\n        let loaderClass: new () => ILoader;\r\n        let type: any;\r\n        if (typeof url == \"string\") {\r\n            type = \"string\";\r\n        } else {\r\n            type = url.type;\r\n        }\r\n        let list = this.pool.get(type);\r\n        if (list == null) {\r\n            list = [];\r\n            this.pool.set(type, list);\r\n        }\r\n        if (list.length > 0) {\r\n            loader = list.shift()!;\r\n        } else {\r\n            if (typeof url == \"string\") {\r\n                loaderClass = Res.getLoader(\"string\");\r\n            } else {\r\n                loaderClass = Res.getLoader(url.type);\r\n            }\r\n            loader = new loaderClass();\r\n        }\r\n        if (loader != null) {\r\n            this.running.set(urlKey, loader);\r\n            this.__addEvent(loader);\r\n            Logger.log(\"Start Load:\" + Res.url2Key(url), Logger.TYPE.RES);\r\n            loader.load(url);\r\n        }\r\n    }\r\n\r\n    private __addEvent(target: ILoader): void {\r\n        target.on(Event.COMPLETE, this.__eventHandler, this);\r\n        target.on(Event.ERROR, this.__eventHandler, this);\r\n        target.on(Event.PROGRESS, this.__eventHandler, this);\r\n    }\r\n\r\n    private __eventHandler(evt: Event): void {\r\n        let target: ILoader = evt.target as ILoader;\r\n        if (evt.type == Event.PROGRESS) {\r\n            LoaderManager.childProgress(evt.data, evt.progress);\r\n            return;\r\n        }\r\n        //\u5220\u9664\u6240\u6709\u4E8B\u4EF6\u76D1\u542C\r\n        target.offAllEvent();\r\n        //\u4ECE\u8FD0\u884C\u5217\u8868\u4E2D\u5220\u9664\r\n        this.running.delete(Res.url2Key(evt.data));\r\n        if (evt.type == Event.ERROR) {\r\n            Logger.log(\"Load Error:\" + Res.url2Key(evt.data) + \" e: \" + evt.error.message, Logger.TYPE.RES);\r\n            LoaderManager.childError(evt.data, evt.error!);\r\n            return;\r\n        }\r\n        if (evt.type == Event.COMPLETE) {\r\n            Logger.log(\"Load Complete:\" + Res.url2Key(evt.data), Logger.TYPE.RES);\r\n            LoaderManager.childComplete(evt.data);\r\n            //\u91CD\u7F6E\u5E76\u56DE\u6536\r\n            target.reset();\r\n            let type: any;\r\n            if (typeof evt.data == \"string\") {\r\n                type = \"string\";\r\n            } else {\r\n                type = evt.data.type;\r\n            }\r\n            let list = this.pool.get(type);\r\n            if (list == null) {\r\n                list = [];\r\n                this.pool.set(type, list);\r\n            }\r\n            list.push(target);\r\n        }\r\n    }\r\n\r\n    load(url: ResURL): void {\r\n        const urlKey = Res.url2Key(url);\r\n        if (typeof url != \"string\" && url.isSub) {\r\n            if (this.waiting.has(urlKey)) {\r\n                this.waiting.delete(urlKey);\r\n            }\r\n            if (!this.running.has(urlKey)) {\r\n                this.__load(url, urlKey);\r\n            }\r\n            return;\r\n        }\r\n        //\u5DF2\u7ECF\u5728\u7B49\u5F85\u5217\u8868\u4E2D\r\n        if (this.waiting.has(urlKey)) {\r\n            return;\r\n        }\r\n        //\u52A0\u8F7D\u4E2D\r\n        if (this.running.has(urlKey)) {\r\n            return;\r\n        }\r\n        //\u52A0\u5165\u7B49\u5F85\u5217\u8868\r\n        this.waiting.set(urlKey, url);\r\n    }\r\n\r\n    private static __instance: LoaderQueue;\r\n    static get single(): LoaderQueue {\r\n        if (LoaderQueue.__instance == null) {\r\n            LoaderQueue.__instance = new LoaderQueue();\r\n        }\r\n        return LoaderQueue.__instance;\r\n    }\r\n}", "\r\nimport { Res } from \"../Res\";\r\nimport { ResourceManager } from \"../resources/ResourceManager\";\r\nimport { ResRequest } from \"../ResRequest\";\r\nimport { ResURL } from \"../ResURL\";\r\nimport { ILoaderManager } from \"./ILoaderManager\";\r\nimport { LoaderQueue } from \"./LoaderQueue\";\r\n\r\n\r\nexport class LoaderManagerImpl implements ILoaderManager {\r\n\r\n    private __requests: Map<string, Array<ResRequest>> = new Map<string, Array<ResRequest>>();\r\n\r\n    constructor() {\r\n\r\n    }\r\n\r\n    /**\r\n     * \u52A0\u8F7D\r\n     * @param url \r\n     * @param refKey \r\n     * @param cb \r\n     * @param progress \r\n     * @returns \r\n     */\r\n    load(request: ResRequest): void {\r\n        if (request.urls.length == 0) {\r\n            console.error(\"urls is empty!\");\r\n            return;\r\n        }\r\n        this.__addReqeuset(request);\r\n        for (let index = 0; index < request.urls.length; index++) {\r\n            const url = request.urls[index];\r\n            const urlKey = Res.url2Key(url);\r\n            //\u5982\u679C\u5DF2\u7ECF\u52A0\u8F7D\u5B8C\u6210\r\n            if (ResourceManager.hasRes(urlKey)) {\r\n                this.childComplete(url);\r\n            } else {\r\n                LoaderQueue.single.load(url);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \u5378\u8F7D\r\n     * @param request \r\n     */\r\n    unload(request: ResRequest): void {\r\n        this.__deleteReqeuset(request);\r\n    }\r\n\r\n    childComplete(url: ResURL): void {\r\n        const urlKey: string = Res.url2Key(url);\r\n        let list = this.__requests.get(urlKey);\r\n        if (list) {\r\n            for (let index = 0; index < list.length; index++) {\r\n                const request = list[index];\r\n                request.childComplete(url);\r\n            }\r\n            list.splice(0, list.length);\r\n        }\r\n        this.__requests.delete(urlKey);\r\n    }\r\n\r\n    childError(url: ResURL, err: Error): void {\r\n        const urlKey: string = Res.url2Key(url);\r\n        let rlist = this.__requests.get(urlKey);\r\n        if (rlist) {\r\n            //\u590D\u5236\r\n            let list = rlist.concat();\r\n            for (let index = 0; index < list.length; index++) {\r\n                const request = list[index];\r\n                //\u901A\u77E5\u6240\u6709\u76F8\u5173\u8BF7\u6C42\u5931\u8D25\r\n                request.childError(err);\r\n                this.__deleteReqeuset(request);\r\n            }\r\n        }\r\n        this.__requests.delete(urlKey);\r\n    }\r\n\r\n    childProgress(url: ResURL, progress: number): void {\r\n        const urlKey: string = Res.url2Key(url);\r\n        let list = this.__requests.get(urlKey);\r\n        if (list) {\r\n            for (let index = 0; index < list.length; index++) {\r\n                const request = list[index];\r\n                request.childProgress(url, progress);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \u6DFB\u52A0\r\n     * @param request \r\n     */\r\n    private __addReqeuset(request: ResRequest): void {\r\n        let list: Array<ResRequest>;\r\n        for (let index = 0; index < request.urls.length; index++) {\r\n            const url = request.urls[index];\r\n            const urlKey = Res.url2Key(url);\r\n            if (this.__requests.has(urlKey)) {\r\n                list = this.__requests.get(urlKey)!;\r\n            } else {\r\n                list = [];\r\n                this.__requests.set(urlKey, list);\r\n            }\r\n            list.push(request);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \u5220\u9664\r\n     * @param request \r\n     */\r\n    private __deleteReqeuset(request: ResRequest): void {\r\n        if (!request.urls || request.urls.length == 0) return;\r\n        let list: Array<ResRequest>;\r\n        let findex: number = 0;\r\n        //\u904D\u5386\u5F53\u524D\u8BF7\u6C42\u7684\u6240\u6709\u8D44\u6E90\r\n        for (let i = 0; i < request.urls.length; i++) {\r\n            const url = request.urls[i];\r\n            const urlKey = Res.url2Key(url);\r\n            //\u4ECE\u5217\u8868\u4E2D\u627E\u51FA\u5E76\u5220\u9664\r\n            if (!this.__requests.has(urlKey)) {\r\n                continue;\r\n            }\r\n            list = this.__requests.get(urlKey)!;\r\n            if (!list || list.length == 0) {\r\n                continue;\r\n            }\r\n            findex = list.indexOf(request);\r\n            if (findex >= 0) {\r\n                list.splice(findex, 1);\r\n            }\r\n        }\r\n    }\r\n}", "import { Injector } from \"../../utils/Injector\";\r\nimport { ResRequest } from \"../ResRequest\";\r\nimport { ResURL } from \"../ResURL\";\r\nimport { ILoaderManager } from \"./ILoaderManager\";\r\nimport { LoaderManagerImpl } from \"./LoaderManagerImpl\";\r\n\r\n\r\n\r\nexport class LoaderManager {\r\n\r\n    static KEY = \"LoaderManager\";\r\n\r\n    /**\r\n     * \u52A0\u8F7D\u8D44\u6E90\r\n     * @param reqeust \r\n     */\r\n    static load(reqeust:ResRequest):void {\r\n        this.impl.load(reqeust);\r\n    }\r\n\r\n    /**\r\n     * \u5378\u8F7D\r\n     * @param request \r\n     */\r\n    static unload(request: ResRequest): void {\r\n        this.impl.unload(request);\r\n    }\r\n\r\n    static childComplete(url: ResURL): void {\r\n        this.impl.childComplete(url);\r\n    }\r\n\r\n    static childError(url: ResURL, err: Error): void {\r\n        this.impl.childError(url, err);\r\n    }\r\n\r\n    static childProgress(url: ResURL, progress: number): void {\r\n        this.impl.childProgress(url, progress);\r\n    }\r\n\r\n    private static __impl: ILoaderManager;\r\n    private static get impl(): ILoaderManager {\r\n        if (this.__impl == null) {\r\n            this.__impl = Injector.getInject(this.KEY);\r\n        }\r\n        if (this.__impl == null) {\r\n            this.__impl = new LoaderManagerImpl();\r\n        }\r\n        return this.__impl;\r\n    }\r\n}", "import { Pool } from \"../pools/Pool\";\r\nimport { LoaderManager } from \"./loaders/LoaderManager\";\r\nimport { Res } from \"./Res\";\r\nimport { ResourceManager } from \"./resources/ResourceManager\";\r\nimport { ResRef } from \"./ResRef\";\r\nimport { ResURL } from \"./ResURL\";\r\n\r\n\r\nexport enum State {\r\n    ERROR,\r\n    SUCCESS,\r\n    LOADING,\r\n    POOL,\r\n}\r\n\r\n\r\n/**\r\n * \u8D44\u6E90\u8BF7\u6C42\r\n * @example\r\n * \r\n * if(this.request){\r\n *     this.request.dispose();\r\n *     this.request = null;\r\n * }\r\n * this.request = Res.create(\r\n *      url, \r\n *      refKey,\r\n *      (progress:number)=>{\r\n *          //\u52A0\u8F7D\u8FDB\u5EA6\r\n *          console.log(progress);\r\n *      }\r\n *      (err)=>{\r\n *          if(err){\r\n *              console.error(err);\r\n *              request.dispose();\r\n *              request=null;\r\n *              return;\r\n *          }\r\n *          //\u52A0\u8F7D\u5B8C\u6210\uFF0C\u83B7\u53D6\u8D44\u6E90\u5F15\u7528\r\n *          let ref=request.getRef();\r\n *      }\r\n * );\r\n * this.request.load();\r\n */\r\nexport class ResRequest {\r\n    /**\r\n     * \u72B6\u6001\r\n     */\r\n    state: State = State.POOL;\r\n    /**\r\n     * \u8D44\u6E90\u5730\u5740\r\n     */\r\n    urls: Array<ResURL>;\r\n    /**\r\n     * \u5F15\u7528KEY\r\n     */\r\n    refKey: string = \"\";\r\n    /**\r\n     * \u5B8C\u6210\u56DE\u8C03\r\n     */\r\n    cb?: (err?: Error) => void;\r\n    /**\r\n     * \u8FDB\u5EA6\u5904\u7406\u5668\r\n     */\r\n    progress?: (progress: number) => void;\r\n\r\n    private __loaded: Map<string, boolean>;\r\n    private __loadProgress: Map<string, number>;\r\n\r\n    private __resRefs: Array<ResRef>;\r\n\r\n    constructor() {\r\n        this.urls = [];\r\n        this.__resRefs = [];\r\n        this.__loaded = new Map<string, boolean>();\r\n        this.__loadProgress = new Map<string, number>();\r\n    }\r\n\r\n    init(url: ResURL | Array<ResURL>, refKey: string, progress?: (progress: number) => void, cb?: (err?: Error) => void): void {\r\n        if (Array.isArray(url)) {\r\n            this.urls = url;\r\n        } else {\r\n            this.urls = [url];\r\n        }\r\n        //\u53BB\u91CD\r\n        this.urls = this.removeDuplicates(this.urls);\r\n        this.cb = cb;\r\n        this.refKey = refKey;\r\n        this.progress = progress;\r\n    }\r\n\r\n    load(): void {\r\n        this.state = State.LOADING;\r\n        LoaderManager.load(this);\r\n    }\r\n\r\n    childComplete(resURL: ResURL): void {\r\n        const urlKey = Res.url2Key(resURL);\r\n        this.__loaded.set(urlKey, true);\r\n        this.checkComplete();\r\n    }\r\n\r\n    childProgress(resURL: ResURL, progress: number): void {\r\n        const urlKey = Res.url2Key(resURL);\r\n        this.__loadProgress.set(urlKey, progress);\r\n        this.updateProgress();\r\n    }\r\n\r\n    childError(err: Error): void {\r\n        this.state = State.ERROR;\r\n        if (this.cb) {\r\n            this.cb(err);\r\n        }\r\n    }\r\n\r\n    updateProgress(): void {\r\n        let loaded: number = this.getLoaded();\r\n        let progress: number = loaded / this.urls.length;\r\n        if (this.progress) {\r\n            this.progress(progress);\r\n        }\r\n    }\r\n\r\n    private checkComplete(): void {\r\n        let loaded: number = this.__loaded.size;\r\n        let progress: number = loaded / this.urls.length;\r\n        //\u5B8C\u6210\r\n        if (progress >= 1 && this.cb != null) {\r\n            this.state = State.SUCCESS;\r\n            for (let index = 0; index < this.urls.length; index++) {\r\n                const url = this.urls[index];\r\n                const urlKey = Res.url2Key(url);\r\n                const ref = ResourceManager.addRef(urlKey, this.refKey);\r\n                this.__resRefs.push(ref);\r\n            }\r\n            this.cb();\r\n        }\r\n    }\r\n\r\n    private getLoaded(): number {\r\n        let loaded: number = 0;\r\n        for (let value of this.__loadProgress.values()) {\r\n            loaded += value;\r\n        }\r\n        return loaded;\r\n    }\r\n\r\n\r\n    reset(): void {\r\n        this.state = State.POOL;\r\n        if (this.__resRefs) {\r\n            for (let index = 0; index < this.__resRefs.length; index++) {\r\n                const ref = this.__resRefs[index];\r\n                ref.dispose();\r\n            }\r\n            this.__resRefs.splice(0, this.__resRefs.length);\r\n        }\r\n        this.__loaded.clear();\r\n        this.__loadProgress.clear();\r\n        this.urls = [];\r\n        this.cb = undefined;\r\n        this.progress = undefined;\r\n    }\r\n\r\n    destroy(): boolean {\r\n        this.reset();\r\n        this.__resRefs.splice(0, this.__resRefs.length);\r\n        this.__loaded.clear();\r\n        this.__loadProgress.clear();\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * \u91CA\u653E\r\n     */\r\n    dispose(): void {\r\n        if (this.state == State.LOADING) {\r\n            LoaderManager.unload(this);\r\n        }\r\n        Pool.release(ResRequest, this);\r\n    }\r\n\r\n    /**\r\n     * \u83B7\u53D6\u8D44\u6E90\u5F15\u7528\r\n     * @returns \r\n     */\r\n    getRef(): ResRef {\r\n        return this.__resRefs[0];\r\n    }\r\n\r\n    /**\r\n     * \u83B7\u53D6\u8D44\u6E90\u5F15\u7528\u5217\u8868\r\n     * @returns \r\n     */\r\n    getRefList(): Array<ResRef> {\r\n        return this.__resRefs;\r\n    }\r\n\r\n    /**\r\n     * \u83B7\u53D6\u8D44\u6E90\u5F15\u7528\u6620\u5C04\u8868\r\n     * @param result \r\n     * @returns \r\n     */\r\n    getRefMap(result?: Map<string, ResRef>): Map<string, ResRef> {\r\n        result = result || new Map<string, ResRef>();\r\n        for (let index = 0; index < this.__resRefs.length; index++) {\r\n            const ref = this.__resRefs[index];\r\n            result.set(ref.key, ref);\r\n        }\r\n        return result;\r\n    }\r\n\r\n    private helpMap: Map<string, boolean> = new Map<string, boolean>();\r\n    /**\r\n     * \u53BB\u91CD\r\n     * @param urls \r\n     * @returns \r\n     */\r\n    private removeDuplicates(urls: Array<ResURL>): Array<ResURL> {\r\n        this.helpMap.clear();\r\n        let result: Array<ResURL> = [];\r\n        for (let index = 0; index < urls.length; index++) {\r\n            const url = urls[index];\r\n            const urlKey = Res.url2Key(url);\r\n            if (this.helpMap.has(urlKey)) {\r\n                continue;\r\n            } else {\r\n                this.helpMap.set(urlKey, true);\r\n                result.push(url);\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n}", "\r\n\r\n\r\nexport class ClassUtils {\r\n    \r\n    /**\r\n     * \u83B7\u53D6\u5355\u8BCD\u6307\u5B9A\u4F4D\u7F6E\u5355\u8BCD\r\n     * @param str \r\n     * @param n \r\n     * @returns \r\n     */\r\n    static getWord(str: string, n: number | Array<number>): string | Array<string> {\r\n        if (Array.isArray(n) && n.length > 0) {\r\n            let arr = [];\r\n            for (let i of n) {\r\n                arr.push(this.getWord(str, i).toString());\r\n            }\r\n            return arr;\r\n        } else {\r\n            const m = str.match(new RegExp('^(?:\\\\w+\\\\W+){' + n + '}(\\\\w+)'));\r\n            if (m) {\r\n                return m[1];\r\n            }\r\n            return \"\";\r\n        }\r\n    }\r\n\r\n    static getContractName(code: string): string {\r\n        const words = this.getWord(code, [0, 1, 2])\r\n        if (words[0] === 'abstract') {\r\n            return words[2]\r\n        }\r\n        return words[1];\r\n    }\r\n\r\n    static getFunctionName(code: string): string {\r\n        const words = this.getWord(code, [0, 1])\r\n        if (words[0] === 'constructor') {\r\n            return words[0];\r\n        }\r\n        return words[1];\r\n    }\r\n\r\n    static getClassName(value: any): string {\r\n        let className: string;\r\n        if (typeof value != \"string\") {\r\n            className = value.toString();\r\n            if (className.startsWith(\"function\")) {\r\n                return this.getFunctionName(className);\r\n            } else {\r\n                return this.getContractName(className);\r\n            }\r\n        } else {\r\n            className = value;\r\n        }\r\n        return className;\r\n    }\r\n}", "import { Injector } from \"../utils/Injector\";\r\nimport { ILoader } from \"./loaders/ILoader\";\r\nimport { IRes } from \"./resources/IRes\";\r\nimport { ResImpl } from \"./resources/ResImpl\";\r\nimport { ResRequest } from \"./ResRequest\";\r\nimport { ResURL } from \"./ResURL\";\r\n\r\n\r\nenum ResType {\r\n    FGUI = \"fgui\",\r\n    CONFIG = \"config\",\r\n}\r\n\r\n/**\r\n * \u8D44\u6E90\u5165\u53E3\u7C7B\r\n */\r\nexport class Res {\r\n\r\n    static readonly KEY: string = \"Res\"\r\n\r\n    /**\r\n     * \u9ED8\u8BA4\u8D44\u6E90\u7C7B\u578B\r\n     */\r\n    static TYPE: typeof ResType = ResType;\r\n\r\n    /**\r\n     * \u8D44\u6E90\u52A0\u8F7D\u6700\u5927\u7EBF\u7A0B\u6570\r\n     */\r\n    static MAX_LOADER_THREAD: number = 5;\r\n\r\n    /**\r\n     * key\u8F6Curl\r\n     * @param key \r\n     * @returns \r\n     */\r\n    static key2Url(key: string): ResURL {\r\n        return this.impl.key2Url(key);\r\n    }\r\n\r\n    /**\r\n     * url\u8F6Ckey\r\n     * @param url \r\n     * @returns \r\n     */\r\n    static url2Key(url: ResURL): string {\r\n        return this.impl.url2Key(url);\r\n    }\r\n\r\n    /**\r\n    * url\u8F6C\u8D44\u6E90\u8DEF\u5F84\r\n    * @param url\r\n    */\r\n    static url2Path(url: ResURL): string {\r\n        return this.impl.url2Path(url);\r\n    }\r\n\r\n    /**\r\n     * url\u662F\u5426\u76F8\u540C\r\n     * @param a \r\n     * @param b \r\n     */\r\n    static urlEqual(a: ResURL | null, b: ResURL | null): boolean {\r\n        return this.impl.urlEqual(a, b);\r\n    }\r\n\r\n    /**\r\n     * \u8BBE\u7F6E\u8D44\u6E90\u52A0\u8F7D\u5668\r\n     * @param key \r\n     * @param loader \r\n     */\r\n    static setLoader(key: any, loader: new () => ILoader): void {\r\n        this.impl.setLoader(key, loader);\r\n    }\r\n\r\n    /**\r\n     * \u83B7\u53D6\u8D44\u6E90\u52A0\u8F7D\u5668\r\n     * @param key \r\n     * @returns \r\n     */\r\n    static getLoader(key: any): new () => ILoader {\r\n        return this.impl.getLoader(key);\r\n    }\r\n\r\n    /**\r\n     * \u521B\u5EFA\u8D44\u6E90\u8BF7\u6C42\r\n     * @param url \r\n     * @param refKey \r\n     * @param progress \r\n     * @param cb \r\n     * @returns \r\n     */\r\n    static create(url: ResURL | Array<ResURL>, refKey: string, progress?: (progress: number) => void, cb?: (err?: Error) => void): ResRequest {\r\n        return this.impl.create(url, refKey, progress, cb);\r\n    }\r\n    \r\n    /**\r\n     * \u52A0\u8F7DAssetBundle\r\n     * @param names \r\n     * @returns \r\n     */\r\n    static loadAssetBundles(names: string | Array<string>): Promise<void> {\r\n        return this.impl.loadAssetBundles(names);\r\n    }\r\n\r\n\r\n    private static __impl: IRes;\r\n    private static get impl(): IRes {\r\n        if (this.__impl == null) {\r\n            this.__impl = Injector.getInject(this.KEY);\r\n        }\r\n        if (this.__impl == null) {\r\n            this.__impl = new ResImpl();\r\n        }\r\n        return this.__impl;\r\n    }\r\n\r\n    /**\r\n     * url\u8F6C\u8868\u540D\r\n     * @param url \r\n     * @returns \r\n     */\r\n    static url2Sheet: (url: ResURL) => string;\r\n    /**\r\n     * \u914D\u7F6E\u8868\u540D\u79F0\u8F6CURL\r\n     * @param sheet \r\n     * @param type \r\n     * @param bundle \r\n     * @returns \r\n     */\r\n    static sheet2URL: ((sheet: string, type?: any, bundle?: string) => ResURL) | undefined;\r\n}", "import { Injector } from \"../utils/Injector\";\r\nimport { ResURL } from \"../res/ResURL\";\r\nimport { IAudioChannel } from \"./IAudioChannel\";\r\nimport { IAudioManager } from \"./IAudioManager\";\r\nimport { AudioManagerImpl } from \"./AudioManagerImpl\";\r\n\r\n\r\n/**\r\n * \u97F3\u9891\u7BA1\u7406\u5668\r\n */\r\nexport class AudioManager {\r\n\r\n    /**\r\n     * \u5168\u5C40\u552F\u4E00\u6CE8\u5165KEY\r\n     */\r\n    static KEY: string = \"AudioManager\";\r\n\r\n    /**\r\n     * \u6700\u5927\u97F3\u9891\u8F68\u9053\u6570\u91CF\r\n     */\r\n    public static MAX_SOUND_CHANNEL_COUNT: number = 30;\r\n\r\n    /**\r\n     * \u603B\u97F3\u91CF\r\n     */\r\n    static get volume(): number {\r\n        return this.impl.volume;\r\n    }\r\n\r\n    static set volume(value: number) {\r\n        this.impl.volume = value;\r\n    }\r\n\r\n    /**\r\n     * \u97F3\u4E50\u97F3\u91CF\r\n     */\r\n    static get musicVolume(): number {\r\n        return this.impl.musicVolume;\r\n    }\r\n\r\n    static set musicVolume(value: number) {\r\n        this.impl.musicVolume = value;\r\n    }\r\n\r\n    /**\r\n     * \u58F0\u97F3\u97F3\u91CF\r\n     */\r\n    static get soundVolume(): number {\r\n        return this.impl.soundVolume;\r\n    }\r\n\r\n    static set soundVolume(value: number) {\r\n        this.impl.soundVolume = value;\r\n    }\r\n\r\n    /**\r\n     * \u9759\u97F3\u603B\u5F00\u5173\r\n     */\r\n    static get mute(): boolean {\r\n        return this.impl.mute;\r\n    }\r\n\r\n    static set mute(value: boolean) {\r\n        this.impl.mute = value;\r\n    }\r\n\r\n    /**\r\n     * \u97F3\u4E50\u9759\u97F3\u5F00\u5173\r\n     */\r\n    static get muteMusic(): boolean {\r\n        return this.impl.muteMusic;\r\n    }\r\n\r\n    static set muteMusic(value: boolean) {\r\n        this.impl.muteMusic = value;\r\n    }\r\n\r\n    /**\r\n     * \u58F0\u97F3\u9759\u97F3\u5F00\u5173\r\n     */\r\n    static get muteSound(): boolean {\r\n        return this.impl.muteSound;\r\n    }\r\n\r\n    static set muteSound(value: boolean) {\r\n        this.impl.muteSound = value;\r\n    }\r\n\r\n    /**\r\n     * \u64AD\u653E\u97F3\u4E50\r\n     * @param value\r\n     */\r\n    static playMusic(url: ResURL, volume: number = 1, speed: number = 1): void {\r\n        this.impl.playMusic(url, volume, speed);\r\n    }\r\n\r\n    /**\r\n     * \u505C\u6B62\u97F3\u4E50\r\n     */\r\n    static stopMusic(): void {\r\n        this.impl.stopMusic();\r\n    }\r\n\r\n    /**\r\n     * \u6682\u505C\r\n     */\r\n    static pauseMusic(): void {\r\n        this.impl.pauseMusic();\r\n    }\r\n\r\n    /**\r\n     * \u7EE7\u7EED\u64AD\u653E\r\n     */\r\n    static resumeMusic(): void {\r\n        this.impl.resumeMusic();\r\n    }\r\n\r\n    /**\r\n     * \u64AD\u653E\u58F0\u97F3\r\n     * @param value\r\n     */\r\n    static playSound(url: ResURL, playedCallBack?: ()=>void, volume: number=1, speed: number=1, loop: boolean=false): void {\r\n        this.impl.playSound(url, playedCallBack, volume, speed, loop);\r\n    }\r\n\r\n    /**\r\n     * \u83B7\u53D6\u6B63\u5728\u64AD\u653E\u6307\u5B9A\u97F3\u9891\u7684\u8F68\u9053\r\n     * @param url\r\n     */\r\n    static getPlaying(url: ResURL): IAudioChannel {\r\n        return this.impl.getPlaying(url);\r\n    }\r\n\r\n    private static __impl: IAudioManager;\r\n    private static get impl(): IAudioManager {\r\n        if (this.__impl == null) {\r\n            this.__impl = Injector.getInject(this.KEY);\r\n        }\r\n        if (this.__impl == null) {\r\n            this.__impl=new AudioManagerImpl();\r\n        }\r\n        return this.__impl;\r\n    }\r\n}", "import { Handler } from \"../utils/Handler\";\r\n\r\n\r\n/**\r\n * \u51FD\u6570\u94A9\u5B50\u4FE1\u606F\r\n */\r\nclass FunctionHookInfo {\r\n    /**\r\n     * \u65B9\u6CD5\u540D\r\n     */\r\n    functionName: string;\r\n    /**\r\n     * \u524D\u7F6E\u5904\u7406\u5668\r\n     */\r\n    preHandler: Handler;\r\n    /**\r\n     * \u540E\u7F6E\u5904\u7406\u5668\r\n     */\r\n    laterHandler: Handler;\r\n\r\n    equal(functionName: string, preHandler: Handler, laterHandler: Handler): boolean {\r\n        if (this.functionName != functionName) {\r\n            return false;\r\n        }\r\n        if (preHandler && !preHandler.equal(this.preHandler)) {\r\n            return false;\r\n        }\r\n        if (laterHandler && !laterHandler.equal(this.laterHandler)) {\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n}\r\n\r\n\r\nexport class FunctionHook {\r\n\r\n    data: any;\r\n\r\n    /**\r\n     * \u5DF2\u6DFB\u52A0\u597D\u94A9\u5B50\u7684\u65B9\u6CD5\r\n     */\r\n    private __functions: Array<string>;\r\n\r\n    private __preHandlerMap: Map<string, Array<Handler>>;\r\n    private __laterHandlerMap: Map<string, Array<Handler>>;\r\n\r\n    private __groupMap: Map<any, Array<FunctionHookInfo>>;\r\n\r\n    constructor(data: any) {\r\n        this.data = data;\r\n        this.__functions = [];\r\n        this.__preHandlerMap = new Map<string, Array<Handler>>();\r\n        this.__laterHandlerMap = new Map<string, Array<Handler>>();\r\n        this.__groupMap = new Map<any, Array<FunctionHookInfo>>();\r\n    }\r\n\r\n    /**\r\n     * \u6DFB\u52A0\u94A9\u5B50\r\n     * @param group\r\n     * @param functionName \r\n     * @param preHandlers \r\n     * @param laterHandlers \r\n     */\r\n    addHook(group: any, functionName: string, preHandler: Handler, laterHandler: Handler): void {\r\n        let groupList: Array<FunctionHookInfo> = this.__groupMap.get(group);\r\n        if (!groupList) {\r\n            groupList = [];\r\n            this.__groupMap.set(group, groupList);\r\n        }\r\n        for (let index = 0; index < groupList.length; index++) {\r\n            const element = groupList[index];\r\n            if (element.equal(functionName, preHandler, laterHandler)) {\r\n                //\u91CD\u590D\u6DFB\u52A0\r\n                return;\r\n            }\r\n        }\r\n        let info: FunctionHookInfo = new FunctionHookInfo();\r\n        info.functionName = functionName;\r\n        info.preHandler = preHandler;\r\n        info.laterHandler = laterHandler;\r\n\r\n        groupList.push(info);\r\n\r\n        let self = this;\r\n        //\u5982\u679C\u6CA1\u6709\u6DFB\u52A0\u597D\u94A9\u5B50\r\n        if (this.__functions.indexOf(functionName) < 0) {\r\n            let oldFun: Function = this.data[functionName];\r\n            if (!oldFun) {\r\n                throw new Error(\"\u65B9\u6CD5\u4E0D\u5B58\u5728\uFF01\");\r\n            }\r\n            let pres: Array<Handler> = this.__preHandlerMap.get(functionName);\r\n            if (!pres) {\r\n                pres = [];\r\n                this.__preHandlerMap.set(functionName, pres);\r\n            }\r\n            let laters: Array<Handler> = this.__laterHandlerMap.get(functionName);\r\n            if (!laters) {\r\n                laters = [];\r\n                this.__laterHandlerMap.set(functionName, laters);\r\n            }\r\n            let newFun: Function = function (...arg: any[]): void {\r\n                //pre\r\n                if (pres && pres.length) {\r\n                    for (let index = 0; index < pres.length; index++) {\r\n                        const element = pres[index];\r\n                        element && element.run(arg);\r\n                    }\r\n                }\r\n                //old\r\n                oldFun.apply(self.data, arg);\r\n                //later\r\n                if (laters && laters.length) {\r\n                    for (let index = 0; index < laters.length; index++) {\r\n                        const element = laters[index];\r\n                        element && element.run(arg);\r\n                    }\r\n                }\r\n            }\r\n            this.data[functionName] = newFun;\r\n            this.data[\"old_\" + functionName] = oldFun;\r\n            this.__functions.push(functionName);\r\n        }\r\n        let pres: Array<Handler> = this.__preHandlerMap.get(functionName);\r\n        if (!pres) {\r\n            pres = [];\r\n            this.__preHandlerMap.set(functionName, pres);\r\n        }\r\n        if (pres.indexOf(preHandler) < 0) {\r\n            pres.push(preHandler);\r\n        }\r\n\r\n        let laters: Array<Handler> = this.__laterHandlerMap.get(functionName);\r\n        if (!laters) {\r\n            laters = [];\r\n            this.__laterHandlerMap.set(functionName, laters);\r\n        }\r\n        if (laters.indexOf(laterHandler) < 0) {\r\n            laters.push(laterHandler);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \u5220\u9664\u94A9\u5B50\r\n     * @param group \r\n     * @param functionName\r\n     * @param preHandler \r\n     * @param laterHandler \r\n     * @returns \r\n     */\r\n    removeHook(group: any, functionName?: string, preHandler?: Handler, laterHandler?: Handler): void {\r\n        let groupList: Array<FunctionHookInfo> = this.__groupMap.get(group);\r\n        if (!groupList) {\r\n            return;\r\n        }\r\n        let list: Array<Handler>;\r\n        let fIndex: number;\r\n\r\n        //\u7F16\u7EC4\u5220\u9664\r\n        if (!functionName) {\r\n            for (let index = 0; index < groupList.length; index++) {\r\n                const element = groupList[index];\r\n                //pre\r\n                if (element.preHandler) {\r\n                    list = this.__preHandlerMap.get(element.functionName);\r\n                    fIndex = list.indexOf(element.preHandler);\r\n                    if (fIndex >= 0) {\r\n                        list.splice(fIndex, 1);\r\n                    }\r\n                    if (list.length == 0) {\r\n                        this.__preHandlerMap.delete(element.functionName);\r\n                    }\r\n                }\r\n                //later\r\n                if (element.laterHandler) {\r\n                    list = this.__laterHandlerMap.get(element.functionName);\r\n                    fIndex = list.indexOf(element.laterHandler);\r\n                    if (fIndex >= 0) {\r\n                        list.splice(fIndex, 1);\r\n                    }\r\n                    if (list.length == 0) {\r\n                        this.__laterHandlerMap.delete(element.functionName);\r\n                    }\r\n                }\r\n            }\r\n            groupList.length = 0;\r\n            this.__groupMap.delete(group);\r\n            return;\r\n        }\r\n\r\n        for (let index = 0; index < groupList.length; index++) {\r\n            const element = groupList[index];\r\n            if (element.equal(functionName, preHandler, laterHandler)) {\r\n                //\u5220\u9664\r\n                groupList.splice(index, 1);\r\n                //pre\r\n                if (element.preHandler) {\r\n                    list = this.__preHandlerMap.get(functionName);\r\n                    fIndex = list.indexOf(element.preHandler);\r\n                    if (fIndex >= 0) {\r\n                        list.splice(fIndex, 1);\r\n                    }\r\n                }\r\n                //later\r\n                if (element.laterHandler) {\r\n                    list = this.__laterHandlerMap.get(functionName);\r\n                    fIndex = list.indexOf(element.laterHandler);\r\n                    if (fIndex >= 0) {\r\n                        list.splice(fIndex, 1);\r\n                    }\r\n                }\r\n                return;\r\n            }\r\n        }\r\n    }\r\n}", "import { TickerManager } from \"../ticker/TickerManager\";\r\n\r\n/**\r\n * \u7ED1\u5B9A\u4FE1\u606F\r\n */\r\nclass BindInfo {\r\n    /**\r\n     * \u5C5E\u6027KEY\r\n     */\r\n    property: string;\r\n    /**\r\n     * \u76EE\u6807\u6216\u56DE\u8C03\u51FD\u6570\r\n     */\r\n    targetOrCallBack: any | Function;\r\n    /**\r\n     * \u76EE\u6807\u5C5E\u6027\u6216\u76EE\u6807this\u5F15\u7528\r\n     */\r\n    tPropertyOrCaller: string | any;\r\n\r\n    constructor(property: string, targetOrCallBack: any | Function, tPropertyOrCaller: string | any) {\r\n        this.property = property;\r\n        this.targetOrCallBack = targetOrCallBack;\r\n        this.tPropertyOrCaller = tPropertyOrCaller;\r\n    }\r\n\r\n    /**\r\n     * \u5224\u65AD\u662F\u5426\u76F8\u7B49\r\n     * @param property \r\n     * @param targetOrCallBack \r\n     * @param tPropertyOrCaller \r\n     * @returns \r\n     */\r\n    equal(property: string, targetOrCallBack: any | Function, tPropertyOrCaller: string | any): boolean {\r\n        if (property == this.property && this.targetOrCallBack == targetOrCallBack && this.tPropertyOrCaller == tPropertyOrCaller) {\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n}\r\n\r\n/**\r\n * \u5C5E\u6027\u7ED1\u5B9A\u5668\r\n */\r\nexport class PropertyBinder {\r\n\r\n    data: any;\r\n\r\n    /**\r\n     * \u4EE3\u7406\u8FC7\u7684\u6570\u636E\r\n     */\r\n    private __propertys: Array<string>;\r\n\r\n    /**\r\n     * \u5C5E\u6027\u6539\u53D8\u5217\u8868\r\n     */\r\n    private __changedPropertys: Array<string>;\r\n\r\n    private __bindedMap: Map<string, Array<BindInfo>>;\r\n\r\n    private __bindedGroupMap: Map<string, Array<BindInfo>>;\r\n\r\n    constructor(data: any) {\r\n        this.data = data;\r\n\r\n        this.__propertys = [];\r\n        this.__changedPropertys = [];\r\n\r\n        this.__bindedMap = new Map<string, Array<BindInfo>>();\r\n        this.__bindedGroupMap = new Map<string, Array<BindInfo>>();\r\n    }\r\n\r\n    /**\r\n     * \u7ED1\u5B9A\r\n     * @param group \r\n     * @param property \r\n     * @param targetOrCallBack \r\n     * @param tPropertyOrCaller \r\n     * @returns \r\n     */\r\n    bind(group: any, property: string | Array<string>, targetOrCallBack: any | Function, tPropertyOrCaller: string | any): void {\r\n        let info: BindInfo;\r\n        let groupList: Array<BindInfo> = this.__bindedGroupMap.get(group);\r\n        if (!groupList) {\r\n            groupList = [];\r\n            this.__bindedGroupMap.set(group, groupList);\r\n        }\r\n        let exist: boolean = false;\r\n        let bindInfos: Array<BindInfo>;\r\n        if (Array.isArray(property)) {\r\n            for (let pIndex = 0; pIndex < property.length; pIndex++) {\r\n                const propertyKey = property[pIndex];\r\n                this.__checkProperty(propertyKey);\r\n\r\n                for (let index = 0; index < groupList.length; index++) {\r\n                    info = groupList[index];\r\n                    if (info.equal(propertyKey, targetOrCallBack, tPropertyOrCaller)) {\r\n                        exist = true;\r\n                        continue;\r\n                    }\r\n                }\r\n                //\u4E0D\u5B58\u5728\r\n                if (!exist) {\r\n                    info = new BindInfo(propertyKey, targetOrCallBack, tPropertyOrCaller);\r\n                    bindInfos = this.__bindedMap.get(propertyKey);\r\n                    if (!bindInfos) {\r\n                        bindInfos = [];\r\n                        this.__bindedMap.set(propertyKey, bindInfos);\r\n                    }\r\n                    bindInfos.push(info);\r\n                    groupList.push(info);\r\n\r\n                    //\u6807\u8BB0\u6539\u53D8\r\n                    this.__propertyChanged(propertyKey);\r\n                }\r\n            }\r\n        } else {\r\n            this.__checkProperty(property);\r\n\r\n            for (let index = 0; index < groupList.length; index++) {\r\n                info = groupList[index];\r\n                if (info.equal(property, targetOrCallBack, tPropertyOrCaller)) {\r\n                    return;\r\n                }\r\n            }\r\n            info = new BindInfo(property, targetOrCallBack, tPropertyOrCaller);\r\n            bindInfos = this.__bindedMap.get(property);\r\n            if (!bindInfos) {\r\n                bindInfos = [];\r\n                this.__bindedMap.set(property, bindInfos);\r\n            }\r\n            bindInfos.push(info);\r\n            groupList.push(info);\r\n\r\n            //\u6807\u8BB0\u6539\u53D8\r\n            this.__propertyChanged(property);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \u53D6\u6D88\u7ED1\u5B9A\r\n     * @param group \r\n     * @param property \r\n     * @param targetOrCallBack \r\n     * @param tPropertyOrCaller \r\n     * @returns \r\n     */\r\n    unbind(group: any, property?: string | Array<string>, targetOrCallBack?: any | Function, tPropertyOrCaller?: string | any): void {\r\n        let info: BindInfo;\r\n        let groupList: Array<BindInfo> = this.__bindedGroupMap.get(group);\r\n        //\u5982\u679C\u8BB0\u5F55\u4E2D\u6CA1\u6709\r\n        if (!groupList) {\r\n            return;\r\n        }\r\n        let bindInfos: Array<BindInfo>;\r\n        let fIndex: number;\r\n        //\u53D6\u6D88\u6240\u6709\u8BE5\u7EC4\u7684\u7ED1\u5B9A\r\n        if (property == null) {\r\n            for (let index = 0; index < groupList.length; index++) {\r\n                info = groupList[index];\r\n                //\u4ECE\u5DF2\u7ED1\u5B9A\u7684\u5217\u8868\u4E2D\u5220\u9664\r\n                bindInfos = this.__bindedMap.get(info.property);\r\n                if (bindInfos && bindInfos.length > 0) {\r\n                    fIndex = bindInfos.indexOf(info);\r\n                    if (fIndex >= 0) {\r\n                        bindInfos.splice(fIndex, 1);\r\n                    }\r\n                }\r\n                if (bindInfos.length == 0) {\r\n                    this.__bindedMap.delete(info.property);\r\n                }\r\n            }\r\n            groupList.length = 0;\r\n            this.__bindedGroupMap.delete(group);\r\n            return;\r\n        }\r\n        if (Array.isArray(property)) {\r\n            for (let pIndex = 0; pIndex < property.length; pIndex++) {\r\n                const propertyKey = property[pIndex];\r\n                //\u4ECE\u7EC4\u4E2D\u627E\u76F8\u5BF9\u6BD4\u8F83\u5FEB\u4E00\u4E9B\uFF0C\u56E0\u4E3A\u7F16\u7EC4\u5217\u8868\u76F8\u5BF9\u6570\u636E\u7ED1\u5B9A\u5217\u8868\u901A\u5E38\u4F1A\u5C0F\u4E00\u4E9B\r\n                for (let gIndex = 0; gIndex < groupList.length; gIndex++) {\r\n                    info = groupList[gIndex];\r\n                    bindInfos = this.__bindedMap.get(info.property);\r\n                    if (info.equal(propertyKey, targetOrCallBack, tPropertyOrCaller)) {\r\n                        fIndex = bindInfos.indexOf(info);\r\n                        if (fIndex >= 0) {\r\n                            bindInfos.splice(fIndex, 1);\r\n                        }\r\n                        groupList.splice(gIndex, 1);\r\n                        gIndex--;\r\n                    }\r\n                }\r\n            }\r\n            if (groupList.length == 0) {\r\n                this.__bindedGroupMap.delete(group);\r\n            }\r\n        } else {\r\n            //\u4ECE\u7EC4\u4E2D\u627E\u76F8\u5BF9\u6BD4\u8F83\u5FEB\u4E00\u4E9B\uFF0C\u56E0\u4E3A\u7F16\u7EC4\u5217\u8868\u76F8\u5BF9\u6570\u636E\u7ED1\u5B9A\u5217\u8868\u901A\u5E38\u4F1A\u5C0F\u4E00\u4E9B\r\n            for (let gIndex = 0; gIndex < groupList.length; gIndex++) {\r\n                info = groupList[gIndex];\r\n                bindInfos = this.__bindedMap.get(info.property);\r\n                if (info.equal(property, targetOrCallBack, tPropertyOrCaller)) {\r\n                    fIndex = bindInfos.indexOf(info);\r\n                    if (fIndex >= 0) {\r\n                        bindInfos.splice(fIndex, 1);\r\n                    }\r\n                    groupList.splice(gIndex, 1);\r\n                    gIndex--;\r\n                }\r\n            }\r\n            if (groupList.length == 0) {\r\n                this.__bindedGroupMap.delete(group);\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n\r\n    //========================================\u5C5E\u6027\u7ED1\u5B9A\u673A\u5236\u5B9E\u73B0======================================//\r\n\r\n    /**\r\n    * \u68C0\u6D4B\u5C5E\u6027\r\n    * @param propertyKey \r\n    */\r\n    private __checkProperty(propertyKey: string): void {\r\n        let index: number = this.__propertys.indexOf(propertyKey);\r\n        //\u5982\u679C\u6CA1\u6709\u7ED1\u5B9A\u8FC7\u8FD9\u4E2A\u6570\u636E\r\n        if (index < 0) {\r\n            //\u6570\u636E\u7ED1\u5B9A\u5B9E\u73B0\r\n            let value: any = this.data[propertyKey];\r\n            this.__defineReactive(this.data, propertyKey, value);\r\n            this.__propertys.push(propertyKey);\r\n        }\r\n    }\r\n\r\n    /**\u5B9A\u4E49 */\r\n    private __defineReactive(data: any, key: string, value: any): void {\r\n        let self = this;\r\n        Object.defineProperty(data, key, {\r\n            enumerable: true,\r\n            configurable: true,\r\n            get: function (): any {\r\n                return value;\r\n            },\r\n            set: function (newValue: any) {\r\n                if (value == newValue) {\r\n                    return;\r\n                }\r\n                // Logger.log(\"\u7ED1\u5B9A\u6570\u636E\u6539\u53D8:value+\" + value + \" newValue:\" + newValue, Logger.TYPE.CORE);\r\n                value = newValue;\r\n                self.__propertyChanged(key);\r\n            },\r\n        })\r\n    }\r\n\r\n    private __propertyChanged(pKey: string, isInit: boolean = false): void {\r\n        //\u6807\u8BB0\u6539\u53D8\r\n        if (this.__changedPropertys.indexOf(pKey) < 0) {\r\n            this.__changedPropertys.push(pKey);\r\n            TickerManager.callNextFrame(this.__nextFramePropertyUpdate, this);\r\n        }\r\n    }\r\n\r\n    private __nextFramePropertyUpdate(isInit: boolean = false): void {\r\n        let pKey: string;\r\n        for (let propsIndex = 0; propsIndex < this.__changedPropertys.length; propsIndex++) {\r\n            pKey = this.__changedPropertys[propsIndex];\r\n            this.__updateProperty(pKey);\r\n        }\r\n        this.__changedPropertys.length = 0;\r\n    }\r\n\r\n    /**\r\n     * \u5C5E\u6027\u66F4\u65B0\r\n     * @param pKey \r\n     */\r\n    private __updateProperty(pKey: string): void {\r\n        let bindInfos: Array<BindInfo> = this.__bindedMap.get(pKey);\r\n        let info: BindInfo;\r\n        if (bindInfos && bindInfos.length) {\r\n            for (let index = 0; index < bindInfos.length; index++) {\r\n                info = bindInfos[index];\r\n                //\u5C5E\u6027\u7ED1\u5B9A\r\n                if (typeof info.targetOrCallBack != \"function\") {\r\n                    info.targetOrCallBack[info.tPropertyOrCaller] = this.data[pKey];\r\n                } else {//\u51FD\u6570\u7ED1\u5B9A\r\n                    (<Function>info.targetOrCallBack).apply(info.tPropertyOrCaller, [this.__changedPropertys]);\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n", "import { Handler } from \"../utils/Handler\";\r\nimport { FunctionHook } from \"./FunctionHook\";\r\nimport { PropertyBinder } from \"./PropertyBinder\";\r\n\r\n\r\n/**\r\n * \u7ED1\u5B9A\u5DE5\u5177\u7C7B\r\n */\r\nexport class Binder {\r\n\r\n    /**\u5C5E\u6027\u7ED1\u5B9A\u8BB0\u5F55 */\r\n    private __bindRecords: Array<PropertyBindInfo>;\r\n    /**\u65B9\u6CD5\u7ED1\u5B9A\u8BB0\u5F55 */\r\n    private __hookRecords: Array<FunctionHookInfo>;\r\n    /**\u9700\u8981\u6CE8\u518C\u548C\u5220\u9664\u7684\u4E8B\u4EF6*/\r\n    private __eventRecords: Array<{ target: any, eventType: number | string, handler: Function, caller: any }>;\r\n\r\n    /**\u521D\u59CB\u5316\u6807\u8BB0 */\r\n    inited: boolean;\r\n\r\n    constructor() {\r\n        this.__bindRecords = [];\r\n        this.__hookRecords = [];\r\n        this.__eventRecords = [];\r\n        this.inited = false;\r\n    }\r\n\r\n\r\n    init(): void {\r\n        this.inited = true;\r\n    }\r\n\r\n    /**\r\n     * \u6570\u636E\u7ED1\u5B9A\r\n     * @param source \r\n     * @param property \r\n     * @param targetOrCallBack \r\n     * @param tPropertyKeyOrCaller \r\n     */\r\n    private __bind(source: any, property: string | Array<string>, targetOrCallBack: any | Function, tPropertyKeyOrCaller: string | any): void {\r\n        for (let index = 0; index < this.__bindRecords.length; index++) {\r\n            const element = this.__bindRecords[index];\r\n            if (element.source == source &&\r\n                element.property == property &&\r\n                element.targetOrCallback == targetOrCallBack &&\r\n                element.targetPropertyOrCaller == tPropertyKeyOrCaller) {\r\n                //\u91CD\u590D\u7ED1\u5B9A\r\n                throw new Error(\"\u91CD\u590D\u7ED1\u5B9A\uFF1A\" + source + property + targetOrCallBack + tPropertyKeyOrCaller);\r\n            }\r\n        }\r\n        this.__bindRecords.push({\r\n            source: source,\r\n            property: property,\r\n            targetOrCallback: targetOrCallBack,\r\n            targetPropertyOrCaller: tPropertyKeyOrCaller\r\n        });\r\n        BinderUtils.bind(this, source, property, targetOrCallBack, tPropertyKeyOrCaller);\r\n    }\r\n\r\n    /**\r\n     * \u53D6\u6D88\u7ED1\u5B9A\r\n     * @param source \r\n     * @param property \r\n     * @param targetOrCallBack \r\n     * @param tPropertyKeyOrCaller\r\n     */\r\n    private __unbind(source: any, property?: string | Array<string>, targetOrCallBack?: any | Function, tPropertyKeyOrCaller?: string | any): void {\r\n        for (let index = 0; index < this.__bindRecords.length; index++) {\r\n            const element = this.__bindRecords[index];\r\n            if (element.source == source &&\r\n                element.property == property &&\r\n                element.targetOrCallback == targetOrCallBack &&\r\n                element.targetPropertyOrCaller == tPropertyKeyOrCaller) {\r\n                this.__bindRecords.splice(index, 1);\r\n            }\r\n        }\r\n        BinderUtils.unbind(this, source, property, targetOrCallBack, tPropertyKeyOrCaller);\r\n    }\r\n\r\n    /**\r\n     * \u6DFB\u52A0\u51FD\u6570\u94A9\u5B50\r\n     * @param source \r\n     * @param functionName \r\n     * @param preHandles \r\n     * @param laterHandlers\r\n     */\r\n    private __addHook(source: any, functionName: string, preHandle: Handler, laterHandler?: Handler): void {\r\n        for (let index = 0; index < this.__hookRecords.length; index++) {\r\n            const element = this.__hookRecords[index];\r\n            if (element.source == source &&\r\n                element.functionName == functionName &&\r\n                preHandle.equal(element.preHandler) &&\r\n                laterHandler.equal(element.laterHandler)) {\r\n                //\u91CD\u590D\u7ED1\u5B9A\r\n                throw new Error(\"\u91CD\u590D\u7ED1\u5B9A\uFF1A\" + source + \" \" + functionName);\r\n            }\r\n        }\r\n        //\u8BB0\u5F55\r\n        this.__hookRecords.push({ source: source, functionName: functionName, preHandler: preHandle, laterHandler: laterHandler });\r\n        BinderUtils.addHook(this, source, functionName, preHandle, laterHandler);\r\n    }\r\n\r\n    /**\r\n     * \u5220\u9664\u51FD\u6570\u94A9\u5B50\r\n     * @param source\r\n     * @param functionName\r\n     * @param preHandle\r\n     * @param laterHandler\r\n     */\r\n    private __removeHook(source: any, functionName?: string, preHandle?: Handler, laterHandler?: Handler): void {\r\n        for (let index = 0; index < this.__hookRecords.length; index++) {\r\n            const element = this.__hookRecords[index];\r\n            if (element.source == source &&\r\n                element.functionName == functionName &&\r\n                preHandle.equal(element.preHandler) &&\r\n                laterHandler.equal(element.laterHandler)) {\r\n                this.__hookRecords.splice(index, 1);\r\n            }\r\n        }\r\n        BinderUtils.removeHook(this, source, functionName, preHandle, laterHandler);\r\n    }\r\n\r\n    /**\r\n     * \u5C5E\u6027\u548C\u5C5E\u6027\u7684\u7ED1\u5B9A\r\n     * @param source            \u6570\u636E\u6E90\r\n     * @param property          \u6570\u636E\u6E90\u5C5E\u6027\u540D\r\n     * @param target            \u76EE\u6807\u5BF9\u8C61\r\n     * @param targetProperty    \u76EE\u6807\u5BF9\u8C61\u5C5E\u6027\u540D\r\n     */\r\n    bindAA(source: any, property: string, target: any, targetProperty: string): void {\r\n        this.__bind(source, property, target, targetProperty);\r\n    }\r\n\r\n    /**\r\n     * \u53D6\u6D88\u5C5E\u6027\u548C\u5C5E\u6027\u7684\u7ED1\u5B9A\r\n     * @param source \r\n     * @param property \r\n     * @param target \r\n     * @param targetProperty \r\n     */\r\n    unbindAA(source: any, property: string, target: any, targetProperty: string): void {\r\n        this.__unbind(source, property, target, targetProperty);\r\n    }\r\n\r\n    /**\r\n     * \u5C5E\u6027\u548C\u51FD\u6570\u7684\u7ED1\u5B9A\r\n     * @param source \r\n     * @param property \r\n     * @param callBack \r\n     * @param caller \r\n     */\r\n    bindAM(source: any, property: string | Array<string>, callBack: (prepertys: Array<string>) => void, caller: any): void {\r\n        this.__bind(source, property, callBack, caller);\r\n    }\r\n\r\n    /**\r\n     * \u53D6\u6D88\u5C5E\u6027\u548C\u51FD\u6570\u7684\u7ED1\u5B9A\r\n     * @param source \r\n     * @param propertys \r\n     * @param callBack \r\n     * @param caller \r\n     */\r\n    unbidAM(source: any, propertys: string | Array<string>, callBack: (prepertys: Array<string>) => void, caller: any): void {\r\n        this.__unbind(source, propertys, callBack, caller);\r\n    }\r\n\r\n\r\n    /**\r\n     * \u51FD\u6570\u548C\u51FD\u6570\u7684\u7ED1\u5B9A\r\n     * @param source        \r\n     * @param functionName  \u76EE\u6807\u51FD\u6570\r\n     * @param preHandle     \u8BE5\u51FD\u6570\u5C06\u5728\u76EE\u6807\u51FD\u6570\u8C03\u7528\u524D\u8C03\u7528\r\n     * @param laterHandler  \u8BE5\u51FD\u6570\u5C06\u5728\u76EE\u6807\u51FD\u6570\u8C03\u7528\u540E\u8C03\u7528\r\n     */\r\n    bindMM(source: any, functionName: string, preHandle: Handler, laterHandler?: Handler): void {\r\n        this.__addHook(source, functionName, preHandle, laterHandler);\r\n    }\r\n\r\n    /**\r\n     * \u53D6\u6D88\u65B9\u6CD5\u548C\u65B9\u6CD5\u7684\u7ED1\u5B9A\u5173\u7CFB\r\n     * @param source \r\n     * @param functionName \r\n     * @param preHandle \r\n     * @param laterHandler \r\n     */\r\n    unbindMM(source: any, functionName: string, preHandle: Handler, laterHandler: Handler): void {\r\n        this.__removeHook(source, functionName, preHandle, laterHandler);\r\n    }\r\n\r\n    /**\r\n     * \u7ED1\u5B9A\u4E8B\u4EF6\r\n     * @param target \r\n     * @param type \r\n     * @param handler \r\n     * @param caller \r\n     */\r\n    bindEvent(target: any, type: number | string, handler: Function, caller: any): void {\r\n        for (let index = 0; index < this.__eventRecords.length; index++) {\r\n            const element = this.__eventRecords[index];\r\n            if (element.target == target && element.eventType == type && element.handler == handler && element.caller == caller) {\r\n                throw new Error(\"\u91CD\u590D\u7ED1\u5B9AUI\u4E8B\u4EF6\uFF1A\" + target + type + handler + caller);\r\n            }\r\n        }\r\n        if (this.inited) {\r\n            let on = target[\"on\"];\r\n            if (on && typeof on == \"function\") {\r\n                target.on(type, handler, caller);\r\n            }\r\n            this.__eventRecords.push({ target: target, eventType: type, handler: handler, caller: caller });\r\n        } else {\r\n            this.__eventRecords.push({ target: target, eventType: type, handler: handler, caller: caller });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \u53D6\u6D88\u4E8B\u4EF6\u7ED1\u5B9A\r\n     * @param target \r\n     * @param type \r\n     * @param handler \r\n     * @param caller \r\n     */\r\n    unbindEvent(target: any, type: number | string, handler: Function, caller: any): void {\r\n        let off = target[\"off\"];\r\n        if (off && typeof off == \"function\") {\r\n            target.off(type, handler, caller);\r\n        }\r\n        for (let index = 0; index < this.__eventRecords.length; index++) {\r\n            const element = this.__eventRecords[index];\r\n            if (element.target == target && element.eventType == type && element.handler == handler && element.caller == caller) {\r\n                this.__eventRecords.splice(index, 1);\r\n            }\r\n        }\r\n    }\r\n\r\n    //\u6839\u636E\u8BB0\u5F55\u6DFB\u52A0\u7ED1\u5B9A\r\n    bindByRecords(): void {\r\n        //bind\r\n        for (let index = 0; index < this.__bindRecords.length; index++) {\r\n            const element = this.__bindRecords[index];\r\n            BinderUtils.bind(this, element.source, element.property, element.targetOrCallback, element.targetPropertyOrCaller);\r\n        }\r\n        //addHook\r\n        for (let index = 0; index < this.__hookRecords.length; index++) {\r\n            const element = this.__hookRecords[index];\r\n            BinderUtils.addHook(this, element.source, element.functionName, element.preHandler, element.laterHandler);\r\n        }\r\n        //events\r\n        for (let index = 0; index < this.__eventRecords.length; index++) {\r\n            const eventInfo = this.__eventRecords[index];\r\n            let hasEventHandler = eventInfo.target[\"hasEventHandler\"];\r\n            if (hasEventHandler && typeof hasEventHandler == \"function\") {\r\n                //\u5982\u679C\u5DF2\u7ECF\u6DFB\u52A0\r\n                if (eventInfo.target.hasEventHandler(eventInfo.eventType, eventInfo.handler, eventInfo.caller)) {\r\n                    continue;\r\n                }\r\n            }\r\n            let on = eventInfo.target[\"on\"];\r\n            if (on && typeof on == \"function\") {\r\n                eventInfo.target.on(eventInfo.eventType, eventInfo.handler, eventInfo.caller);\r\n            }\r\n        }\r\n    }\r\n\r\n    //\u6839\u636E\u8BB0\u5F55\u5220\u9664\u7ED1\u5B9A\r\n    unbindByRecords(): void {\r\n        //unbind\r\n        for (let index = 0; index < this.__bindRecords.length; index++) {\r\n            const element = this.__bindRecords[index];\r\n            BinderUtils.unbind(this, element.source, element.property, element.targetOrCallback, element.targetPropertyOrCaller);\r\n        }\r\n        //removeHook\r\n        for (let index = 0; index < this.__hookRecords.length; index++) {\r\n            const element = this.__hookRecords[index];\r\n            BinderUtils.removeHook(this, element.source, element.functionName, element.preHandler, element.laterHandler);\r\n        }\r\n        //events\r\n        for (let index = 0; index < this.__eventRecords.length; index++) {\r\n            const eventInfo = this.__eventRecords[index];\r\n            eventInfo.target.off(eventInfo.eventType, eventInfo.handler, eventInfo.caller);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \u9500\u6BC1\r\n     */\r\n    destroy(): void {\r\n        this.unbindByRecords();\r\n        this.__bindRecords = null;\r\n        this.__hookRecords = null;\r\n        this.__eventRecords = null;\r\n    }\r\n}\r\n\r\n/**\r\n * \u5C5E\u6027\u4E0E\u5C5E\u6027\u6570\u636E\r\n */\r\ninterface PropertyBindInfo {\r\n    /**\r\n     * \u6570\u636E\u6E90\u5BF9\u8C61\r\n     */\r\n    source: any;\r\n    /**\r\n     * \u6570\u636E\u6E90\u5C5E\u6027\u540D\r\n     */\r\n    property: string | Array<string>;\r\n    /**\r\n     * \u76EE\u6807\u5BF9\u8C61\r\n     */\r\n    targetOrCallback: any | Function;\r\n    /**\r\n     * \u76EE\u6807\u5C5E\u6027\u540D\r\n     */\r\n    targetPropertyOrCaller: string | any;\r\n}\r\n\r\n/**\r\n * \u65B9\u6CD5\u4E0E\u65B9\u6CD5\u7ED1\u5B9A\u4FE1\u606F\r\n */\r\ninterface FunctionHookInfo {\r\n    source: any;\r\n    functionName: string;\r\n    preHandler: Handler;\r\n    laterHandler: Handler;\r\n}\r\n\r\n/**\r\n * \u7ED1\u5B9A\u5668\u5DE5\u5177\u7C7B\r\n */\r\nclass BinderUtils {\r\n\r\n    constructor() {\r\n\r\n    }\r\n\r\n    /**\r\n     * \u7ED1\u5B9A\r\n     * @param group \r\n     * @param source \r\n     * @param property \r\n     * @param targetOrCallBack \r\n     * @param tPropertyOrCaller \r\n     */\r\n    static bind(group: any, source: any, property: string | Array<string>, targetOrCallBack: any | Function, tPropertyOrCaller: string | any): void {\r\n        let binder: PropertyBinder = source[\"$PropertyBinder\"];\r\n        if (!binder) {\r\n            binder = new PropertyBinder(source);\r\n            source[\"$PropertyBinder\"] = binder;\r\n        }\r\n        binder.bind(group, property, targetOrCallBack, tPropertyOrCaller);\r\n    }\r\n\r\n    /**\r\n     * \u53D6\u6D88\u7ED1\u5B9A\r\n     * @param group \r\n     * @param source \r\n     * @param property \r\n     * @param targetOrCallBack \r\n     * @param tPropertyOrCaller \r\n     * @returns \r\n     */\r\n    static unbind(group: any, source: any, property?: string | Array<string>, targetOrCallBack?: any | Function, tPropertyOrCaller?: string | any): void {\r\n        let binder: PropertyBinder = source[\"$PropertyBinder\"];\r\n        if (!binder) {\r\n            return;\r\n        }\r\n        binder.unbind(group, property, targetOrCallBack, tPropertyOrCaller);\r\n    }\r\n\r\n\r\n    /**\r\n     * \u6DFB\u52A0\u51FD\u6570\u94A9\u5B50\r\n     * @param group \r\n     * @param source \r\n     * @param functionName \r\n     * @param preHandler \r\n     * @param laterHandler \r\n     */\r\n    static addHook(group: any, source: any, functionName: string, preHandler: Handler, laterHandler: Handler): void {\r\n        let hook: FunctionHook = source[\"$FunctionHook\"];\r\n        if (!hook) {\r\n            hook = new FunctionHook(source);\r\n            source[\"$FunctionHook\"] = hook;\r\n        }\r\n        hook.addHook(group, functionName, preHandler, laterHandler);\r\n    }\r\n\r\n    /**\r\n     * \u5220\u9664\u51FD\u6570\u94A9\u5B50\r\n     * @param group \r\n     * @param source \r\n     * @param functionName \r\n     * @param preHandler \r\n     * @param laterHandler \r\n     * @returns \r\n     */\r\n    static removeHook(group: any, source: any, functionName?: string, preHandler?: Handler, laterHandler?: Handler): void {\r\n        let hook: FunctionHook = source[\"$FunctionHook\"];\r\n        if (!hook) {\r\n            return;\r\n        }\r\n        hook.removeHook(group, functionName, preHandler, laterHandler);\r\n    }\r\n}", "import { Event } from \"../events/Event\";\r\nimport { EventDispatcher } from \"../events/EventDispatcher\";\r\n\r\n\r\n/**\r\n * \u5217\u8868\r\n */\r\nexport class List<T> extends EventDispatcher {\r\n\r\n    private __element: Array<T>;\r\n    /**\r\n     * \u662F\u5426\u4FDD\u8BC1\u5143\u7D20\u7684\u552F\u4E00\u6027\r\n     */\r\n    private __only: boolean = false;\r\n    /**\r\n     * \u5143\u7D20\u6570\u91CF(\u5185\u90E8\u518D\u589E\u5220\u65F6\u4F1A\u4FEE\u6539\u8FD9\u4E2A\u53C2\u6570\uFF0C\u5916\u90E8\u53EA\u505A\u8BA1\u7B97\u548C\u7ED1\u5B9A\u4F7F\u7528\uFF0C\u5207\u8BB0\u4E0D\u53EF\u505A\u8D4B\u503C\u64CD\u4F5C\uFF01)\r\n     */\r\n    count: number = 0;\r\n\r\n    constructor(only: boolean = true) {\r\n        super();\r\n        this.__only = only;\r\n        this.__element = [];\r\n    }\r\n\r\n    /**\r\n     * \u6DFB\u52A0\u5230\u672B\u5C3E(\u6CE8\u610F\u5982\u679C\u4FDD\u8BC1\u552F\u4E00\u6027\uFF0C\u90A3\u4E48\u91CD\u590D\u65F6\u5C31\u76F4\u63A5\u8FD4\u56DE)\r\n     * @param value \r\n     */\r\n    push(value: T): boolean {\r\n        if (this.__only) {\r\n            let index: number = this.__element.indexOf(value);\r\n            if (index >= 0) {\r\n                return false;\r\n            }\r\n        }\r\n        this.__element.push(value);\r\n        this.count = this.__element.length;\r\n        if (this.hasEvent(Event.ADD)) {\r\n            this.emit(Event.ADD, value);\r\n        }\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * \u6DFB\u52A0\u5230\u5217\u8868\u5934\u90E8(\u6CE8\u610F\u5982\u679C\u4FDD\u8BC1\u552F\u4E00\u6027\uFF0C\u90A3\u4E48\u91CD\u590D\u65F6\u5C31\u76F4\u63A5\u8FD4\u56DE)\r\n     * @param value \r\n     * @returns \r\n     */\r\n    unshift(value: T): boolean {\r\n        if (this.__only) {\r\n            let index: number = this.__element.indexOf(value);\r\n            if (index >= 0) {\r\n                return false;\r\n            }\r\n        }\r\n        this.__element.unshift(value);\r\n        this.count = this.__element.length;\r\n        if (this.hasEvent(Event.ADD)) {\r\n            this.emit(Event.ADD, value);\r\n        }\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * \u83B7\u53D6\u5E76\u5220\u9664\u6700\u540E\u4E00\u4E2A\u5143\u7D20\r\n     * @returns \r\n     */\r\n    pop(): T {\r\n        if (this.__element.length > 0) {\r\n            const result = this.__element.pop();\r\n            this.count = this.__element.length;\r\n            if (this.hasEvent(Event.REMOVE)) {\r\n                this.emit(Event.REMOVE, result);\r\n            }\r\n            return result;\r\n        }\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * \u83B7\u53D6\u5E76\u5220\u9664\u7B2C\u4E00\u4E2A\u5143\u7D20\r\n     * @returns \r\n     */\r\n    shift(): T {\r\n        if (this.__element.length > 0) {\r\n            const result = this.__element.shift();\r\n            this.count = this.__element.length;\r\n            if (this.hasEvent(Event.REMOVE)) {\r\n                this.emit(Event.REMOVE, result);\r\n            }\r\n            return result;\r\n        }\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * \u5220\u9664\u6307\u5B9A\u7D22\u5F15\u7684\u5143\u7D20\r\n     * @param index \r\n     */\r\n    removeAt(index: number): T {\r\n        if (index >= this.__element.length) {\r\n            throw new Error(\"\u5220\u9664\u7D22\u5F15\u8D85\u51FA\u8303\u56F4\uFF01\");\r\n        }\r\n        const result = this.__element[index];\r\n        this.__element.splice(index, 1);\r\n        this.count = this.__element.length;\r\n        if (this.hasEvent(Event.REMOVE)) {\r\n            this.emit(Event.REMOVE, result);\r\n        }\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * \u5220\u9664\u5143\u7D20\r\n     * @param value \r\n     */\r\n    remove(value: T): void {\r\n        let index: number = this.__element.indexOf(value);\r\n        if (index < 0) {\r\n            throw new Error(\"\u8981\u5220\u9664\u7684\u5185\u5BB9\u4E0D\u5728\u5217\u8868\u4E2D\uFF01\" + value);\r\n        }\r\n        const result = this.__element[index];\r\n        this.__element.splice(index, 1);\r\n        this.count = this.__element.length;\r\n        if (this.hasEvent(Event.REMOVE)) {\r\n            this.emit(Event.REMOVE, result);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \u79FB\u9664\u6240\u6709\u5143\u7D20\r\n     */\r\n    clear(): void {\r\n        this.count = 0;\r\n        this.__element.length = 0;\r\n        if (this.hasEvent(Event.CLEAR)) {\r\n            this.emit(Event.CLEAR);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \u5224\u65AD\u662F\u5426\u5305\u542B\r\n     * @param value \r\n     * @returns \r\n     */\r\n    has(value: T): boolean {\r\n        return this.find(value) >= 0;\r\n    }\r\n    \r\n    /**\r\n     * \u67E5\u627E\u5143\u7D20\u4E0B\u6807\r\n     * @param value \r\n     * @returns \r\n     */\r\n    find(value: T): number {\r\n        return this.__element.indexOf(value);\r\n    }\r\n\r\n    /**\r\n     * \u67E5\u627E\u5143\u7D20\u4E0B\u6807\r\n     * @param predicate \r\n     * @returns \r\n     */\r\n    findIndex(predicate: (value: T, index: number, obj: T[]) => unknown): number {\r\n        let index = this.__element.findIndex(predicate);\r\n        return index;\r\n    }\r\n\r\n    /**\r\n     * \u83B7\u53D6\u6307\u5B9A\u5143\u7D20\r\n     * @param index \r\n     * @returns \r\n     */\r\n    get(index: number): T {\r\n        if (index >= this.__element.length) {\r\n            throw new Error(\"\u8D85\u51FA\u7D22\u5F15\u8303\u56F4:\" + index + \"/\" + this.__element.length);\r\n        }\r\n        return this.__element[index];\r\n    }\r\n\r\n    /**\r\n     * \u6E90\u5217\u8868\u6570\u636E(\u6CE8\u610F\u4E0D\u8981\u76F4\u63A5\u8FDB\u884C\u589E\u5220\u64CD\u4F5C\uFF0C\u800C\u662F\u901A\u8FC7List.push....\u7B49\u63A5\u53E3\u8FDB\u884C\u64CD\u4F5C)\r\n     */\r\n    get elements(): Array<T> {\r\n        return this.__element;\r\n    }\r\n}", "import { DEBUG } from \"cc/env\";\r\nimport { ITicker } from \"../../ticker/ITicker\";\r\nimport { TickerManager } from \"../../ticker/TickerManager\";\r\nimport { RedPointNode } from \"./RedPointNode\";\r\nimport { IRedPointData } from \"./IRedPointData\";\r\nimport { IFuncConfig } from \"../IFuncConfig\";\r\n\r\n\r\n\r\n\r\nexport class RedPoint implements ITicker {\r\n\r\n    /**\u6BCF\u5E27\u8FD0\u884C\u68C0\u6D4B\u5668\u6570\u91CF */\r\n    static FRAME_RUN_COUNT: number = 2;\r\n\r\n    private __redPoints = new Map<number, RedPointNode>();\r\n    private __detectors = new Map<number, () => boolean>();\r\n    private __waiting = new Set<number>();\r\n    private __frameRunList: Array<number> = [];\r\n\r\n    constructor() {\r\n        TickerManager.addTicker(this);\r\n    }\r\n\r\n    tick(dt: number): void {\r\n        if (this.__waiting.size == 0) {\r\n            return;\r\n        }\r\n        let index: number = 0;\r\n        for (const id of this.__waiting) {\r\n            let detector = this.__detectors.get(id);\r\n            let isActive = detector();\r\n            let node = this.__redPoints.get(id);\r\n            node.isActive = isActive;\r\n            this.__frameRunList.push(id);\r\n            if (index > RedPoint.FRAME_RUN_COUNT) {\r\n                break;\r\n            }\r\n            index++;\r\n        }\r\n        for (let index = 0; index < this.__frameRunList.length; index++) {\r\n            const id = this.__frameRunList[index];\r\n            this.__waiting.delete(id);\r\n        }\r\n        this.__frameRunList.splice(0, this.__frameRunList.length);\r\n    }\r\n\r\n    /**\r\n     * \u6CE8\u518C\u7EA2\u70B9\u68C0\u6D4B\u5668(\u5185\u90E8\u63A5\u53E3\uFF0C\u5F00\u53D1\u65F6\u8BF7\u4F7F\u7528Module\u4E0A\u7684registerRedPoint\u65B9\u6CD5)\r\n     * @param id \r\n     * @param detector \r\n     */\r\n    register(id: number, detector: () => boolean): void {\r\n        if (this.__detectors.has(id)) {\r\n            throw new Error(`\u91CD\u590D\u6CE8\u518C\u7EA2\u70B9\u68C0\u6D4B${id}`);\r\n        }\r\n        this.__detectors.set(id, detector);\r\n    }\r\n\r\n    /**\r\n     * \u6CE8\u9500\u7EA2\u70B9\u68C0\u6D4B\u5668\r\n     * @param id \r\n     */\r\n    unregister(id: number): void {\r\n        this.__detectors.delete(id);\r\n    }\r\n\r\n    /**\r\n     * \u8BF7\u6C42\u68C0\u6D4B\r\n     * @param id \r\n     */\r\n    request(id: number): void {\r\n        if (!this.__detectors.has(id)) {\r\n            throw new Error(`\u68C0\u6D4B\u5668${id}\u4E0D\u5B58\u5728`);\r\n        }\r\n        this.__waiting.add(id);\r\n    }\r\n\r\n    /**\r\n     * \u521D\u59CB\u5316\u7EA2\u70B9\u7ED3\u6784\u4F53\r\n     * @param config \r\n     */\r\n    createByConfig(configs: Array<IFuncConfig>): void {\r\n        for (let index = 0; index < configs.length; index++) {\r\n            const config = configs[index];\r\n            let node = this.__createNode(config.id);\r\n            this.__redPoints.set(config.id, node);\r\n        }\r\n        for (let index = 0; index < configs.length; index++) {\r\n            const config = configs[index];\r\n            if (config.id == config.parent) {\r\n                continue;\r\n            }\r\n            let node = this.__redPoints.get(config.id);\r\n            let parent = this.__redPoints.get(config.parent);\r\n            node.parent = parent;\r\n            parent.addChild(node);\r\n        }\r\n        //\u8C03\u8BD5\u6A21\u5F0F\u4E0B\u68C0\u6D4B\u5FAA\u73AF\u5F15\u7528\r\n        if (DEBUG) {\r\n            let parents: Array<number> = [];\r\n            for (let index = 0; index < configs.length; index++) {\r\n                const config = configs[index];\r\n                let node = this.__redPoints.get(config.id);\r\n                parents.splice(0, parents.length);\r\n                this.checkCircularReference(node, parents);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \u901A\u8FC7\u6570\u636E\u521B\u5EFA\u8282\u70B9\r\n     * @param data \r\n     * @returns \r\n     */\r\n    createByData(data: IRedPointData): RedPointNode {\r\n        let node = new RedPointNode(data.id);\r\n        for (const child of data.children) {\r\n            if (typeof child == \"number\") {\r\n                let childNode: RedPointNode;\r\n                if (this.__redPoints.has(child)) {\r\n                    childNode = this.__redPoints.get(child);\r\n                } else {\r\n                    childNode = new RedPointNode(child);\r\n                }\r\n                node.addChild(childNode);\r\n            } else {\r\n                let childData: IRedPointData = <IRedPointData>child;\r\n                let childNode = this.createByData(childData);\r\n                node.addChild(childNode);\r\n            }\r\n        }\r\n        return node;\r\n    }\r\n\r\n    /**\r\n     * \u521B\u5EFA\u8282\u70B9\r\n     * @param id \r\n     * @param children \r\n     * @returns \r\n     */\r\n    create(id: number, children: Array<number>): RedPointNode {\r\n        if (this.__redPoints.has(id)) {\r\n            throw new Error(`\u8282\u70B9${id}\u5DF2\u5B58\u5728`);\r\n        }\r\n        let node = new RedPointNode(id);\r\n        for (let index = 0; index < children.length; index++) {\r\n            const childID = children[index];\r\n            if (childID == id) {\r\n                throw new Error(`\u8282\u70B9${id}\u4E0D\u80FD\u5305\u542B\u81EA\u5DF1`);\r\n            }\r\n            let childNode: RedPointNode;\r\n            if (this.__redPoints.has(childID)) {\r\n                childNode = this.__redPoints.get(childID);\r\n            } else {\r\n                childNode = this.__createNode(childID);\r\n            }\r\n            node.addChild(childNode);\r\n        }\r\n        this.__redPoints.set(id, node);\r\n        //\u8C03\u8BD5\u6A21\u5F0F\u4E0B\u68C0\u6D4B\u5FAA\u73AF\u5F15\u7528\r\n        if (DEBUG) {\r\n            let parents: Array<number> = [];\r\n            this.checkCircularReference(node, parents);\r\n        }\r\n        return node;\r\n    }\r\n\r\n    /**\r\n     * \u521B\u5EFA\u53F6\u5B50\u8282\u70B9\r\n     * @param id \r\n     * @returns \r\n     */\r\n    private __createNode(id: number): RedPointNode {\r\n        let node = new RedPointNode(id);\r\n        this.__redPoints.set(id, node);\r\n        return node;\r\n    }\r\n\r\n    /**\r\n     * \u68C0\u6D4B\u5FAA\u73AF\u5F15\u7528\r\n     * @param node \r\n     * @param parents \r\n     */\r\n    checkCircularReference(node: RedPointNode, parents: Array<number>): void {\r\n        if (parents.indexOf(node.id) >= 0) {\r\n            throw new Error(`\u8282\u70B9${node.id}\u5B58\u5728\u5FAA\u73AF\u5F15\u7528`);\r\n        } else {\r\n            parents.push(node.id);\r\n            for (let index = 0; index < node.children.length; index++) {\r\n                const childNode = node.children[index];\r\n                if (childNode.children.length > 0) {\r\n                    this.checkCircularReference(childNode, parents);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \u83B7\u53D6\u7EA2\u70B9\u8282\u70B9\r\n     * @param id \r\n     * @returns \r\n     */\r\n    getNode(id: number): RedPointNode {\r\n        return this.__redPoints.get(id);\r\n    }\r\n\r\n    private static __instance: RedPoint;\r\n    static get single(): RedPoint {\r\n        if (this.__instance) {\r\n            this.__instance = new RedPoint();\r\n        }\r\n        return this.__instance;\r\n    }\r\n}", "import { Event } from \"../../events/Event\";\r\nimport { EventDispatcher } from \"../../events/EventDispatcher\";\r\nimport { TickerManager } from \"../../ticker/TickerManager\";\r\n\r\n\r\n\r\n/**\r\n * \u7EA2\u70B9\u8282\u70B9\r\n */\r\nexport class RedPointNode extends EventDispatcher {\r\n\r\n    id: number;\r\n\r\n    parent: RedPointNode | null = null;\r\n\r\n    private __children: RedPointNode[];\r\n    private __isActive: boolean = false;\r\n\r\n    constructor(id: number) {\r\n        super();\r\n        this.id = id;\r\n        this.__children = [];\r\n    }\r\n\r\n    /**\r\n     * \u6DFB\u52A0\u5B50\u8282\u70B9\r\n     * @param node \r\n     */\r\n    addChild(node: RedPointNode) {\r\n        this.__children = this.__children || [];\r\n        node.parent = this;\r\n        this.__children.push(node);\r\n        this.childrenChanged();\r\n    }\r\n\r\n    /**\r\n     * \u5220\u9664\u5B50\u8282\u70B9\r\n     * @param node\r\n     */\r\n    removeChild(node: RedPointNode) {\r\n        this.__children = this.__children || [];\r\n        node.parent = null;\r\n        const index = this.__children.indexOf(node);\r\n        if (index !== -1) {\r\n            this.__children.splice(index, 1);\r\n        }\r\n        this.childrenChanged();\r\n    }\r\n\r\n    get children(): RedPointNode[] {\r\n        return this.__children;\r\n    }\r\n\r\n    set isActive(value: boolean) {\r\n        this.__isActive = value;\r\n        // \u901A\u77E5\u7236\u8282\u70B9\r\n        if (this.parent) {\r\n            this.parent.childrenChanged();\r\n        }\r\n        this.emit(Event.UPDATE);\r\n    }\r\n\r\n    /**\r\n     * \u5B50\u8282\u70B9\u6539\u53D8\r\n     */\r\n    childrenChanged(): void {\r\n        TickerManager.callNextFrame(this.__childrenChanged, this);\r\n    }\r\n    \r\n    private __childrenChanged() {\r\n        let active = false;\r\n        for (let index = 0; index < this.__children.length; index++) {\r\n            const node = this.__children[index];\r\n            if (node.isActive) {\r\n                active = true;\r\n                break;\r\n            }\r\n        }\r\n        this.isActive = active;\r\n    }\r\n\r\n    get isActive(): boolean {\r\n        return this.__isActive;\r\n    }\r\n}", "import { DEBUG } from \"cc/env\";\r\nimport { FuncNode } from \"./FuncNode\";\r\nimport { IFuncData } from \"./IFuncData\";\r\nimport { IFuncConfig } from \"./IFuncConfig\";\r\nimport { EventDispatcher } from \"../events/EventDispatcher\";\r\nimport { Event } from \"../events/Event\";\r\n\r\n\r\n\r\n\r\n/**\r\n * \u529F\u80FD\u5F00\u653E\r\n */\r\nexport class Func extends EventDispatcher {\r\n\r\n    /**\r\n     * \u8282\u70B9\u68C0\u6D4B\u51FD\u6570\r\n     */\r\n    checkFunc: (value: FuncNode) => boolean = (value: FuncNode) => {\r\n        if (!value.server) {\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    private __funcs = new Map<number, FuncNode>();\r\n\r\n    constructor() {\r\n        super();\r\n    }\r\n\r\n    /**\r\n     * \u521D\u59CB\u5316\r\n     * @param configs \r\n     */\r\n    init(configs: Array<IFuncConfig>): void {\r\n        for (let index = 0; index < configs.length; index++) {\r\n            const config = configs[index];\r\n            let node = this.__createNode(config.id, config);\r\n            this.__funcs.set(config.id, node);\r\n        }\r\n        for (let index = 0; index < configs.length; index++) {\r\n            const config = configs[index];\r\n            if (config.id == config.parent) {\r\n                continue;\r\n            }\r\n            let node = this.__funcs.get(config.id);\r\n            let parent = this.__funcs.get(config.parent);\r\n            node.parent = parent;\r\n            parent.addChild(node);\r\n        }\r\n        //\u8C03\u8BD5\u6A21\u5F0F\u4E0B\u68C0\u6D4B\u5FAA\u73AF\u5F15\u7528\r\n        if (DEBUG) {\r\n            let parents: Array<number> = [];\r\n            for (let index = 0; index < configs.length; index++) {\r\n                const config = configs[index];\r\n                let node = this.__funcs.get(config.id);\r\n                parents.splice(0, parents.length);\r\n                this.__checkCircularReference(node, parents);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \u66F4\u65B0\r\n     * @param server \r\n     */\r\n    update(server: IFuncData | Array<IFuncData>): void {\r\n        if (Array.isArray(server)) {\r\n            for (let index = 0; index < server.length; index++) {\r\n                const element = server[index];\r\n                this.__update(element);\r\n            }\r\n        } else {\r\n            this.__update(server);\r\n        }\r\n    }\r\n\r\n    private __update(server: IFuncData): void {\r\n        let node = this.__funcs.get(server.id);\r\n        node.update(server);\r\n        this.emit(Event.UPDATE, node);\r\n    }\r\n\r\n    /**\r\n     * \u68C0\u6D4B\u5FAA\u73AF\u5F15\u7528\r\n     * @param node \r\n     * @param parents \r\n     */\r\n    private __checkCircularReference(node: FuncNode, parents: Array<number>): void {\r\n        if (parents.indexOf(node.id) >= 0) {\r\n            throw new Error(`\u8282\u70B9${node.id}\u5B58\u5728\u5FAA\u73AF\u5F15\u7528`);\r\n        } else {\r\n            parents.push(node.id);\r\n            for (let index = 0; index < node.children.length; index++) {\r\n                const childNode = node.children[index];\r\n                this.__checkCircularReference(childNode, parents);\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    /**\r\n     * \u521B\u5EFA\u8282\u70B9\r\n     * @param id \r\n     * @param config \r\n     * @returns \r\n     */\r\n    private __createNode(id: number, config: any): FuncNode {\r\n        let result = new FuncNode(id);\r\n        result.config = config;\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * \u83B7\u53D6\u529F\u80FD\u8282\u70B9\r\n     * @param id \r\n     */\r\n    getNode(id: number): FuncNode {\r\n        return this.__funcs.get(id);\r\n    }\r\n\r\n    private static __instance: Func;\r\n    static get single(): Func {\r\n        if (!this.__instance) {\r\n            this.__instance = new Func();\r\n        }\r\n        return this.__instance;\r\n    }\r\n}", "import { Event } from \"../events/Event\";\r\nimport { EventDispatcher } from \"../events/EventDispatcher\";\r\nimport { Func } from \"./Func\";\r\nimport { IFuncConfig } from \"./IFuncConfig\";\r\nimport { IFuncData } from \"./IFuncData\";\r\n\r\n\r\n\r\n/**\r\n * \u529F\u80FD\u5F00\u653E\u53F6\u5B50\u8282\u70B9\r\n */\r\nexport class FuncNode extends EventDispatcher {\r\n\r\n    id: number;\r\n    parent: FuncNode;\r\n    config: IFuncConfig;\r\n    server: IFuncData;\r\n\r\n    private __isActive: boolean = false;\r\n    private __children: FuncNode[] = [];\r\n\r\n    constructor(id: number) {\r\n        super();\r\n        this.id = id;\r\n    }\r\n\r\n    addChild(node: FuncNode): void {\r\n        node.parent = this;\r\n        this.__children.push(node);\r\n    }\r\n\r\n    removeChild(node: FuncNode): void {\r\n        let index = this.__children.indexOf(node);\r\n        if (index > -1) {\r\n            this.__children.splice(index, 1);\r\n            node.parent = null;\r\n        }\r\n    }\r\n\r\n    get children(): FuncNode[] {\r\n        return this.__children;\r\n    }\r\n\r\n    update(server: IFuncData): void {\r\n        this.server = server;\r\n        let slefActive = Func.single.checkFunc(this);\r\n        if (!slefActive) {\r\n            this.isActive = false;\r\n            return;\r\n        }\r\n        let parent = this.parent;\r\n        while (parent) {\r\n            if (!parent.isActive) {\r\n                this.isActive = false;\r\n                break;\r\n            }\r\n            parent = parent.parent;\r\n        }\r\n        this.isActive = true;\r\n        for (let index = 0; index < this.__children.length; index++) {\r\n            const child = this.__children[index];\r\n            child.update(child.server);\r\n        }\r\n    }\r\n\r\n    set isActive(value: boolean) {\r\n        if (this.__isActive == value) return;\r\n        this.__isActive = value;\r\n        this.emit(Event.UPDATE);\r\n    }\r\n\r\n    get isActive(): boolean {\r\n        return false;\r\n    }\r\n}", "import { Component } from \"cc\";\r\nimport { ConfigManager } from \"../configs/ConfigManager\";\r\nimport { IConfigAccessor } from \"../configs/IConfigAccessor\";\r\nimport { Event } from \"../events/Event\";\r\nimport { EventDispatcher } from \"../events/EventDispatcher\";\r\nimport { ResURL } from \"../res/ResURL\";\r\nimport { ModuleManager } from \"./ModuleManager\";\r\nimport { IEventDispatcher } from \"../events/IEventDispatcher\";\r\nimport { ResRequest } from \"../res/ResRequest\";\r\nimport { RedPoint } from \"../func/redPoint/RedPoint\";\r\n\r\n\r\n/**\r\n * \u6A21\u5757\u811A\u672C\u57FA\u7840\u7C7B(\u6A21\u5757\u811A\u672C\u5B50\u7C7B\u5FC5\u987B\u4F7F\u7528@ccclass('XXXModule'))\r\n */\r\nexport class Module extends Component implements IEventDispatcher {\r\n    /**\r\n     * \u6A21\u5757\u540D\u79F0\r\n     */\r\n    module_name: string;\r\n    /**\r\n     * \u5F15\u7528\u7684\u914D\u7F6E\u8868\r\n     */\r\n    configs: Array<string>\r\n    /**\r\n     * \u4F9D\u8D56\u7684\u8D44\u6E90\r\n     */\r\n    assets: Array<ResURL>;\r\n    /**\r\n     * \u4F9D\u8D56\u7684\u6A21\u5757\r\n     */\r\n    modules: Array<string>;\r\n    /**\r\n     * \u6C38\u4E0D\u5220\u9664\r\n     */\r\n    notReleased: boolean = false;\r\n\r\n    /**\r\n     * \u8D44\u6E90\u8BF7\u6C42\u5BF9\u8C61\r\n     */\r\n    resRequest: ResRequest | null = null;\r\n    /**\r\n     * \u662F\u5426\u521D\u59CB\u5316\u5B8C\u6BD5\r\n     */\r\n    protected $inited: boolean = false;\r\n    \r\n    private __moduleIndex: number = 0;\r\n    private __eventProxy: EventDispatcher;\r\n    //\u7EA2\u70B9\u68C0\u6D4B\u5668\u6CE8\u518C\u7EAA\u5F8B\r\n    private __redPoints: Map<number, () => boolean>;\r\n    constructor() {\r\n        super();\r\n        this.__eventProxy = new EventDispatcher(this);\r\n        this.__redPoints = new Map<number, () => boolean>();\r\n    }\r\n\r\n    /**\r\n     * \u524D\u7F6E\u521D\u59CB\u5316\r\n     */\r\n    preInit(): void {\r\n        if (this.modules && this.modules.length > 0) {\r\n            this.__moduleIndex = 0;\r\n            ModuleManager.single.load(this.modules, undefined, (err: Error) => {\r\n                if (err) {\r\n                    throw new Error(\"\u6A21\u5757\u521D\u59CB\u5316\u5931\u8D25:\" + err.message);\r\n                }\r\n                for (let index = 0; index < this.modules.length; index++) {\r\n                    const clazz = this.modules[index];\r\n                    const module = this.$getModule(clazz);\r\n                    const proxy = ModuleManager.single.getModuleProxy(clazz);\r\n                    //\u5F15\u7528\r\n                    proxy.addRef();\r\n                    if (module.$inited) {\r\n                        this.__moduleIndex++;\r\n                    } else {\r\n                        module.on(Event.COMPLETE, this.__otherModuleInitComplete, this);\r\n                    }\r\n                }\r\n                //\u5B8C\u6210\r\n                const total = this.modules ? this.modules.length : 0;\r\n                // console.log(this.name, this.__moduleIndex + \"/\" + total);\r\n                if (this.__moduleIndex > total) {\r\n                    this.init();\r\n                }\r\n                this.on(Event.COMPLETE, this.__otherModuleInitComplete, this);\r\n                this.selfInit();\r\n            }, true);\r\n        } else {\r\n            this.on(Event.COMPLETE, this.__otherModuleInitComplete, this);\r\n            this.selfInit();\r\n        }\r\n    }\r\n\r\n    private __otherModuleInitComplete(e: Event): void {\r\n        const module = e.target as Module;\r\n        module.off(Event.COMPLETE, this.__otherModuleInitComplete, this);\r\n        this.__moduleIndex++;\r\n        const total = this.modules ? this.modules.length : 0;\r\n        // console.log(this.name, this.__moduleIndex + \"/\" + total);\r\n        //\u5B8C\u6210\r\n        if (this.__moduleIndex > total) {\r\n            this.init();\r\n        }\r\n    }\r\n\r\n    /**\u81EA\u8EAB\u521D\u59CB\u5316(\u5B50\u7C7B\u91CD\u5199\u5E76\u5728\u521D\u59CB\u5316\u5B8C\u6210\u540E\u8C03\u7528selfInitComplete) */\r\n    protected selfInit(): void {\r\n        this.selfInitComplete();\r\n    }\r\n\r\n    /**\r\n     * \u81EA\u8EAB\u521D\u59CB\u5316\u5B8C\u6210\r\n     */\r\n    protected selfInitComplete(): void {\r\n        this.$inited = true;\r\n        this.emit(Event.COMPLETE);\r\n    }\r\n\r\n    /**\r\n     * \u521D\u59CB\u5316\r\n     */\r\n    init(): void {\r\n\r\n    }\r\n\r\n    /**\r\n     * \u83B7\u53D6\u914D\u7F6E\u5B58\u53D6\u5668\r\n     * @param config \r\n     * @returns \r\n     */\r\n    getConfigAccessor(config: string): IConfigAccessor {\r\n        return ConfigManager.getAccessor(config);\r\n    }\r\n\r\n    /**\r\n     * \u83B7\u53D6\u6A21\u5757\r\n     * @param module_name \r\n     * @returns \r\n     */\r\n    protected $getModule(module_name: string): Module {\r\n        if (!this.modules || this.modules.indexOf(module_name) < 0) {\r\n            throw new Error(\"\u6A21\u5757\u4E0D\u5B58\u5728:\" + module_name);\r\n        }\r\n        return ModuleManager.single.getModule(module_name)!;\r\n    }\r\n\r\n    /**\r\n     * \u6CE8\u518C\u7EA2\u70B9\u68C0\u6D4B\u5668\r\n     * @param id \r\n     * @param detector \r\n     */\r\n    registerRedPoint(id: number, detector: () => boolean): void {\r\n        this.__redPoints.set(id, detector);\r\n        RedPoint.single.register(id, detector);\r\n    }\r\n\r\n\r\n    destroy(): boolean {\r\n        //\u53D6\u6D88\r\n        this.configs = null;\r\n        //\u53D6\u6D88\u5BF9\u6A21\u5757\u7684\u5F15\u7528\r\n        if (this.modules && this.modules.length > 0) {\r\n            for (let index = 0; index < this.modules.length; index++) {\r\n                const element = this.modules[index];\r\n                ModuleManager.single.dispose(element);\r\n            }\r\n            this.modules = null;\r\n        }\r\n        this.notReleased = false;\r\n        this.assets = null;\r\n        if (this.resRequest) {\r\n            this.resRequest.dispose();\r\n            this.resRequest = null;\r\n        }\r\n        //\u7EA2\u70B9\r\n        for (const [key, _] of this.__redPoints) {\r\n            RedPoint.single.unregister(key);\r\n        }\r\n        this.__redPoints.clear();\r\n        this.__redPoints = null;\r\n\r\n        this.$inited = false;\r\n        this.__moduleIndex = 0;\r\n        return super.destroy();\r\n    }\r\n\r\n    /**\r\n     * \u83B7\u53D6\u662F\u5426\u5DF2\u521D\u59CB\u5316\r\n     */\r\n    get inited(): boolean {\r\n        return this.$inited;\r\n    }\r\n\r\n    //=========================IEventDispatcher\u63A5\u53E3\u5B9E\u73B0\r\n    on(key: number | string, handler: (e: Event) => void, caller: any, priority?: number): void {\r\n        this.__eventProxy.on(key, handler, caller, priority);\r\n    }\r\n    off(key: number | string, handler: (e: Event) => void, caller: any): void {\r\n        this.__eventProxy.off(key, handler, caller);\r\n    }\r\n    offByCaller(caller: any): void {\r\n        this.__eventProxy.offByCaller(caller);\r\n    }\r\n    offAllEvent(): void {\r\n        this.__eventProxy.offAllEvent();\r\n    }\r\n    emit(key: number | string, data?: any): void {\r\n        this.__eventProxy.emit(key, data);\r\n    }\r\n    hasEvent(key: number | string): boolean {\r\n        return this.__eventProxy.hasEvent(key);\r\n    }\r\n    hasEventHandler(key: number | string, handler: (e: Event) => void, caller: any): boolean {\r\n        return this.__eventProxy.hasEventHandler(key, handler, caller);\r\n    }\r\n}", "import { Res } from \"../res/Res\";\r\nimport { ResourceManager } from \"../res/resources/ResourceManager\";\r\nimport { IConfigAccessor } from \"./IConfigAccessor\";\r\nimport { IConfigManager } from \"./IConfigManager\";\r\n\r\n\r\n\r\nexport class ConfigManagerImpl implements IConfigManager {\r\n\r\n    /**\r\n     * \u5B58\u53D6\u5668\r\n     */\r\n    private __accessors: Map<string, new () => IConfigAccessor>;\r\n    constructor() {\r\n        this.__accessors = new Map<string, new () => IConfigAccessor>();\r\n    }\r\n\r\n    /**\r\n     * \u6CE8\u518C\u5B58\u53D6\u5668\r\n     * @param sheet \r\n     * @param accessor\r\n     */\r\n    register(sheet: string, accessor: new () => IConfigAccessor): void {\r\n        if (this.__accessors.has(sheet)) {\r\n            if (this.__accessors.get(sheet) != accessor) {\r\n                throw new Error(`${sheet},\u91CD\u590D\u6CE8\u518C\u914D\u7F6E\u8868\u5B58\u53D6\u5668\u4E14\u5B58\u53D6\u5668\u7C7B\u578B\u4E0D\u4E00\u81F4!`);\r\n            } else {\r\n                return;\r\n            }\r\n        }\r\n        this.__accessors.set(sheet, accessor);\r\n    }\r\n\r\n    /**\r\n     * \u6CE8\u9500\r\n     * @param sheet \r\n     */\r\n    unregister(sheet: string): void {\r\n        this.__accessors.delete(sheet);\r\n    }\r\n\r\n    /**\r\n     * \u83B7\u53D6\u5B58\u53D6\u5668\u7C7B\r\n     * @param sheet \r\n     * @returns \r\n     */\r\n    getAccessorClass(sheet: string): new () => IConfigAccessor {\r\n        if (!this.__accessors.has(sheet)) {\r\n            throw new Error(`${sheet},\u914D\u7F6E\u8868\u5B58\u53D6\u5668\u672A\u6CE8\u518C!`);\r\n        }\r\n        return this.__accessors.get(sheet)!;\r\n    }\r\n\r\n    /**\r\n     * \u83B7\u53D6\u5B58\u53D6\u5668\r\n     * @param sheet \r\n     * @returns \r\n     */\r\n    getAccessor(sheet: string): IConfigAccessor {\r\n        if (Res.sheet2URL == undefined) {\r\n            throw new Error(\"Res.sheet2URL\u672A\u5B9A\u4E49!\u8BF7\u5728\u521D\u59CB\u5316\u524D\u8BBE\u7F6E!\");\r\n        }\r\n        const url = Res.sheet2URL(sheet);\r\n        const urlKey = Res.url2Key(url);\r\n        if (!ResourceManager.hasRes(urlKey)) {\r\n            throw new Error(sheet + \"\u672A\u52A0\u8F7D!\");\r\n        }\r\n        let res = ResourceManager.getRes(urlKey)!;\r\n        return res.content;\r\n    }\r\n}", "import { Injector } from \"../utils/Injector\";\r\nimport { ConfigManagerImpl } from \"./ConfigManagerImpl\";\r\nimport { IConfigAccessor } from \"./IConfigAccessor\";\r\nimport { IConfigManager } from \"./IConfigManager\";\r\n\r\n\r\n/**\r\n * \u914D\u7F6E\u8868\u7BA1\u7406\u5668\r\n */\r\nexport class ConfigManager {\r\n\r\n    static KEY: string = \"ConfigManager\"\r\n    \r\n    /**\r\n      * \u6CE8\u518C\u5B58\u53D6\u5668\r\n      * @param sheet \r\n      * @param accessors \r\n      */\r\n    static register(sheet: string, accessors: new () => IConfigAccessor): void {\r\n        this.impl.register(sheet, accessors);\r\n    }\r\n    \r\n    /**\r\n     * \u6CE8\u9500\r\n     * @param sheet \r\n     */\r\n    static unregister(sheet:string):void{\r\n        this.impl.unregister(sheet);\r\n    }\r\n\r\n    /**\r\n     * \u83B7\u53D6\u5B58\u53D6\u5668\u7C7B\r\n     * @param sheet \r\n     * @returns \r\n     */\r\n    static getAccessorClass(sheet: string): new () => IConfigAccessor {\r\n        return this.impl.getAccessorClass(sheet);\r\n    }\r\n\r\n    /**\r\n     * \u83B7\u53D6\u914D\u7F6E\u5B58\u53D6\u5668\r\n     * @param sheet\r\n     */\r\n    static getAccessor(sheet: string): IConfigAccessor {\r\n        return this.impl.getAccessor(sheet);\r\n    }\r\n\r\n    private static __impl: IConfigManager;\r\n    private static get impl(): IConfigManager {\r\n        if (this.__impl == null) {\r\n            this.__impl = Injector.getInject(this.KEY);\r\n        }\r\n        if (this.__impl == null) {\r\n            this.__impl=new ConfigManagerImpl();\r\n        }\r\n        return this.__impl;\r\n    }\r\n}", "import { Node } from \"cc\";\r\nimport { ITicker } from \"../ticker/ITicker\";\r\nimport { TickerManager } from \"../ticker/TickerManager\";\r\nimport { Timer } from \"../timer/Timer\";\r\nimport { Module } from \"./Module\";\r\nimport { ModuleProxy } from \"./ModuleProxy\";\r\nimport { ModuleRequest } from \"./ModuleRequest\";\r\nimport { Logger } from \"../loggers/Logger\";\r\n\r\n\r\n/**\r\n * \u6A21\u5757\u7BA1\u7406\u5668\r\n */\r\nexport class ModuleManager implements ITicker {\r\n    /**\r\n     * \u6A21\u5757\u8282\u70B9(\u7528\u4E8E\u52A0\u8F7D\u6A21\u5757)\r\n     */\r\n    node: Node = new Node(\"ModuleManager\");\r\n    /**\r\n     * \u6700\u5927\u542F\u52A8\u7EBF\u7A0B\r\n     */\r\n    static MAX_LOADER_THREAD: number = 5;\r\n    /**\r\n     * GC\u95F4\u9694\u65F6\u95F4\r\n     */\r\n    static GC_INTERVAL: number = 60;\r\n    /**\r\n     * \u5DF2\u52A0\u8F7D\u7684\u6A21\u5757\r\n     */\r\n    private __modules: Map<string, ModuleProxy>;\r\n    /**\r\n     * \u52A0\u8F7D\u6A21\u5757\u8BF7\u6C42\u5217\u8868\r\n     */\r\n    private __requests: Map<string, Array<ModuleRequest>>;\r\n    /**\r\n     * \u7B49\u5F85\u5220\u9664\u7684\u6A21\u5757\r\n     */\r\n    private __waitDeletes: Set<string>;\r\n\r\n    private __lastGCTime: number = 0;\r\n    constructor() {\r\n        this.__modules = new Map<string, ModuleProxy>();\r\n        this.__requests = new Map<string, Array<ModuleRequest>>();\r\n        this.__waitDeletes = new Set<string>();\r\n        TickerManager.addTicker(this);\r\n    }\r\n\r\n    tick(dt: number): void {\r\n        let currentTime = Timer.currentTime;\r\n        if (currentTime - this.__lastGCTime > ModuleManager.GC_INTERVAL) {\r\n            for (const module_name of this.__waitDeletes) {\r\n                let proxy = this.getModuleProxy(module_name);\r\n                if (!proxy || !proxy.module || proxy.module.notReleased) continue;\r\n                if (proxy.refCount <= 0) {\r\n                    Logger.log(\"Module Destroy:\" + proxy.module.name, Logger.TYPE.Module);\r\n                    this.__modules.delete(module_name);\r\n                    proxy.destroy();\r\n                }\r\n            }\r\n            this.__waitDeletes.clear();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \u52A0\u8F7D\r\n     * @param modules \r\n     * @param progress \r\n     * @param callback \r\n     * @param isSub\r\n     */\r\n    load(modules: Array<string>, progress?: (progress: number) => void, callback?: (err: Error) => void, isSub?: boolean): void {\r\n        let request: ModuleRequest = new ModuleRequest(modules, progress, callback, isSub);\r\n        this.__addRequest(request);\r\n        request.load();\r\n    }\r\n\r\n    childComplete(module_name: string, proxy: ModuleProxy): void {\r\n        //\u4FDD\u5B58\r\n        this.__modules.set(module_name, proxy);\r\n        //\u901A\u77E5\r\n        let list = this.__requests.get(module_name);\r\n        for (let index = 0; index < list.length; index++) {\r\n            const request = list[index];\r\n            request.childComplete(module_name);\r\n        }\r\n        list.length = 0;\r\n        this.__requests.delete(module_name);\r\n    }\r\n\r\n    childError(module_name: string, err: Error): void {\r\n        let list = this.__requests.get(module_name);\r\n        for (let index = 0; index < list.length; index++) {\r\n            const request = list[index];\r\n            request.childError(module_name, err);\r\n        }\r\n        //\u590D\u5236\r\n        let clist = list.concat();\r\n        //\u6E05\u9664\u6389\u5173\u8054\u7684\u6240\u6709\u8D44\u6E90\u8BF7\u6C42\r\n        for (let index = 0; index < clist.length; index++) {\r\n            const request = clist[index];\r\n            this.__removeRequest(request);\r\n            //\u9500\u6BC1\r\n            request.destroy();\r\n        }\r\n    }\r\n\r\n    childProgress(module_name: string, progress: number): void {\r\n        let list = this.__requests.get(module_name);\r\n        for (let index = 0; index < list.length; index++) {\r\n            const request = list[index];\r\n            request.childProgress(module_name, progress);\r\n        }\r\n    }\r\n\r\n    private __addRequest(request: ModuleRequest): void {\r\n        let list: Array<ModuleRequest>;\r\n        for (let index = 0; index < request.modules.length; index++) {\r\n            const module = request.modules[index];\r\n            if (!this.__requests.has(module)) {\r\n                list = [];\r\n                this.__requests.set(module, list);\r\n            } else {\r\n                list = this.__requests.get(module);\r\n            }\r\n            list.push(request);\r\n        }\r\n    }\r\n\r\n    private __removeRequest(request: ModuleRequest): void {\r\n        let list: Array<ModuleRequest>;\r\n        let findex: number = 0;\r\n        //\u904D\u5386\u5F53\u524D\u8BF7\u6C42\u7684\u6240\u6709\r\n        for (let index = 0; index < request.modules.length; index++) {\r\n            const module = request.modules[index];\r\n            //\u4ECE\u5217\u8868\u4E2D\u627E\u51FA\u5E76\u5220\u9664\r\n            list = this.__requests.get(module);\r\n            findex = list.indexOf(request);\r\n            if (findex >= 0) {\r\n                list.splice(findex, 1);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \u83B7\u53D6\u4EE3\u7406(\u5185\u90E8\u63A5\u53E3\uFF0C\u8BF7\u52FF\u4F7F\u7528)\r\n     * @param module_name \r\n     * @returns \r\n     */\r\n    getModuleProxy(module_name: string): ModuleProxy {\r\n        if (!this.__modules.has(module_name)) {\r\n            return null;\r\n        }\r\n        return this.__modules.get(module_name);\r\n    }\r\n\r\n    /**\r\n     * \u83B7\u53D6\u670D\u52A1(\u5185\u90E8\u63A5\u53E3\uFF0C\u8BF7\u52FF\u4F7F\u7528)\r\n     * @param module_name \r\n     */\r\n    getModule(module_name: string): Module | null {\r\n        let proxy = this.getModuleProxy(module_name);\r\n        if (proxy == null) {\r\n            return null;\r\n        }\r\n        return proxy.module;\r\n    }\r\n\r\n    /**\r\n     * \u5C1D\u8BD5\u9500\u6BC1\u670D\u52A1\r\n     * @param clazz\r\n     */\r\n    dispose(module_name: string): void {\r\n        let proxy = this.__modules.get(module_name);\r\n        proxy.removeRef();\r\n        this.__waitDeletes.add(module_name);\r\n    }\r\n    \r\n    private static __instance: ModuleManager;\r\n    static get single(): ModuleManager {\r\n        if (!this.__instance) {\r\n            this.__instance = new ModuleManager();\r\n        }\r\n        return this.__instance;\r\n    }\r\n}", "import { AssetManager, assetManager } from \"cc\";\r\nimport { Event } from \"../events/Event\";\r\nimport { EventDispatcher } from \"../events/EventDispatcher\";\r\nimport { Res } from \"../res/Res\";\r\nimport { ResURL } from \"../res/ResURL\";\r\nimport { Module } from \"./Module\";\r\nimport { ModuleManager } from \"./ModuleManager\";\r\nimport { ModuleProxy } from \"./ModuleProxy\";\r\nimport { ResRequest } from \"../res/ResRequest\";\r\nimport { Logger } from \"../loggers/Logger\";\r\n\r\n\r\n\r\n/**\r\n * \u6A21\u5757\u52A0\u8F7D\u5668\r\n */\r\nexport class ModuleLoader extends EventDispatcher {\r\n\r\n    /**\r\n     * \u6A21\u5757\u540D\u79F0\r\n     */\r\n    module_name: string;\r\n    /**\r\n     * \u6A21\u5757\u5B9E\u4F8B\r\n     */\r\n    module: Module;\r\n    /**\r\n     * \u8D44\u6E90\u8BF7\u6C42\u5BF9\u8C61\r\n     */\r\n    resRequest: ResRequest | null = null;\r\n\r\n    constructor() {\r\n        super();\r\n    }\r\n\r\n    load(module_name: string): void {\r\n        this.module_name = module_name;\r\n        //\u5982\u679C\u5DF2\u7ECF\u5B58\u5728\r\n        let module = ModuleManager.single.node.getComponent(\"Module_\" + this.module_name);\r\n        if (module) {\r\n            if (!(module instanceof Module)) {\r\n                throw new Error(\"\u6A21\u5757Module_\" + this.module_name + \"\u5FC5\u987B\u7EE7\u627FModule\u7C7B\");\r\n            }\r\n            this.module = module as Module;\r\n            this.__initModule();\r\n        } else {\r\n            Logger.log(\"Start Load Module:\" + this.module_name);\r\n            let bundle = assetManager.getBundle(module_name);\r\n            if (!bundle) {\r\n                assetManager.loadBundle(module_name, this.__bundleLoaded.bind(this));\r\n            } else {\r\n                this.__bundleLoaded(null, bundle);\r\n            }\r\n        }\r\n    }\r\n\r\n    private __bundleLoaded(err: Error, bundle: AssetManager.Bundle): void {\r\n        if (err) {\r\n            this.emit(Event.ERROR, this.module_name, new Error(\"AssetBundle:\" + this.module_name + \"\u4E0D\u5B58\u5728\uFF01\"));\r\n            return;\r\n        }\r\n        try {\r\n            this.module = ModuleManager.single.node.addComponent(\"Module_\" + this.module_name) as Module;\r\n        } catch (error) {\r\n            throw new Error(\"\u6A21\u5757Module_\" + this.module_name + \"\u521D\u59CB\u5316\u62A5\u9519:\" + error);\r\n        }\r\n        this.module.module_name = this.module_name;\r\n        if (!this.module) {\r\n            throw new Error(\"\u6A21\u5757\u7C7BModule_\" + this.module_name + \"\u4E0D\u5B58\u5728\uFF01\");\r\n        }\r\n        if (!(this.module instanceof Module)) {\r\n            throw new Error(\"\u6A21\u5757Module_\" + this.module_name + \"\u5FC5\u987B\u7EE7\u627FModule\u7C7B\");\r\n        }\r\n        try {\r\n            this.__initModule();\r\n        } catch (error) {\r\n            Logger.error(\"Load Module Error:\" + this.module_name);\r\n        }\r\n    }\r\n\r\n    private __initModule(): void {\r\n        //\u914D\u7F6E\u8868\r\n        let urls: Array<ResURL> = [];\r\n        if (this.module.configs && this.module.configs.length > 0) {\r\n            for (let index = 0; index < this.module.configs.length; index++) {\r\n                const sheet_name = this.module.configs[index];\r\n                const url = Res.sheet2URL(sheet_name);\r\n                urls.push(url);\r\n            }\r\n        }\r\n        //\u5F15\u7528\u7684\u8D44\u6E90\r\n        if (this.module.assets && this.module.assets.length > 0) {\r\n            for (let index = 0; index < this.module.assets.length; index++) {\r\n                const element = this.module.assets[index];\r\n                urls.push(element);\r\n            }\r\n        }\r\n        if (urls.length > 0) {\r\n            //\u52A0\u8F7D\r\n            this.resRequest = Res.create(\r\n                urls,\r\n                this.module.name,\r\n                (progress: number) => {\r\n                    this.emit(Event.PROGRESS, this.module_name, undefined, progress * 0.7);\r\n                },\r\n                (err?: Error) => {\r\n                    if (err) {\r\n                        this.resRequest.dispose();\r\n                        this.resRequest = null;\r\n                        this.emit(Event.ERROR, this.module_name, err)\r\n                        return;\r\n                    }\r\n                    this.__assetReady();\r\n                }\r\n            );\r\n            this.resRequest.load();\r\n        } else {\r\n            this.__assetReady();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \u4F9D\u8D56\u7684\u914D\u7F6E\u4E0E\u8D44\u6E90\u51C6\u5907\u5B8C\u6BD5\r\n     */\r\n    protected __assetReady(): void {\r\n        this.module.resRequest = this.resRequest;\r\n        this.module.preInit();\r\n        let proxy = new ModuleProxy(this.module);\r\n        this.emit(Event.COMPLETE, { module: this.module_name, proxy });\r\n    }\r\n\r\n    reset(): void {\r\n        this.module_name = null;\r\n        this.module = null;\r\n    }\r\n}", "import { Module } from \"./Module\";\r\n\r\n\r\n\r\nexport class ModuleProxy{\r\n\r\n    module: Module;\r\n    /**\r\n     * \u5F15\u7528\u8BA1\u6570\u5668\r\n     */\r\n    refCount: number = 0;\r\n\r\n    constructor(module: Module) {\r\n        this.module = module;\r\n        this.refCount = 0;\r\n    }\r\n\r\n    addRef(): void {\r\n        this.refCount++;\r\n    }\r\n\r\n    removeRef(): void {\r\n        this.refCount--;\r\n    }\r\n\r\n    destroy(): boolean {\r\n        this.module.destroy();\r\n        this.module = null;\r\n        return true;\r\n    }\r\n}", "import { Dictionary } from \"../containers/Dictionary\";\r\nimport { Event } from \"../events/Event\";\r\nimport { Pool } from \"../pools/Pool\";\r\nimport { TickerManager } from \"../ticker/TickerManager\";\r\nimport { ModuleLoader } from \"./ModuleLoader\";\r\nimport { ModuleManager } from \"./ModuleManager\";\r\n\r\n\r\n\r\n/**\r\n * \u6A21\u5757\u52A0\u8F7D\u961F\u5217\r\n */\r\nexport class ModuleQueue {\r\n\r\n    /**\r\n     * \u6B63\u5728\u52A0\u8F7D\u7684\u6A21\u5757\r\n     */\r\n    private running: Dictionary<string, ModuleLoader> = new Dictionary<string, ModuleLoader>();\r\n    /**\r\n     * \u7B49\u5F85\u52A0\u8F7D\u7684\u6A21\u5757\r\n     */\r\n    private waiting: Array<string> = [];\r\n\r\n    constructor() {\r\n        TickerManager.addTicker(this);\r\n    }\r\n\r\n    load(module_name: string, isSub: boolean): void {\r\n        if (this.running.has(module_name)) {\r\n            return;\r\n        }\r\n        let idx = this.waiting.indexOf(module_name)\r\n        if (isSub && idx >= 0) {\r\n            this.waiting.splice(idx, 1);\r\n            this.__startLoad(module_name);\r\n            return;\r\n        }\r\n        //\u5DF2\u7ECF\u5728\u7B49\u5F85\u5217\u8868\u4E2D\r\n        if (idx >= 0) {\r\n            return;\r\n        }\r\n        this.waiting.push(module_name);\r\n    }\r\n\r\n    tick(dt: number): void {\r\n        while (this.running.size < ModuleManager.MAX_LOADER_THREAD && this.waiting.length > 0) {\r\n            const module = this.waiting.shift();\r\n            this.__startLoad(module);\r\n        }\r\n    }\r\n\r\n    private __startLoad(module_name: string): void {\r\n        let loader: ModuleLoader = Pool.acquire(ModuleLoader);\r\n        this.running.set(module_name, loader);\r\n        this.__addEvent(loader);\r\n        loader.load(module_name);\r\n    }\r\n\r\n    private __addEvent(target: ModuleLoader): void {\r\n        target.on(Event.COMPLETE, this.__eventHandler, this);\r\n        target.on(Event.ERROR, this.__eventHandler, this);\r\n        target.on(Event.PROGRESS, this.__eventHandler, this);\r\n    }\r\n\r\n    private __eventHandler(evt: Event): void {\r\n        let target: ModuleLoader = evt.target as ModuleLoader;\r\n        if (evt.type == Event.PROGRESS) {\r\n            ModuleManager.single.childProgress(evt.data, evt.progress);\r\n            return;\r\n        }\r\n        target.offAllEvent();\r\n        if (evt.type == Event.ERROR) {\r\n            this.running.delete(evt.data);\r\n            ModuleManager.single.childError(evt.data, evt.error);\r\n            return;\r\n        }\r\n        if (evt.type == Event.COMPLETE) {\r\n            this.running.delete(evt.data.module);\r\n            ModuleManager.single.childComplete(evt.data.module, evt.data.proxy);\r\n            target.reset();\r\n            Pool.release(ModuleLoader, target);\r\n        }\r\n    }\r\n\r\n    private static instance: ModuleQueue;\r\n    static get single(): ModuleQueue {\r\n        if (this.instance == null) {\r\n            this.instance = new ModuleQueue();\r\n        }\r\n        return this.instance;\r\n    }\r\n}", "import { ModuleManager } from \"./ModuleManager\";\r\nimport { ModuleQueue } from \"./ModuleQueue\";\r\n\r\n\r\n\r\n\r\nexport class ModuleRequest {\r\n    /**\r\n     * \u662F\u5426\u662F\u5B50\u670D\u52A1(\u5B50\u670D\u52A1\u5728\u52A0\u8F7D\u65F6\u4E0D\u5360\u7528\u52A0\u8F7D\u7EBF\u7A0B)\r\n     */\r\n    isSub: boolean = false;\r\n    modules: Array<string>;\r\n    private __progress: (progress: number) => void;\r\n    private __callback: (err: Error) => void;\r\n    private __loadedMap: Map<string, number>;\r\n\r\n    constructor(modules: Array<string>, progress?: (progress: number) => void, callback?: (err: Error) => void, isSub?: boolean) {\r\n        this.__loadedMap = new Map<string, number>();\r\n        this.isSub = isSub;\r\n        this.modules = modules;\r\n        this.__progress = progress;\r\n        this.__callback = callback;\r\n    }\r\n\r\n    load(): void {\r\n        this.__loadedMap.clear();\r\n        let isLoading: boolean = false;\r\n        for (let index = 0; index < this.modules.length; index++) {\r\n            const module_name = this.modules[index];\r\n            const module = ModuleManager.single.getModule(module_name);\r\n            if (module) {\r\n                this.__loadedMap.set(module_name, 1);\r\n            } else {\r\n                isLoading = true;\r\n                ModuleQueue.single.load(module_name, this.isSub);\r\n            }\r\n        }\r\n        if (!isLoading) {\r\n            this.__checkComplete();\r\n        }\r\n    }\r\n\r\n    childComplete(module_name: string): void {\r\n        this.__loadedMap.set(module_name, 1);\r\n        this.__checkComplete();\r\n    }\r\n\r\n    childError(module_name: string, err: Error): void {\r\n        if (this.__callback) {\r\n            this.__callback(err);\r\n        }\r\n    }\r\n\r\n    childProgress(module_name: string, progress: number): void {\r\n        this.__loadedMap.set(module_name, progress);\r\n        let totalProgress: number = this.loaded / this.modules.length;\r\n        if (this.__progress) {\r\n            this.__progress(totalProgress);\r\n        }\r\n    }\r\n\r\n    private __checkComplete(): void {\r\n        let progress: number = this.loaded / this.modules.length;\r\n        if (this.__progress) {\r\n            this.__progress(progress);\r\n        }\r\n        //\u5B8C\u6210\r\n        if (progress == 1 && this.__callback != null) {\r\n            this.__callback(null);\r\n            this.destroy();\r\n        }\r\n    }\r\n\r\n    private get loaded(): number {\r\n        let loaded: number = 0;\r\n        for (let value of this.__loadedMap.values()) {\r\n            loaded += value;\r\n        }\r\n        return loaded;\r\n    }\r\n\r\n    destroy(): void {\r\n        this.modules = null;\r\n        this.__progress = null;\r\n        this.__callback = null;\r\n    }\r\n}", "import { Logger } from \"../../loggers/Logger\";\r\n\r\n/**\r\n * http\r\n */\r\nexport class Http {\r\n\r\n    /**\r\n     * get\u8BF7\u6C42\r\n     * @param url \r\n     * @param param \r\n     * @param callback \r\n     * @param setRequestHeader \r\n     */\r\n    static get(url: string, param: Object, callback: (err?: Error, data?: any) => void, setRequestHeader?: (v: XMLHttpRequest) => void): void {\r\n        this.http(url, \"get\", param, callback, setRequestHeader);\r\n    }\r\n\r\n    /**\r\n     * post \u8BF7\u6C42\r\n     * @param url \r\n     * @param param \r\n     * @param callback \r\n     * @param setRequestHeader\r\n     */\r\n    static post(url: string, param: Object, callback: (err?: Error, data?: any) => void, setRequestHeader?: (v: XMLHttpRequest) => void): void {\r\n        this.http(url, \"post\", param, callback, setRequestHeader);\r\n    }\r\n\r\n    private static http(url: string, method: string, param: object, callback: (err?: Error, data?: any) => void, setRequestHeader?: (v: XMLHttpRequest) => void): void {\r\n        if (param) {\r\n            let s = \"?\";\r\n            for (let key in param) {\r\n                let p = this.isValidKey(key, param);\r\n                url += `${s}${key}=${p}`;\r\n                s = '&';\r\n            }\r\n        }\r\n        Logger.log(`http send:${url}`, Logger.TYPE.NET);\r\n        let request = new XMLHttpRequest();\r\n        if (method == \"get\") {\r\n            request.open(\"get\", url, true);\r\n        } else {\r\n            request.open(\"post\", url);\r\n        }\r\n        //\u8BF7\u6C42\u5934\u4FE1\u606F\u8BBE\u7F6E\r\n        if (setRequestHeader != null) {\r\n            setRequestHeader(request);\r\n        } else {\r\n            this.setRequestHeader(request);\r\n        }\r\n        request.onreadystatechange = () => {\r\n            console.log(\"url : \" + request.responseURL);\r\n            if (request.readyState == 4) {\r\n                let status = request.status;\r\n                let txt = request.responseText;\r\n                if (status >= 200 && status < 300) {\r\n                    Logger.log(`url:(${url}) result:${txt})`, Logger.TYPE.NET);\r\n                    callback(undefined, txt);\r\n                } else {\r\n                    Logger.log(`url:(${url}) request error. status:(${request.status})`, Logger.TYPE.NET);\r\n                    callback(new Error(`Http:${method}\u5931\u8D25:${url}`));\r\n                }\r\n            }\r\n        };\r\n        request.send();\r\n    }\r\n\r\n    private static isValidKey(key: string | number | symbol, object: object): key is keyof typeof object {\r\n        return key in object;\r\n    }\r\n\r\n    /**\r\n     * \u8BBE\u7F6Ehttp\u5934\r\n     * @param request XMLHttpRequest\r\n     */\r\n    private static setRequestHeader(request: XMLHttpRequest): void {\r\n        request.setRequestHeader(\"Content-Type\", \"text/plain;charset=UTF-8;application/x-www-form-urlencoded;application/json;charset=UTF-8\");\r\n        request.setRequestHeader(\"Cache-Control\", \"no-store\");\r\n    }\r\n}", "import { IProtocol } from \"./IProtocol\";\r\nimport { ISocket } from \"./ISocket\";\r\nimport { ISocketManager } from \"./ISocketManager\";\r\nimport { Socket } from \"./Socket\";\r\n\r\n\r\n\r\n\r\nexport class SocketManagerImpl implements ISocketManager {\r\n\r\n    private __socketMap: Map<string, ISocket> = new Map<string, ISocket>();\r\n\r\n    constructor() {\r\n\r\n    }\r\n\r\n\r\n    initSocket(protocal: IProtocol, name?: string): ISocket {\r\n        if (this.__socketMap.has(name)) {\r\n            throw new Error(`socket ${name} is exist`);\r\n        }\r\n        if (protocal == null) {\r\n            throw new Error(\"protocal is null\");\r\n        }\r\n        let socket: ISocket = new Socket(protocal);\r\n        socket.name = name;\r\n        this.__socketMap.set(name, socket);\r\n        return socket;\r\n    }\r\n\r\n    /**\r\n     * socket\u662F\u5426\u5B58\u5728\r\n     * @param name \r\n     * @returns \r\n     */\r\n    hasSocket(name: string): boolean {\r\n        return this.__socketMap.has(name);\r\n    }\r\n\r\n    /**\r\n     * \u83B7\u53D6\u6307\u5B9A\u7C7B\u578B\u7684\u957F\u94FE\u63A5\r\n     * @param name \r\n     */\r\n    getSocket(name: string): ISocket {\r\n        if (!this.__socketMap.has(name)) {\r\n            throw new Error(`socket ${name} is not exist`);\r\n        }\r\n        return this.__socketMap.get(name);\r\n    }\r\n}", "import { Injector } from \"../../utils/Injector\";\r\nimport { IProtocol } from \"./IProtocol\";\r\nimport { ISocket } from \"./ISocket\";\r\nimport { ISocketManager } from \"./ISocketManager\";\r\nimport { SocketManagerImpl } from \"./SocketManagerImpl\";\r\n\r\n\r\nenum EventType {\r\n    SOCKET_CONNECTED = \"SOCKET_CONNECTED\",\r\n    SOCKET_ERROR = \"SOCKET_ERROR\",\r\n    SOCKET_CLOSE = \"SOCKET_CLOSE\",\r\n}\r\n\r\n/**\r\n * \u957F\u8FDE\u63A5\u7BA1\u7406\u5668\r\n */\r\nexport class SocketManager {\r\n\r\n    static KEY: string = \"SocketManager\";\r\n\r\n    /**\r\n     * sokcet\u4E8B\u4EF6\u7C7B\u578B\u679A\u4E3E\r\n     */\r\n    static EventType: typeof EventType = EventType;\r\n\r\n    private static __default_socket: string = \"GameSocket\";\r\n\r\n    /**\r\n     * \u8BBE\u7F6E\u9ED8\u8BA4socket\r\n     * @param type \r\n     */\r\n    static setDefaultSocket(type: string) {\r\n        this.__default_socket = type;\r\n    }\r\n\r\n    /**\r\n     * socket\u662F\u5426\u5B58\u5728\r\n     * @param name \r\n     * @returns \r\n     */\r\n    static hasSocket(name: string): boolean {\r\n        return this.impl.hasSocket(name);\r\n    }\r\n\r\n    /**\r\n     * \u521D\u59CB\u5316socket\r\n     * @param name \r\n     * @param protocal \r\n     * @returns \r\n     */\r\n    static initSocket(protocal: IProtocol, name?: string): ISocket {\r\n        if (name == undefined) {\r\n            name = this.__default_socket;\r\n        }\r\n        if (name == undefined) {\r\n            throw new Error(\"\u8BF7\u5148\u8BBE\u7F6E\u9ED8\u8BA4socket\u7C7B\u578B\");\r\n        }\r\n        return this.impl.initSocket(protocal,name);\r\n    }\r\n\r\n    /**\r\n     * \u83B7\u53D6\u6307\u5B9A\u7C7B\u578B\u7684\u957F\u94FE\u63A5\r\n     * @param name \r\n     * @returns \r\n     */\r\n    static getSocket(name?: string): ISocket {\r\n        if (name == undefined) {\r\n            name = this.__default_socket;\r\n        }\r\n        if (name == undefined) {\r\n            throw new Error(\"\u8BF7\u5148\u8BBE\u7F6E\u9ED8\u8BA4socket\u7C7B\u578B\");\r\n        }\r\n        return this.impl.getSocket(name);\r\n    }\r\n\r\n    private static __impl: ISocketManager;\r\n    private static get impl(): ISocketManager {\r\n        if (this.__impl == null) {\r\n            this.__impl = Injector.getInject(this.KEY);\r\n        }\r\n        if (this.__impl == null) {\r\n            this.__impl = new SocketManagerImpl();\r\n        }\r\n        return this.__impl;\r\n    }\r\n}", "import { EventDispatcher } from \"../../events/EventDispatcher\";\r\nimport { Logger } from \"../../loggers/Logger\";\r\nimport { IProtocol } from \"./IProtocol\";\r\nimport { ISocket } from \"./ISocket\";\r\nimport { SocketManager } from \"./SocketManager\";\r\n\r\n\r\nexport class Socket extends EventDispatcher implements ISocket {\r\n    /**\u540D\u79F0 */\r\n    name: string;\r\n    /**\r\n     * \u6700\u5927\u5141\u8BB8\u9519\u8BEF\u6B21\u6570\r\n     */\r\n    static MAX_ERROR_COUNT: number = 3;\r\n    /**\r\n     * \u5F53\u524D\u9519\u8BEF\u6B21\u6570\r\n     */\r\n    private error_count: number = 0;\r\n\r\n    private is_conected: boolean = false;\r\n\r\n    web_socket: WebSocket;\r\n    message_protocol: IProtocol;\r\n    /**\r\n     * \u7F13\u5B58\u7684\u672A\u5904\u7406\u6D88\u606F\r\n     */\r\n    private cache_msgs: Map<number | string, any>;\r\n    constructor(message_parser: IProtocol) {\r\n        super();\r\n        if (message_parser == null) throw new Error(\"message_parser is null\");\r\n        this.cache_msgs = new Map();\r\n        this.message_protocol = message_parser;\r\n        this.message_protocol.parse_callback = this.onMessageParseCallback.bind(this);\r\n    }\r\n\r\n    getCacheMsg(code: number | string): any {\r\n        if (!this.cache_msgs.has(code)) return null;\r\n        let msg = this.cache_msgs.get(code);\r\n        this.cache_msgs.delete(code);\r\n        return msg;\r\n    }\r\n\r\n    isConected(): boolean {\r\n        return this.is_conected;\r\n    }\r\n\r\n    /**\r\n     * \u94FE\u63A5\r\n     * @param url \r\n     * @param binaryType \r\n     */\r\n    connect(url: string, binaryType: BinaryType = \"arraybuffer\"): void {\r\n        this.web_socket = new WebSocket(url,);\r\n        this.web_socket.binaryType = binaryType;\r\n        this.web_socket.onclose = this.onclose.bind(this);\r\n        this.web_socket.onerror = this.onerror.bind(this);\r\n        this.web_socket.onopen = this.onopen.bind(this);\r\n        this.web_socket.onmessage = this.onmessage.bind(this);\r\n        this.error_count = 0;\r\n    }\r\n\r\n    /**\r\n     * \u91CD\u65B0\u94FE\u63A5\r\n     * @returns \r\n     */\r\n    reconnect(): void {\r\n        const readyState = this.web_socket.readyState;\r\n        if (readyState == WebSocket.CONNECTING || readyState == WebSocket.OPEN) return;\r\n        //\u5173\u95ED\u4E4B\u524D\u7684\u94FE\u63A5\u5BF9\u8C61\r\n        if (this.web_socket) {\r\n            this.web_socket.close();\r\n            this.web_socket.onclose = null;\r\n            this.web_socket.onerror = null;\r\n            this.web_socket.onopen = null;\r\n            this.web_socket.onmessage = null;\r\n        }\r\n        this.web_socket = new WebSocket(this.web_socket.url);\r\n        this.web_socket.onclose = this.onclose.bind(this);\r\n        this.web_socket.onerror = this.onerror.bind(this);\r\n        this.web_socket.onopen = this.onopen.bind(this);\r\n        this.web_socket.onmessage = this.onmessage.bind(this);\r\n    }\r\n\r\n    /**\r\n     * \u5173\u95ED\r\n     */\r\n    close(): void {\r\n        this.web_socket.close();\r\n        this.is_conected = false;\r\n    }\r\n\r\n    private onopen(e: Event): void {\r\n        this.is_conected = true;\r\n        this.emit(SocketManager.EventType.SOCKET_CONNECTED);\r\n    }\r\n\r\n    /**\r\n     * \u53D1\u9001\u534F\u8BAE\r\n     * @param code \r\n     * @param data \r\n     */\r\n    send(code: number | string, data: any): void {\r\n        Logger.log(\"[\" + this.name + \"]\" + \"[C2S]\" + code + \"  =>\" + JSON.stringify(data), Logger.TYPE.NET);\r\n        this.web_socket.send(this.message_protocol.encode(code, data));\r\n    }\r\n\r\n    private onmessage(e: MessageEvent): void {\r\n        this.message_protocol.decode(e.data as ArrayBuffer);\r\n    }\r\n\r\n    private onMessageParseCallback(code: number | string, data: any): void {\r\n        Logger.log(\"[\" + this.name + \"]\" + \"[S2C]\" + code + \"    <=\" + JSON.stringify(data), Logger.TYPE.NET);\r\n        //\u6709\u4EBA\u76D1\u542C\u4E86\u8BE5\u6D88\u606F\r\n        if (this.hasEvent(code)) {\r\n            this.emit(code, data);\r\n        } else {\r\n            //\u7F13\u5B58\u8BE5\u6D88\u606F\r\n            console.log(this.name + \" \u68C0\u6D4B\u5230\u672A\u5904\u7406\u6D88\u606F:\" + code + \",\u5185\u90E8\u5C06\u7F13\u5B58\u8BE5\u6D88\u606F\");\r\n            this.cache_msgs.set(code, data);\r\n        }\r\n    }\r\n\r\n    private onclose(e: CloseEvent): void {\r\n        this.emit(SocketManager.EventType.SOCKET_CLOSE);\r\n    }\r\n\r\n    private onerror(e: Event): void {\r\n        this.is_conected = false;\r\n        this.error_count++;\r\n        if (this.error_count < Socket.MAX_ERROR_COUNT) {\r\n            this.reconnect();\r\n        } else {\r\n            this.emit(SocketManager.EventType.SOCKET_ERROR, null, new Error(this.name + \" socket \u94FE\u63A5\u9519\u8BEF!\"));\r\n        }\r\n    }\r\n}", "import { Event } from \"../events/Event\";\r\nimport { EventDispatcher } from \"../events/EventDispatcher\";\r\nimport { ITask } from \"./ITask\";\r\n\r\n\r\n/**\r\n * \u4EFB\u52A1\r\n */\r\nexport class Task extends EventDispatcher implements ITask {\r\n\r\n    /**\r\n     * \u5F00\u59CB\r\n     * @param data \r\n     */\r\n    start(data?: any): void {\r\n\r\n    }\r\n\r\n    addEventHandler(handler: (e: Event) => void, caller: any): void {\r\n        this.on(Event.PROGRESS, handler, caller);\r\n        this.on(Event.COMPLETE, handler, caller);\r\n        this.on(Event.ERROR, handler, caller);\r\n    }\r\n\r\n    removeEventHandler(handler: (e: Event) => void, caller: any): void {\r\n        this.off(Event.PROGRESS, handler, caller);\r\n        this.off(Event.COMPLETE, handler, caller);\r\n        this.off(Event.ERROR, handler, caller);\r\n    }\r\n\r\n    /**\r\n     * \u9500\u6BC1\r\n     */\r\n    destroy(): boolean {\r\n        this.offAllEvent();\r\n        return super.destroy();\r\n    }\r\n}", "import { Event } from \"../events/Event\";\r\nimport { ITask } from \"./ITask\";\r\nimport { Task } from \"./Task\";\r\n\r\n\r\n/**\r\n * \u4EFB\u52A1\u961F\u5217\r\n */\r\nexport class TaskQueue extends Task {\r\n\r\n    private __taskList: Array<ITask>;\r\n    private __index: number = 0;\r\n    private __data: any;\r\n    constructor() {\r\n        super();\r\n        this.__taskList = [];\r\n    }\r\n\r\n    addTask(value: ITask | Array<ITask>): void {\r\n        if (Array.isArray(value)) {\r\n            for (let index = 0; index < value.length; index++) {\r\n                const element = value[index];\r\n                this.__addTask(element);\r\n            }\r\n        } else {\r\n            this.__addTask(value);\r\n        }\r\n    }\r\n\r\n    private __addTask(value: ITask): void {\r\n        if (this.__taskList.indexOf(value) >= 0) {\r\n            throw new Error(\"\u91CD\u590D\u6DFB\u52A0\uFF01\");\r\n        }\r\n        this.__taskList.push(value);\r\n    }\r\n\r\n    removeTask(value: ITask): void {\r\n        let index: number = this.__taskList.indexOf(value);\r\n        if (index < 0) {\r\n            throw new Error(\"\u672A\u627E\u5230\u8981\u5220\u9664\u7684\u5185\u5BB9\uFF01\");\r\n        }\r\n        this.__taskList.splice(index, 1);\r\n    }\r\n\r\n    start(data?: any): void {\r\n        this.__data = data;\r\n        this.__index = 0;\r\n        this.__tryNext();\r\n    }\r\n\r\n    private __tryNext(): void {\r\n        if (this.__index < this.__taskList.length) {\r\n            let task: ITask = this.__taskList[this.__index];\r\n            task.on(Event.COMPLETE, this.__subTaskEventHandler, this);\r\n            task.on(Event.PROGRESS, this.__subTaskEventHandler, this);\r\n            task.on(Event.ERROR, this.__subTaskEventHandler, this);\r\n            task.start(this.__data);\r\n        } else {\r\n            //\u7ED3\u675F\r\n            this.emit(Event.COMPLETE);\r\n        }\r\n    }\r\n\r\n    private __subTaskEventHandler(e: Event): void {\r\n        if (e.type == Event.PROGRESS) {\r\n            let progress: number = (this.__index + e.progress) / this.__taskList.length;\r\n            this.emit(Event.PROGRESS, progress);\r\n            return;\r\n        }\r\n        e.target.offAllEvent();\r\n        if (e.type == Event.ERROR) {\r\n            this.emit(Event.ERROR, e.error);\r\n            return;\r\n        }\r\n        e.target.destroy();\r\n        this.__index++;\r\n        this.__tryNext();\r\n    }\r\n\r\n    destroy(): boolean {\r\n        this.__taskList.length = 0;\r\n        this.__index = 0;\r\n        return super.destroy();\r\n    }\r\n}", "import { Event } from \"../events/Event\";\r\nimport { ITask } from \"./ITask\";\r\nimport { Task } from \"./Task\";\r\n\r\n\r\n/**\r\n * \u4EFB\u52A1\u5E8F\u5217\uFF08\u5E76\u884C\uFF09\r\n */\r\nexport class TaskSequence extends Task {\r\n\r\n    private __taskList: Array<ITask> = new Array<ITask>();\r\n    private __index: number = 0;\r\n    constructor() {\r\n        super();\r\n    }\r\n\r\n    addTask(value: ITask): void {\r\n        if (this.__taskList.indexOf(value) >= 0) {\r\n            throw new Error(\"\u91CD\u590D\u6DFB\u52A0\uFF01\");\r\n        }\r\n        this.__taskList.push(value);\r\n    }\r\n\r\n    removeTask(value: ITask): void {\r\n        let index: number = this.__taskList.indexOf(value);\r\n        if (index < 0) {\r\n            throw new Error(\"\u627E\u4E0D\u5230\u8981\u5220\u9664\u7684\u5185\u5BB9!\");\r\n        }\r\n        this.__taskList.splice(index, 1);\r\n    }\r\n\r\n    start(data?: any): void {\r\n        for (let index = 0; index < this.__taskList.length; index++) {\r\n            const element = this.__taskList[index];\r\n            element.on(Event.COMPLETE, this.__subTaskEventHandler, this);\r\n            element.on(Event.ERROR, this.__subTaskEventHandler, this);\r\n            element.on(Event.PROGRESS, this.__subTaskEventHandler, this);\r\n            element.start(data);\r\n        }\r\n    }\r\n\r\n    private __subTaskEventHandler(e: Event): void {\r\n        if (e.type == Event.PROGRESS) {\r\n            this.emit(Event.PROGRESS, this.__index / this.__taskList.length);\r\n            return;\r\n        }\r\n        e.target.offAllEvent();\r\n        if (e.type == Event.ERROR) {\r\n            this.emit(Event.ERROR, e.error);\r\n            return;\r\n        }\r\n        this.__index++;\r\n        if (this.__index < this.__taskList.length) {\r\n            return;\r\n        }\r\n        e.target.destroy();\r\n        //\u5B8C\u6210\r\n        this.emit(Event.COMPLETE);\r\n    }\r\n\r\n    destroy(): boolean {\r\n        this.__taskList.length = 0;\r\n        this.__index = 0;\r\n        return super.destroy();\r\n    }\r\n}", "\r\n\r\n/**\r\n * bit\u4F4D\u64CD\u4F5C\r\n */\r\nexport class BitFlag {\r\n\r\n    private __flags: number = 0;\r\n\r\n    private __elements: Array<number>;\r\n\r\n    constructor() {\r\n        this.__elements = [];\r\n    }\r\n\r\n    reset(): void {\r\n        this.__flags = 0;\r\n    }\r\n\r\n    add(flag: number): void {\r\n        this.__flags |= flag;\r\n        if (this.__elements.indexOf(flag) < 0) {\r\n            this.__elements.push(flag)\r\n        }\r\n    }\r\n\r\n    remove(flag: number): void {\r\n        this.__flags ^= flag;\r\n        let index: number = this.__elements.indexOf(flag);\r\n        if (index >= 0) {\r\n            this.__elements.splice(index, 1);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \u662F\u5426\u5305\u542B\r\n     * @param flag \r\n     * @returns \r\n     */\r\n    has(flag: number): boolean {\r\n        return (this.__flags & flag) == flag;\r\n    }\r\n\r\n    /**\r\n     * \u4F4D\u7801\r\n     */\r\n    get flags(): number {\r\n        return this.__flags;\r\n    }\r\n\r\n    get elements(): Array<number> {\r\n        return this.__elements;\r\n    }\r\n\r\n    destroy(): void {\r\n        this.__flags = 0;\r\n        this.__elements.length = 0;\r\n        this.__elements = null;\r\n    }\r\n\r\n\r\n    //======================================================\u9759\u6001\u5DE5\u5177\r\n    private static TYPES: Map<new () => any, number> = new Map<new () => any, number>();\r\n    private static BITS: Map<number, new () => any> = new Map<number, new () => any>();\r\n    private static TYPE_IDX: number = 0;\r\n\r\n    static getBit(value: new () => any): number {\r\n        if (this.TYPES.has(value)) {\r\n            return this.TYPES.get(value);\r\n        }\r\n        this.TYPE_IDX++;\r\n        let result = Math.pow(2, this.TYPE_IDX);\r\n        this.TYPES.set(value, result);\r\n        this.BITS.set(result, value);\r\n        return result;\r\n    }\r\n\r\n    static getType(bit: number): new () => any {\r\n        return this.BITS.get(bit);\r\n    }\r\n}", "import { IPoolable } from \"../pools/IPoolable\";\r\n\r\n/**\r\n * \u5904\u7406\u5668\r\n */\r\nexport class Handler implements IPoolable {\r\n\r\n    method?: Function;\r\n    caller: any;\r\n\r\n    constructor() {\r\n\r\n    }\r\n\r\n    reset(): void {\r\n        this.method = null;\r\n        this.caller = null;\r\n    }\r\n    \r\n    destroy(): boolean {\r\n        this.reset();\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * \u8FD0\u884C\r\n     * @param args \r\n     */\r\n    run(...args: any[]): any {\r\n        let result: any = null;\r\n        if (this.method) {\r\n            result = this.method.apply(this.caller, args);\r\n        } else {\r\n            throw new Error(\"Handler method is null!\");\r\n        }\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * \u5224\u65AD\u662F\u5426\u76F8\u540C\r\n     * @param value \r\n     * @returns \r\n     */\r\n    equal(value: Handler): boolean {\r\n        if (this.method == value.method && this.caller == value.caller) {\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * \u5224\u65AD\u662F\u5426\u76F8\u540C\r\n     * @param method \r\n     * @param caller \r\n     * @returns \r\n     */\r\n    equals(method: Function, caller?: any): boolean {\r\n        if (this.method == method && this.caller == caller) {\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n}", "\r\n\r\n/**\r\n * \u914D\u7F6E\u5B58\u50A8\u5668\r\n */\r\nexport class ConfigStorage {\r\n\r\n    key: string;\r\n    keys: Array<string>;\r\n    map: Map<string, any>;\r\n\r\n    constructor(keys: Array<string>) {\r\n        this.key = keys.join(\"_\");\r\n        this.keys = keys;\r\n        this.map = new Map<string, any>();\r\n    }\r\n\r\n    save(value: any, sheet: string): void {\r\n        if (this.keys.length == 1) {\r\n            let key = this.keys[0];\r\n            let saveKey = value[key];\r\n            if (this.map.has(saveKey)) {\r\n                throw new Error(`\u914D\u7F6E\u8868${sheet}\u552F\u4E00Key\u5B58\u5728\u91CD\u590D\u5185\u5BB9:${saveKey}`);\r\n            }\r\n            this.map.set(saveKey, value);\r\n        } else {\r\n            let values: Array<any> = [];\r\n            for (let index = 0; index < this.keys.length; index++) {\r\n                const key = this.keys[index];\r\n                values.push(value[key]);\r\n            }\r\n            const saveKey = values.join(\"_\");\r\n            if (!saveKey || saveKey.length == 0) {\r\n                return;\r\n            }\r\n            if (this.map.has(saveKey)) {\r\n                throw new Error(`\u914D\u7F6E\u8868${sheet}\u552F\u4E00Key\u5B58\u5728\u91CD\u590D\u5185\u5BB9:${saveKey}`);\r\n            }\r\n            this.map.set(saveKey, value);\r\n        }\r\n    }\r\n\r\n    get<T>(key: string): T | undefined {\r\n        if (this.map.has(key)) {\r\n            return this.map.get(key);\r\n        }\r\n        return undefined;\r\n    }\r\n\r\n    destroy(): void {\r\n        this.key = undefined;\r\n        this.keys = null;\r\n        this.map.clear();\r\n        this.map = null;\r\n    }\r\n}", "import { IConfigAccessor } from \"../IConfigAccessor\";\r\nimport { ConfigStorage } from \"./ConfigStorage\";\r\n\r\n/**\r\n * \u914D\u7F6E\u5B58\u53D6\u5668\u57FA\u7C7B\r\n */\r\nexport class BaseConfigAccessor implements IConfigAccessor {\r\n    /**\r\n     * \u8868\u540D\r\n     */\r\n    sheetName: string;\r\n\r\n    protected $configs: Array<any> = [];\r\n    protected $storages: Map<string, ConfigStorage>;\r\n\r\n    constructor() {\r\n        this.$storages = new Map<string, ConfigStorage>();\r\n    }\r\n\r\n    /**\r\n    * \u5B50\u7C7B\u6784\u9020\u51FD\u6570\u4E2D\u8C03\u7528\uFF0C\u589E\u52A0\u5B58\u50A8\u65B9\u5F0F\r\n    * @param keys \r\n    */\r\n    protected addStorage(keys: Array<string>): void {\r\n        const key = keys.join(\"_\");\r\n        if (this.$storages.has(key)) {\r\n            throw new Error(\"\u91CD\u590D\u6DFB\u52A0\u914D\u7F6E\u8868\u5B58\u50A8\u65B9\u5F0F\uFF1A\" + key);\r\n        }\r\n        this.$storages.set(key, new ConfigStorage(keys));\r\n    }\r\n\r\n    save(value: any): boolean {\r\n        const index = this.$configs.indexOf(value);\r\n        if (index >= 0) {\r\n            return false;\r\n        }\r\n        this.$configs.push(value);\r\n        for (let i of this.$storages.values()) {\r\n            i.save(value, this.sheetName);\r\n        }\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * \u901A\u8FC7\u5355key\u5355\u503C\u83B7\u53D6\u9879\u5185\u5BB9\r\n     * @param key \r\n     * @param value \r\n     * @returns \r\n     */\r\n    getOne<T>(key: string, value: any): T {\r\n        return this.get<T>([key], [value]);\r\n    }\r\n\r\n    /**\r\n      * \u83B7\u53D6\r\n      * @param keys \r\n      * @param values \r\n      * @returns \r\n      */\r\n    get<T>(keys?: Array<string>, values?: Array<any>): T | undefined {\r\n        if (!keys || !values || keys.length == 0 || values.length == 0) {\r\n            return undefined;\r\n        }\r\n        if (keys.length != values.length) {\r\n            throw new Error(\"\u53C2\u6570\u957F\u5EA6\u4E0D\u4E00\u81F4!\");\r\n        }\r\n        if (keys.length == 1) {\r\n            let key = keys[0];\r\n            let value = values[0];\r\n            if (this.$storages.has(key)) {\r\n                const storage = this.$storages.get(key)!;\r\n                return storage.get<T>(value);\r\n            }\r\n        } else {\r\n            let sKey: string = keys.join(\"_\");\r\n            if (this.$storages.has(sKey)) {\r\n                const s = this.$storages.get(sKey)!;\r\n                const vKey = values.join(\"_\");\r\n                return s.get<T>(vKey);\r\n            }\r\n        }\r\n        return undefined;\r\n    }\r\n\r\n    /**\r\n     * \u83B7\u53D6\u5B58\u50A8\u5668\r\n     * @param keys \r\n     * @returns \r\n     */\r\n    getStorage(keys: Array<string>): ConfigStorage | undefined {\r\n        return this.$storages.get(keys.join(\"_\"));\r\n    }\r\n\r\n    /**\r\n     * \u83B7\u53D6\r\n     * @param key\r\n     * @param value\r\n     * @returns \r\n     */\r\n    getElements<T>(): Array<T> {\r\n        return this.$configs;\r\n    }\r\n\r\n    destroy(): void {\r\n        this.$configs = null;\r\n        for (let i of this.$storages.values()) {\r\n            i.destroy();\r\n        }\r\n        this.$storages.clear();\r\n        this.$storages = null;\r\n    }\r\n}", "\r\n\r\n\r\n\r\nexport class StringUtils {\r\n\r\n    /**\r\n     * \u5224\u65AD\u5B57\u7B26\u4E32\u662F\u5426\u4E3A\u7A7A\r\n     * @param str \r\n     * @returns \r\n     */\r\n    static isEmpty(str: string): boolean {\r\n        return !str || str.length === 0;\r\n    }\r\n\r\n    /**\r\n     * \u5B57\u7B26\u8F6C\u4E8C\u7EF4\u6570\u7EC4\r\n     * @param str \r\n     * @returns \r\n     */\r\n    static str2NumArrList(str: string, separators: Array<string> = [\"|\", \",\"]): number[][] {\r\n        if (separators.length < 2) throw new Error(\"separators \u957F\u5EA6\u4E0D\u80FD\u5C0F\u4E8E2\");\r\n        if (!str) return []\r\n        let strArr: string[] = str.split(separators[0]);\r\n        let len: number = strArr.length;\r\n        let res: number[][] = [];\r\n        for (let i = 0; i < len; i++) {\r\n            let arr: number[] = strArr[i].split(separators[1]).map(item => Number(item));\r\n            res.push(arr);\r\n        }\r\n        return res;\r\n    }\r\n\r\n    /**\r\n     * \u5B57\u7B26\u4E32\u8F6C\u4E8C\u7EF4\u6570\u7EC4\r\n     * @param str \r\n     * @param separators \r\n     * @returns \r\n     */\r\n    static str2StringList(str: string, separators: Array<string> = [\"|\", \",\"]): string[][] {\r\n        let strArr: string[] = str.split(separators[0]);\r\n        let len: number = strArr.length;\r\n        let res: string[][] = [];\r\n        for (let i = 0; i < len; i++) {\r\n            let arr: string[] = strArr[i].split(separators[1]);\r\n            res.push(arr);\r\n        }\r\n        return res;\r\n    }\r\n\r\n    /**\r\n     * \u53C2\u6570\u66FF\u6362\r\n     *  @param  str\r\n     *  @param  rest\r\n     *  \r\n     *  @example\r\n     *\r\n     *  let str:string = \"\u4F60\u597D{},\u8FD9\u91CC\u662F:{}\";\r\n     *  console.log(StringUtil.substitute2(str, \"\u8748\u8748\",\"\u84DD\u661F\"));\r\n     *\r\n     *  // \u8F93\u51FA\u7ED3\u679C\u5982\u4E0B:\r\n     *  // \"\u4F60\u597D\u8748\u8748,\u8FD9\u91CC\u662F:\u84DD\u661F\"\r\n     */\r\n    static substitute(str: string, ...rest: any[]): string {\r\n        if (str == null) return '';\r\n\r\n        // Replace all of the parameters in the msg string.\r\n        let len: number = rest.length;\r\n        let args: any[];\r\n        if (len == 1 && rest[0] instanceof Array) {\r\n            args = rest[0];\r\n            len = args.length;\r\n        } else {\r\n            args = rest;\r\n        }\r\n        let idx = 0;\r\n        return str.replace(/{}/g, (_, index) => {\r\n            return args[idx++];\r\n        });\r\n    }\r\n\r\n    /**\r\n     * \u53C2\u6570\u66FF\u6362\r\n     *  @param  str\r\n     *  @param  rest\r\n     *  \r\n     *  @example\r\n     *\r\n     *  let str:string = \"here is some info '{0}' and {1}\";\r\n     *  console.log(StringUtil.substitute(str, 15.4, true));\r\n     *\r\n     *  // this will output the following string:\r\n     *  // \"here is some info '15.4' and true\"\r\n     */\r\n    static substitute2(str: string, ...rest: any[]): string {\r\n        if (str == null) return '';\r\n\r\n        // Replace all of the parameters in the msg string.\r\n        let len: number = rest.length;\r\n        let args: any[];\r\n        if (len == 1 && rest[0] instanceof Array) {\r\n            args = rest[0];\r\n            len = args.length;\r\n        } else {\r\n            args = rest;\r\n        }\r\n\r\n        for (let i: number = 0; i < len; i++) {\r\n            str = str.replace(new RegExp(\"\\\\{\" + i + \"\\\\}\", \"g\"), args[i]);\r\n        }\r\n\r\n        return str;\r\n    }\r\n}", "import { BaseConfigAccessor } from \"../configs/accessors/BaseConfigAccessor\";\r\nimport { ConfigManager } from \"../configs/ConfigManager\";\r\nimport { StringUtils } from \"./StringUtils\";\r\n\r\n\r\n\r\nexport class I18N {\r\n    /**\r\n     * \u591A\u8BED\u8A00\u8868\u540D\r\n     */\r\n    static fileName: string = \"t_s_language\";\r\n    /**\r\n     * \u5F53\u524D\u8BED\u8A00\r\n     */\r\n    static langenge: string = \"zh_CN\";\r\n    /**\r\n     * \u591A\u8BED\u8A00\u9879\u6570\u636E\r\n     */\r\n    static sheetItem: { key: string, value: string } = { key: \"id\", value: \"value\" };\r\n\r\n    constructor() {\r\n\r\n    }\r\n\r\n    /**\r\n     * \u8F6C\u6362\r\n     * @param value \r\n     * @param rest \r\n     * @returns \r\n     */\r\n    static tr(value: string, ...rest: any[]): string {\r\n        let langeValue: string;\r\n        let acc = ConfigManager.getAccessor(this.sheetName) as L18Acc;\r\n        if (!acc) {\r\n            //\u5982\u679C\u4E0D\u5B58\u5728\u5F53\u524D\u8BED\u8A00\uFF0C\u5219\u4F7F\u7528\u9ED8\u8BA4\u8BED\u8A00\r\n            acc = ConfigManager.getAccessor(this.defaultSheetName) as L18Acc;\r\n        }\r\n        if (acc) {\r\n            let sheetItem: any = acc.getOne(this.sheetItem.key, value);\r\n            if (sheetItem == null || rest == undefined) {\r\n                langeValue = value;\r\n            } else {\r\n                langeValue = sheetItem[this.sheetItem.value]\r\n            }\r\n        } else {\r\n            langeValue = value;\r\n        }\r\n        if (rest == null || rest == undefined || rest.length == 0) {\r\n            return langeValue;\r\n        }\r\n        return StringUtils.substitute(langeValue, rest);\r\n    }\r\n\r\n    /**\r\n     * \u591A\u8BED\u8A00\u8D44\u6E90\u8DEF\u5F84\r\n     * @param url \r\n     */\r\n    static tr_res(url: string): string {\r\n        return this.langenge + \"/\" + url;\r\n    }\r\n\r\n    static get sheetName(): string {\r\n        return this.fileName + \"/\" + this.langenge;\r\n    }\r\n\r\n    static get defaultSheetName(): string {\r\n        return this.fileName + \"/zh_CN\";\r\n    }\r\n}\r\n\r\n\r\nexport class L18Acc extends BaseConfigAccessor {\r\n\r\n    constructor() {\r\n        super();\r\n        this.addStorage([I18N.sheetItem.key]);\r\n    }\r\n}", "\r\n\r\nexport class MathUtils {\r\n\r\n    static readonly ZeroTolerance: number = 1e-3;\r\n    static readonly Angle90: number = Math.PI * 0.5;\r\n    static readonly Rad2Angle: number = 180 / Math.PI;\r\n    static readonly Angle2Rad: number = Math.PI / 180;\r\n\r\n    /**\r\n     * \u68C0\u6D4B\u662F\u5426\u76F8\u7B49\r\n     * @param a\r\n     * @param b\r\n     * @returns true \u76F8\u7B49 false\u4E0D\u76F8\u7B49\r\n     */\r\n    static equals(a: number, b: number): boolean {\r\n        return Math.abs(a - b) <= MathUtils.ZeroTolerance;\r\n    }\r\n\r\n    /**\r\n     * \u5F3A\u5236\u53D6\u6574\uFF0C\u53BB\u6389\u5C0F\u6570\u70B9\u540E\u7684\u6570\u5B57\r\n     * @param v \r\n     * @returns \r\n     */\r\n    static int(v: number): number {\r\n        return parseInt(v.toString(), 10);\r\n    }\r\n\r\n    /**\r\n     * \u6C422\u6761\u7EBF\u6BB5\u4E4B\u95F4\u7684\u4EA4\u70B9\r\n     * @param a \r\n     * @param b \r\n     * @param c \r\n     * @param d \r\n     * @param result \r\n     * @returns \r\n     */\r\n    static getIntersectionPoint(a: { x: number, y: number }, b: { x: number, y: number }, c: { x: number, y: number }, d: { x: number, y: number }, result?: { x: number, y: number }): { x: number, y: number } | null {\r\n        result = result || { x: 0, y: 0 };\r\n        // \u4E09\u89D2\u5F62abc \u9762\u79EF\u76842\u500D  \r\n        var area_abc = (a.x - c.x) * (b.y - c.y) - (a.y - c.y) * (b.x - c.x);\r\n\r\n        // \u4E09\u89D2\u5F62abd \u9762\u79EF\u76842\u500D  \r\n        var area_abd = (a.x - d.x) * (b.y - d.y) - (a.y - d.y) * (b.x - d.x);\r\n\r\n        // \u9762\u79EF\u7B26\u53F7\u76F8\u540C\u5219\u4E24\u70B9\u5728\u7EBF\u6BB5\u540C\u4FA7,\u4E0D\u76F8\u4EA4 (\u5BF9\u70B9\u5728\u7EBF\u6BB5\u4E0A\u7684\u60C5\u51B5,\u672C\u4F8B\u5F53\u4F5C\u4E0D\u76F8\u4EA4\u5904\u7406);  \r\n        if (area_abc * area_abd >= 0) {\r\n            return null;\r\n        }\r\n\r\n        // \u4E09\u89D2\u5F62cda \u9762\u79EF\u76842\u500D  \r\n        var area_cda = (c.x - a.x) * (d.y - a.y) - (c.y - a.y) * (d.x - a.x);\r\n        // \u4E09\u89D2\u5F62cdb \u9762\u79EF\u76842\u500D  \r\n        // \u6CE8\u610F: \u8FD9\u91CC\u6709\u4E00\u4E2A\u5C0F\u4F18\u5316.\u4E0D\u9700\u8981\u518D\u7528\u516C\u5F0F\u8BA1\u7B97\u9762\u79EF,\u800C\u662F\u901A\u8FC7\u5DF2\u77E5\u7684\u4E09\u4E2A\u9762\u79EF\u52A0\u51CF\u5F97\u51FA.  \r\n        var area_cdb = area_cda + area_abc - area_abd;\r\n        if (area_cda * area_cdb >= 0) {\r\n            return null;\r\n        }\r\n\r\n        //\u8BA1\u7B97\u4EA4\u70B9\u5750\u6807  \r\n        var t = area_cda / (area_abd - area_abc);\r\n        var dx = t * (b.x - a.x),\r\n            dy = t * (b.y - a.y);\r\n        result.x = a.x + dx;\r\n        result.y = a.y + dy;\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * \u70B9\u5230\u7EBF\u6BB5\u7684\u5782\u70B9\r\n     * @param px \r\n     * @param py \r\n     * @param sx \r\n     * @param sy \r\n     * @param ex \r\n     * @param ey \r\n     */\r\n    static getPerpendicularPoint(px: number, py: number, sx: number, sy: number, ex: number, ey: number, result?: { x: number, y: number }): { x: number, y: number } {\r\n        result = result || { x: 0, y: 0 };\r\n        let dx = ex - sx;\r\n        let dy = ey - sy;\r\n\r\n        let k = (ex - sx) * (px - sx) + (ey - sy) * (py - sy);\r\n        k /= dx * dx + dy * dy;\r\n        if (k >= 0 && k <= 1) {\r\n            result.x = sx + k * dx;\r\n            result.y = sy + k * dy;\r\n            return result;\r\n        }\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * \u70B9\u5230\u7EBF\u6BB5\u7684\u8DDD\u79BB \r\n     * @param P3\r\n     * @param PA\r\n     * @param PB\r\n     * @return \r\n     */\r\n    static getNearestDistance(target: { x: number, y: number }, pa: { x: number, y: number }, pb: { x: number, y: number }): number {\r\n        let targetPoint = { x: 0, y: 0 };\r\n        let aPoint = { x: 0, y: 0 };\r\n        let bPoint = { x: 0, y: 0 };\r\n\r\n        targetPoint.x = target.x;\r\n        targetPoint.y = target.y;\r\n        aPoint.x = pa.x;\r\n        aPoint.y = pa.y;\r\n        bPoint.x = pb.x;\r\n        bPoint.y = pb.y;\r\n\r\n        var a: number, b: number, c: number;\r\n        a = this.distance(bPoint.x, bPoint.y, targetPoint.x, targetPoint.y);\r\n        if (a <= 0.00001)\r\n            return 0;\r\n        b = this.distance(aPoint.x, aPoint.y, targetPoint.x, targetPoint.y);\r\n        if (b <= 0.00001)\r\n            return 0;\r\n        c = this.distance(aPoint.x, aPoint.y, bPoint.x, bPoint.y);\r\n        if (c <= 0.00001)\r\n            return a;//\u5982\u679CPA\u548CPB\u5750\u6807\u76F8\u540C\uFF0C\u5219\u9000\u51FA\u51FD\u6570\uFF0C\u5E76\u8FD4\u56DE\u8DDD\u79BB   \r\n        //------------------------------   \r\n\r\n\r\n        if (a * a >= b * b + c * c)//--------\u56FE3--------   \r\n            return b;\r\n        if (b * b >= a * a + c * c)//--------\u56FE4-------   \r\n            return a;\r\n\r\n        //\u56FE1   \r\n        var l: number = (a + b + c) / 2;     //\u5468\u957F\u7684\u4E00\u534A   \r\n        var s: number = Math.sqrt(l * (l - a) * (l - b) * (l - c));  //\u6D77\u4F26\u516C\u5F0F\u6C42\u9762\u79EF\r\n        return 2 * s / c;\r\n    }\r\n\r\n    /**\r\n     * \u5411\u91CF\u70B9\u4E58\r\n     * @param ax \r\n     * @param ay \r\n     * @param bx \r\n     * @param by \r\n     * @returns   0 \u4E92\u76F8\u5782\u76F4 >0 \u5411\u91CF\u5939\u89D2\u5C0F\u4E8E90\u5EA6 <0\u5411\u91CF\u5939\u89D2\u5927\u4E8E90\u5EA6\r\n     */\r\n    static vectorDot(ax: number, ay: number, bx: number, by: number): number {\r\n        return ax * bx + ay * by;\r\n    }\r\n\r\n    /**\r\n     * \u5411\u91CF\u53C9\u4E58\r\n     * @param a \r\n     * @param b \r\n     * @param out \r\n     */\r\n    static vectorCross(ax: number, ay: number, bx: number, by: number): number {\r\n        return ax * by - ay * bx;\r\n    }\r\n\r\n    /**\r\n     * \u6C42\u4E24\u4E2A\u5411\u91CF\u4E4B\u95F4\u7684\u5939\u89D2\r\n     * @param av        \u5355\u4F4D\u5411\u91CF\r\n     * @param bv        \u5355\u4F4D\u5411\u91CF\r\n     */\r\n    static calculateAngle(ax: number, ay: number, bx: number, by: number): number {\r\n        //cos=a.b/(|a||b|);\r\n        return Math.acos(this.vectorDot(ax, ay, bx, by) / (Math.sqrt(ax * ax + ay * ay) * Math.sqrt(bx * bx + by * by)));\r\n    }\r\n\r\n    /**\r\n    * \u6C42\u4E24\u70B9\u4E4B\u95F4\u8DDD\u79BB\r\n    * @param ax \r\n    * @param ay \r\n    * @param bx \r\n    * @param by \r\n    * @returns \r\n    */\r\n    static distance(ax: number, ay: number, bx: number, by: number): number {\r\n        const x: number = bx - ax;\r\n        const y: number = by - ay;\r\n        return Math.sqrt(x * x + y * y)\r\n    }\r\n\r\n    /**\r\n     * \u6C42\u8DDD\u79BB\u7684\u4E8C\u6B21\u65B9\r\n     * @param ax \r\n     * @param ay \r\n     * @param bx \r\n     * @param by \r\n     * @returns \r\n     */\r\n    static distanceSquared(ax: number, ay: number, bx: number, by: number): number {\r\n        const x: number = bx - ax;\r\n        const y: number = by - ay;\r\n        return x * x + y * y;\r\n    }\r\n\r\n    /**\r\n     * \u662F\u5426\u5305\u542B\u5728\u5706\u5185\r\n     * @param x \r\n     * @param y \r\n     * @param ox \r\n     * @param oy \r\n     * @param r \r\n     * @returns \r\n     */\r\n    static inTheCircle(x: number, y: number, ox: number, oy: number, r: number): boolean {\r\n        let dis = this.distance(x, y, ox, oy);\r\n        if (dis < r) {\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n}", "\r\n\r\n\r\n/**\r\n * \u5BF9\u8C61\u5DE5\u5177\u7C7B\r\n */\r\nexport class ObjectUtils {\r\n\r\n    /**\r\n     * \u5C06source\u5BF9\u8C61\u5C5E\u6027\u62F7\u8D1D\u5230target\u5BF9\u8C61\r\n     * @param source \r\n     * @param target \r\n     */\r\n    static oto(source: any, target: any): void {\r\n        for (let key in source) {\r\n            target[key] = source[key];\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \u6DF1\u5EA6\u514B\u9686\r\n     * @param source \r\n     * @returns \r\n     */\r\n    static deepClone<T>(source: any): T {\r\n        if (!source || typeof source != \"object\")\r\n            return null;\r\n        var obj_str = JSON.stringify(source);\r\n        let result = JSON.parse(obj_str);\r\n        return result as T;\r\n    }\r\n\r\n    /**\r\n     * \u6E05\u7406\u5BF9\u8C61\r\n     * @param obj \r\n     */\r\n    static clear(obj: any): void {\r\n        for (let key in obj) {\r\n            delete obj[key];\r\n        }\r\n    }\r\n}", "\r\n\r\n\r\n\r\nimport { assetManager, JsonAsset } from \"cc\";\r\nimport { Event } from \"../../events/Event\";\r\nimport { EventDispatcher } from \"../../events/EventDispatcher\";\r\nimport { Res } from \"../../res/Res\";\r\nimport { ResURL } from \"../../res/ResURL\";\r\nimport { ConfigManager } from \"../ConfigManager\";\r\nimport { IConfigAccessor } from \"../IConfigAccessor\";\r\nimport { ILoader } from \"../../res/loaders/ILoader\";\r\nimport { Resource } from \"../../res/resources/Resource\";\r\nimport { ResourceManager } from \"../../res/resources/ResourceManager\";\r\n\r\n/**\r\n * \u8FDC\u7A0B\u914D\u7F6E\u52A0\u8F7D\u5668\r\n */\r\nexport class RemoteConfigLoader extends EventDispatcher implements ILoader {\r\n\r\n    /**\r\n     * \u5F3A\u5236\u52A0\u8F7D\u6700\u65B0\u7248\u672C\r\n     */\r\n    static force: boolean = true;\r\n\r\n    url?: ResURL;\r\n\r\n    constructor() {\r\n        super();\r\n    }\r\n\r\n    load(url: ResURL): void {\r\n        this.url = url;\r\n        if (typeof url == \"string\") {\r\n            throw new Error(\"\u672A\u5B9E\u73B0\uFF01\");\r\n        }\r\n        let self = this;\r\n        let remote_url = url.url;\r\n        if (RemoteConfigLoader.force) {\r\n            remote_url += \"?v=\" + Date.now();\r\n        }\r\n        assetManager.loadRemote(remote_url, (err: Error, asset: JsonAsset) => {\r\n            if (err) {\r\n                self.emit(Event.ERROR, url, err);\r\n                return;\r\n            }\r\n            const urlKey = Res.url2Key(url);\r\n            let res: Resource = new Resource();\r\n            res.key = urlKey;\r\n            res.content = asset;\r\n            let accessor = this.__parseConfig(url, asset);\r\n            res.content = accessor;\r\n            ResourceManager.addRes(res);\r\n            self.emit(Event.COMPLETE, url);\r\n        });\r\n    }\r\n\r\n    private __parseConfig(url: ResURL, data: JsonAsset): IConfigAccessor {\r\n        let list = data.json as Array<any>;\r\n        //\u5B58\u53D6\u5668\r\n        if (Res.url2Sheet == undefined) {\r\n            throw new Error(\"Res.url2Sheet\u672A\u5B9A\u4E49!\u8BF7\u5728\u521D\u59CB\u5316\u524D\u8BBE\u7F6E!\");\r\n        }\r\n        const sheet_name = Res.url2Sheet(url);\r\n        let accessorClass: new () => IConfigAccessor = ConfigManager.getAccessorClass(sheet_name);\r\n        let accessor: IConfigAccessor = new accessorClass();\r\n        accessor.sheetName = sheet_name;\r\n        for (let idx = 0; idx < list.length; idx++) {\r\n            const data = list[idx];\r\n            accessor.save(data);\r\n        }\r\n        return accessor;\r\n    }\r\n\r\n    reset(): void {\r\n        this.url = undefined;\r\n        this.offAllEvent();\r\n    }\r\n}", "import { ConfigManager } from \"./configs/ConfigManager\";\r\nimport { RemoteConfigLoader } from \"./configs/res/RemoteConfigLoader\";\r\nimport { Event } from \"./events/Event\";\r\nimport { IEnginePlugin } from \"./interfaces/IEnginePlugin\";\r\nimport { Res } from \"./res/Res\";\r\nimport { TickerManager } from \"./ticker/TickerManager\";\r\nimport { I18N, L18Acc } from \"./utils/I18N\";\r\n\r\n\r\n\r\n\r\n/**\r\n * \u5F15\u64CE\u5165\u53E3\r\n */\r\nexport class Engine {\r\n\r\n    private static plugins = new Map<new () => IEnginePlugin, IEnginePlugin>();\r\n    private static inited: boolean = false;\r\n\r\n    /**\r\n     * \u542F\u52A8\u5F15\u64CE\r\n     * @param datas \r\n     * @param progress \r\n     * @param cb \r\n     */\r\n    static setup(datas: Array<{ plugin: new () => IEnginePlugin, data: any[] }>, progress: (v: number) => void, cb: (err: Error | null) => void): void {\r\n        //\u914D\u7F6E\u8868\u52A0\u8F7D\u5668\r\n        Res.setLoader(Res.TYPE.CONFIG, RemoteConfigLoader);\r\n\r\n        /**\u9ED8\u8BA4\u8BED\u8A00\u914D\u7F6E\u8868\u5B58\u53D6\u5668 */\r\n        if (I18N.langenge != \"zh_CN\") {\r\n            ConfigManager.register(I18N.defaultSheetName, L18Acc);\r\n        }\r\n        ConfigManager.register(I18N.sheetName, L18Acc);\r\n\r\n        let setup_idx: number = 0;\r\n        let total_count = datas.length;\r\n        for (let idx = 0; idx < datas.length; idx++) {\r\n            const pluginData = datas[idx];\r\n            if (this.plugins.has(pluginData.plugin)) {\r\n                continue;\r\n            }\r\n            const plugin = new pluginData.plugin();\r\n            plugin.on(Event.PROGRESS, (e) => {\r\n                progress && progress((setup_idx + e.progress) / total_count);\r\n            }, this);\r\n            plugin.on(Event.ERROR, (e) => {\r\n                cb && cb(e.error!);\r\n                //\u5220\u9664\u6240\u6709\u4E8B\u4EF6\u76D1\u542C\r\n                plugin.offAllEvent();\r\n            }, this);\r\n            plugin.on(Event.COMPLETE, (e) => {\r\n                let target = e.target as IEnginePlugin;\r\n                target.offAllEvent();\r\n                setup_idx++;\r\n                if (setup_idx >= total_count) {\r\n                    cb && cb(null);\r\n                    this.inited = true;\r\n                }\r\n            }, this);\r\n            //\u542F\u52A8\u6A21\u5757\r\n            plugin.setup(...pluginData.data);\r\n            this.plugins.set(pluginData.plugin, plugin);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \u901A\u8FC7\u7C7B\u578B\u83B7\u53D6\u6A21\u5757\r\n     * @param type \r\n     * @returns \r\n     */\r\n    static getModule(type: new () => IEnginePlugin): IEnginePlugin | undefined {\r\n        return this.plugins.get(type);\r\n    }\r\n\r\n    /**\r\n     * \u5FC3\u8DF3\u9A71\u52A8\r\n     * @param dt \r\n     * @returns \r\n     */\r\n    static tick(dt: number): void {\r\n        if (!this.inited) {\r\n            return;\r\n        }\r\n        TickerManager.tick(dt);\r\n    }\r\n}"],
  "mappings": "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",
  "names": ["Injector", "customKey", "clazz", "instance", "director", "find", "Node", "AudioSource", "assetManager", "SpriteFrame", "Texture2D", "assetManager", "TickerManagerImpl", "dt", "handler", "index", "value", "caller", "NextFrameHandler", "callBack", "TickerManager", "dt", "value", "caller", "Injector", "TickerManagerImpl", "PoolImpl", "classType", "max", "min", "i", "element", "item", "Pool", "clazz", "pool", "PoolImpl", "item", "_Event", "type", "taraget", "data", "err", "progress", "Pool", "target", "result", "Event", "EventListener", "type", "caller", "handler", "priority", "target", "_EventDispatcher", "target", "type", "handler", "caller", "priority", "listeners", "element", "listener", "EventListener", "a", "b", "callerListeners", "index", "list", "data", "err", "progress", "event", "Event", "TickerManager", "infoList", "info", "EventDispatcher", "Dictionary", "EventDispatcher", "key", "value", "old", "index", "Event", "result", "iterator", "game", "TimerImpl", "TickerManager", "time", "game", "dt", "Timer", "d", "time", "Injector", "TimerImpl", "ResourceManagerImpl", "Dictionary", "TickerManager", "dt", "ResourceManager", "currentTime", "Timer", "value", "key", "refKey", "res", "index", "ignoreTime", "ResourceManager", "value", "key", "refKey", "ignoreTime", "Injector", "ResourceManagerImpl", "Asset", "assetManager", "instantiate", "isValid", "Prefab", "LoggerImpl", "Dictionary", "Logger", "key", "isOpen", "isSave", "type", "logType", "msg", "data", "list", "isAll", "LogType", "Logger", "type", "isOpen", "isSave", "msg", "Injector", "LoggerImpl", "ResRef", "Resource", "refKey", "ref", "Pool", "ResRef", "Asset", "Prefab", "instantiate", "value", "index", "node", "isValid", "Logger", "assetManager", "CCLoader", "EventDispatcher", "url", "assetManager", "err", "asset", "Event", "urlKey", "Res", "res", "Resource", "ResourceManager", "bundle", "urlStr", "finished", "total", "progress", "LoaderQueue", "_LoaderQueue", "Dictionary", "TickerManager", "dt", "Res", "url", "urlKey", "loader", "loaderClass", "type", "list", "Logger", "target", "Event", "evt", "LoaderManager", "LoaderManagerImpl", "request", "index", "url", "urlKey", "Res", "ResourceManager", "LoaderQueue", "list", "err", "rlist", "progress", "findex", "i", "LoaderManager", "reqeust", "request", "url", "err", "progress", "Injector", "LoaderManagerImpl", "ResRequest", "_ResRequest", "url", "refKey", "progress", "cb", "LoaderManager", "resURL", "urlKey", "Res", "err", "index", "ref", "ResourceManager", "loaded", "value", "Pool", "result", "urls", "ClassUtils", "str", "n", "arr", "i", "m", "code", "words", "value", "className", "ResImpl", "url", "ul", "SpriteFrame", "Texture2D", "key", "arr", "a", "b", "clazz", "className", "ClassUtils", "len", "end", "t", "loader", "CCLoader", "refKey", "progress", "cb", "reqeust", "Pool", "ResRequest", "names", "list", "abs", "index", "bundle_name", "assetManager", "loaded", "total", "resolve", "reject", "err", "bundle", "ResType", "Res", "key", "url", "a", "b", "loader", "refKey", "progress", "cb", "names", "Injector", "ResImpl", "AudioChannelImpl", "node", "source", "AudioSource", "value", "url", "playedComplete", "volume", "fade", "loop", "speed", "FadeData", "Timer", "Res", "err", "Logger", "time", "endVolume", "startVolume", "complete", "completeStop", "currentTime", "dt", "passTime", "pTime", "AudioManagerImpl", "TickerManager", "find", "Node", "director", "channel", "index", "AudioChannelImpl", "value", "channelVolume", "current", "element", "url", "volume", "speed", "playVolume", "Res", "last", "playedCallBack", "loop", "AudioManager", "dt", "AudioManager", "value", "url", "volume", "speed", "playedCallBack", "loop", "Injector", "AudioManagerImpl", "FunctionHookInfo", "functionName", "preHandler", "laterHandler", "FunctionHook", "data", "group", "groupList", "index", "info", "self", "oldFun", "pres", "laters", "newFun", "arg", "element", "list", "fIndex", "BindInfo", "property", "targetOrCallBack", "tPropertyOrCaller", "PropertyBinder", "data", "group", "info", "groupList", "exist", "bindInfos", "pIndex", "propertyKey", "index", "fIndex", "gIndex", "value", "key", "self", "newValue", "pKey", "isInit", "TickerManager", "propsIndex", "Binder", "source", "property", "targetOrCallBack", "tPropertyKeyOrCaller", "index", "element", "BinderUtils", "functionName", "preHandle", "laterHandler", "target", "targetProperty", "callBack", "caller", "propertys", "type", "handler", "on", "off", "eventInfo", "hasEventHandler", "group", "tPropertyOrCaller", "binder", "PropertyBinder", "preHandler", "hook", "FunctionHook", "List", "EventDispatcher", "only", "value", "Event", "result", "index", "predicate", "DEBUG", "RedPointNode", "EventDispatcher", "id", "node", "index", "value", "Event", "TickerManager", "active", "_RedPoint", "TickerManager", "dt", "index", "id", "isActive", "node", "detector", "configs", "config", "parent", "DEBUG", "parents", "data", "RedPointNode", "child", "childNode", "childData", "children", "childID", "RedPoint", "DEBUG", "FuncNode", "EventDispatcher", "id", "node", "index", "server", "Func", "parent", "child", "value", "Event", "Func", "_Func", "EventDispatcher", "value", "configs", "index", "config", "node", "parent", "DEBUG", "parents", "server", "element", "Event", "childNode", "id", "result", "FuncNode", "Component", "ConfigManagerImpl", "sheet", "accessor", "Res", "url", "urlKey", "ResourceManager", "ConfigManager", "sheet", "accessors", "Injector", "ConfigManagerImpl", "Node", "assetManager", "ModuleProxy", "module", "ModuleLoader", "EventDispatcher", "module_name", "module", "ModuleManager", "Module", "Logger", "bundle", "assetManager", "err", "Event", "error", "urls", "index", "sheet_name", "url", "Res", "element", "progress", "proxy", "ModuleProxy", "ModuleQueue", "_ModuleQueue", "Dictionary", "TickerManager", "module_name", "isSub", "idx", "dt", "ModuleManager", "module", "loader", "Pool", "ModuleLoader", "target", "Event", "evt", "ModuleRequest", "modules", "progress", "callback", "isSub", "isLoading", "index", "module_name", "ModuleManager", "ModuleQueue", "err", "totalProgress", "loaded", "value", "_ModuleManager", "Node", "TickerManager", "dt", "Timer", "module_name", "proxy", "Logger", "modules", "progress", "callback", "isSub", "request", "ModuleRequest", "list", "index", "err", "clist", "module", "findex", "ModuleManager", "Module", "Component", "EventDispatcher", "ModuleManager", "err", "index", "clazz", "module", "Event", "total", "e", "config", "ConfigManager", "module_name", "id", "detector", "RedPoint", "element", "key", "_", "handler", "caller", "priority", "data", "Http", "url", "param", "callback", "setRequestHeader", "method", "s", "key", "p", "Logger", "request", "status", "txt", "object", "SocketManagerImpl", "protocal", "name", "socket", "Socket", "EventType", "SocketManager", "type", "name", "protocal", "Injector", "SocketManagerImpl", "_Socket", "EventDispatcher", "message_parser", "code", "msg", "url", "binaryType", "readyState", "e", "SocketManager", "data", "Logger", "Socket", "Task", "EventDispatcher", "data", "handler", "caller", "Event", "TaskQueue", "Task", "value", "index", "element", "data", "task", "Event", "e", "progress", "TaskSequence", "Task", "value", "index", "data", "element", "Event", "e", "BitFlag", "flag", "index", "value", "result", "bit", "Handler", "args", "result", "value", "method", "caller", "ConfigStorage", "keys", "value", "sheet", "key", "saveKey", "values", "index", "BaseConfigAccessor", "keys", "key", "ConfigStorage", "value", "values", "sKey", "s", "vKey", "i", "StringUtils", "str", "separators", "strArr", "len", "res", "i", "arr", "item", "rest", "args", "idx", "_", "index", "I18N", "value", "rest", "langeValue", "acc", "ConfigManager", "sheetItem", "StringUtils", "url", "L18Acc", "BaseConfigAccessor", "_MathUtils", "a", "b", "v", "c", "d", "result", "area_abc", "area_abd", "area_cda", "area_cdb", "t", "dx", "dy", "px", "py", "sx", "sy", "ex", "ey", "k", "target", "pa", "pb", "targetPoint", "aPoint", "bPoint", "l", "s", "ax", "ay", "bx", "by", "x", "y", "ox", "oy", "r", "MathUtils", "ObjectUtils", "source", "target", "key", "obj_str", "obj", "assetManager", "_RemoteConfigLoader", "EventDispatcher", "url", "self", "remote_url", "assetManager", "err", "asset", "Event", "urlKey", "Res", "res", "Resource", "accessor", "ResourceManager", "data", "list", "sheet_name", "accessorClass", "ConfigManager", "idx", "RemoteConfigLoader", "Engine", "datas", "progress", "cb", "Res", "RemoteConfigLoader", "I18N", "ConfigManager", "L18Acc", "setup_idx", "total_count", "idx", "pluginData", "plugin", "Event", "e", "type", "dt", "TickerManager"]
}
