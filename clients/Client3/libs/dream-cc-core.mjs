var d=class{constructor(e,t=1e3,r=0){this.__max=0;this.__class=e,this.__max=t,this.__using=new Set,this.__free=new Set;for(let i=0;i<r;i++)this.__free.add(new this.__class)}destroy(){this.releaseAll();for(let e of this.__free)e.destroy();return this.__free.clear(),this.__using.clear(),!0}acquire(){let e;if(this.__free.size>0)e=this.__free.values().next().value,this.__free.delete(e);else{if(this.size>=this.__max)throw new Error("\u5BF9\u8C61\u6C60\u5DF2\u6EE1");e=new this.__class}return this.__using.add(e),e}release(e){e.reset(),this.__using.delete(e),this.__free.add(e)}releaseAll(){this.__using.size!==0&&(this.__using.forEach(e=>{this.release(e)}),this.__using.clear())}get usingCount(){return this.__using.size}get freeCount(){return this.__free.size}get size(){return this.freeCount+this.usingCount}};var h=class{static acquire(e){let t=this.pools.get(e);return t?t.acquire():(this.pools.set(e,new d(e,1e3,0)),this.acquire(e))}static release(e,t){let r=this.pools.get(e);if(r)r.release(t);else throw new Error("\u5BF9\u8C61\u6C60\u4E0D\u5B58\u5728")}static releaseAll(e){let t=this.pools.get(e);if(t)t.releaseAll();else throw new Error("\u5BF9\u8C61\u6C60\u4E0D\u5B58\u5728")}static destroy(e){let t=this.pools.get(e);if(t)t.destroy(),this.pools.delete(e);else throw new Error("\u5BF9\u8C61\u6C60\u4E0D\u5B58\u5728")}static logStatus(){console.log("\u5404\u5BF9\u8C61\u6C60\u7684\u72B6\u6001\uFF1A"),this.pools.forEach((e,t)=>{console.log(`\u7C7B\u540D: ${t.name}`),console.log(`  \u5DF2\u4F7F\u7528\u5BF9\u8C61\u6570\u91CF: ${e.usingCount}`),console.log(`  \u7A7A\u95F2\u5BF9\u8C61\u6570\u91CF: ${e.freeCount}`)})}};h.pools=new Map;var n=class n{constructor(){this.propagationStopped=!1}init(e,t,r,i,s){this.type=e,this.data=t,this.err=r,this.url=s,this.progress=i}reset(){this.type=void 0,this.data=null,this.err=void 0,this.url=void 0,this.progress=0}destroy(){return this.reset(),!0}release(){h.release(n,this)}static create(e,t,r,i,s){let a=h.acquire(n);return a.init(e,t,r,i,s),a}};n.START="START",n.PROGRESS="PROGRESS",n.COMPLETE="COMPLETE",n.ERROR="ERROR",n.SHOW="SHOW",n.HIDE="HIDE",n.ADD="ADD",n.REMOVE="REMOVE",n.UPDATE="UPDATE",n.CLEAR="CLEAR",n.STATE_CHANGED="STATE_CHANGED",n.VALUE_CHANGED="VALUE_CHANGED",n.ADD_CHILD="ADD_CHILD",n.REMOVE_CHILD="REMOVE_CHILD",n.CHILD_VALUE_CHANGED="CHILD_VALUE_CHANGED";var _=n;var o=class{static inject(e,t){t instanceof Function?this.__injectedMap.set(e,t):this.__instanceMap.set(e,t)}static getInject(e){let t=this.__instanceMap.get(e);if(t)return t;let r=this.__injectedMap.get(e);return r===void 0?null:(t=new r,this.__instanceMap.set(e,t),t)}};o.__injectedMap=new Map,o.__instanceMap=new Map;var m=class{constructor(){this.__tickerList=[];this.__nextFrameCallBacks=[]}tick(e){let t;for(;this.__nextFrameCallBacks.length;)t=this.__nextFrameCallBacks.shift(),t.callBack.apply(t.caller);for(let r=0;r<this.__tickerList.length;r++)this.__tickerList[r].tick(e)}addTicker(e){if(this.__tickerList.indexOf(e)>=0)throw new Error("Ticker \u91CD\u590D\u6DFB\u52A0\uFF01");this.__tickerList.push(e)}removeTicker(e){let t=this.__tickerList.indexOf(e);if(t<0)throw new Error("\u627E\u4E0D\u5230\u8981\u5220\u9664\u7684Tick!");this.__tickerList.splice(t,1)}callNextFrame(e,t){for(let r=0;r<this.__nextFrameCallBacks.length;r++)if(this.__nextFrameCallBacks[r].equal(e,t))return;this.__nextFrameCallBacks.push(new E(e,t))}clearNextFrame(e,t){for(let r=0;r<this.__nextFrameCallBacks.length;r++)this.__nextFrameCallBacks[r].equal(e,t)&&this.__nextFrameCallBacks.splice(r,1)}},E=class{constructor(e,t){this.callBack=e,this.caller=t}equal(e,t){return!(this.caller!==t||this.callBack!==e)}};var p=class{static tick(e){this.impl.tick(e)}static addTicker(e){this.addTicker(e)}static removeTicker(e){this.removeTicker(e)}static callNextFrame(e,t){this.callNextFrame(e,t)}static clearNextFrame(e,t){this.clearNextFrame(e,t)}static get impl(){return this.__impl==null&&(this.__impl=o.getInject(this.KEY)),this.__impl==null&&(this.__impl=new m),this.__impl}};p.KEY="TickerManager";var f=class{constructor(e,t,r,i=255){this.priority=255;this.type=e,this.caller=t,this.handler=r,this.priority=i}reset(){this.type=void 0,this.caller=void 0,this.handler=void 0,this.priority=255}destroy(){return this.reset(),!0}equal(e){return this.type===e.type&&this.caller===e.caller&&this.handler===e.handler}equals(e,t,r){return this.type===e&&this.handler===t&&this.caller===r}};var u=class u{constructor(){this.eventAync=!1;this.__needEmit=[];this.__listeners=new Map,this.__callers=new Map}on(e,t,r,i){let s=this.__listeners.get(e);s||(s=[],this.__listeners.set(e,s));for(let y of s)if(y.equals(e,t,r))throw new Error(`\u91CD\u590D\u6DFB\u52A0\u4E8B\u4EF6\u76D1\u542C\uFF1A${e} ${t} ${r}`);let a=new f(e,t,r,i);s.push(a),s.sort((y,g)=>y.priority-g.priority);let l=this.__callers.get(r);l||(l=[],this.__callers.set(r,l)),l.push(a)}off(e,t,r){let i=this.__listeners.get(e);if(!i)return;let s=i.findIndex(l=>l.equals(e,t,r));if(s<0)return;i.splice(s,1);let a=this.__callers.get(r);a&&(s=a.findIndex(l=>l.equals(e,t,r)),!(s<0)&&a.splice(s,1))}offByCaller(e){let t=this.__callers.get(e);if(t)for(;t.length>0;){let r=t[0];this.off(r.type,r.handler,r.caller)}}offAllEvent(){this.__listeners.forEach(e=>{e.forEach(t=>{t.destroy()})}),this.__listeners.clear(),this.__callers.clear()}emit(e,t,r,i,s){if(this.__listeners.has(e))return;let a=_.create(e,t,r,i,s);this.__needEmit.push(a),this.eventAync?p.callNextFrame(this.__emit,this):this.__emit()}__emit(){for(let e=0;e<this.__needEmit.length;e++){let t=this.__needEmit[e];if(this.hasEvent(t.type)&&t.propagationStopped==!1){let r=this.__listeners.get(t.type),i;for(let s=0;s<r.length&&(i=r[s],!t.propagationStopped);s++)i.handler.apply(i.caller,[t])}t.release()}this.__needEmit.splice(0,this.__needEmit.length)}hasEvent(e){return this.__listeners.has(e)}hasEventHandler(e,t,r){if(this.__listeners.has(e)==!1)return!1;let i=this.__listeners.get(e),s;for(let a=0;a<i.length;a++)if(s=i[a],s.equals(e,t,r))return!0;return!1}destroy(){return this.__listeners.clear(),this.__callers.clear(),!0}};u.Main=new u;var v=u;export{_ as Event,v as EventDispatcher,o as Injector};
//# sourceMappingURL=dream-cc-core.mjs.map
